{"info": {"author": "Kishwar Shafin", "author_email": "kishwar.shafin@gmail.com", "bugtrack_url": null, "classifiers": [], "description": "# P.E.P.P.E.R.\n###### Program for Evaluating Patterns in the Pileups of Erroneous Reads\n\n[![Build Status](https://travis-ci.com/kishwarshafin/pepper.svg?branch=master)](https://travis-ci.com/kishwarshafin/pepper)\n[![PyPI version](https://badge.fury.io/py/pepper-polish.svg)](https://badge.fury.io/py/pepper-polish)\n\n`P.E.P.P.E.R.` is a deep neural network based polisher designed to work with Oxford Nanopore Sequencing technology. `P.E.P.P.E.R.` uses a Recurrent Neural Network (RNN) based encoder-decoder model to call a consensus sequence from the summary statistics of each genomic position. The local realignment process using [SSW](https://github.com/mengyao/Complete-Striped-Smith-Waterman-Library) is used and the module does not require any prior polishing with other tools (i.e. racon).\n\n\u00a9 2020 Kishwar Shafin, Trevor Pesout, Miten Jain, Benedict Paten. <br/>\nComputational Genomics Lab (CGL), University of California, Santa Cruz.\n\n## Workflow\n * Sequence a genome and get a basecalled reads file (`reads.fastq`).\n * Use an assembler to get an assembly from the basecalled data (`assembly.fa`).\n * Use [minimap2](https://github.com/lh3/minimap2) to map `reads.fastq` to `assembly.fa` and get a bam file (`reads_2_assembly.bam`).\n * Use `pepper polish` to polish a genome.\n <p align=\"center\">\n <img src=\"img/PEPPER_pipeline.svg\" alt=\"pipeline.svg\" height=\"640p\">\n </p>\n\n\n## Installation\nWe recommend using `Linux` environment to run `PEPPER`.\n\n### Install dependencies\n```bash\nsudo apt-get -y install cmake make git gcc g++ autoconf bzip2 lzma-dev zlib1g-dev \\\nlibcurl4-openssl-dev libpthread-stubs0-dev libbz2-dev \\\nliblzma-dev libhdf5-dev python3-pip python3-virtualenv\n```\n\n### <img src=\"img/pip_logo.svg\" alt=\"\" height=\"20p\"> Install using pip\n```bash\npython3 -m pip install pepper-polish\n# if you get permission error, then try:\npython3 -m pip install --user pepper-polish\n\npython3 -m pepper.pepper --help\npython3 -m pepper.pepper polish --help\n```\nIf you want to directly call `PEPPER`. You can do:\n```bash\necho 'export PATH=\"$(python3 -m site --user-base)/bin\":$PATH' >> ~/.bashrc\nsource ~/.bashrc\n\npepper --version\npepper --help\npepper polish --help\n```\n### <img src=\"img/terminal.svg\" alt=\"\" height=\"20p\"> Install from source\nWe recommend using `virtualenv` to run pepper:\n```bash\ngit clone https://github.com/kishwarshafin/pepper.git\ncd pepper\nmake install\n. ./vnev/bin/activate\n\npepper --help\npepper polish --help\n```\n\n## Usage\n\nPolishing involves three sub-processes `make_images`, `call_consensus`, `stitch`. You can run all three steps using `pepper polish` or run each step separately.\n\n###  Download models\nYou can download all available `PEPPER` models in one command.\n\n```bash\npepper download_models \\\n--output_dir </path/to/pepper_model_directory/>\n```\n###  One step polishing\n#### Case 1: CPU machine\nIf you are using a CPU-only machine you ca use the following command:\n```bash\npepper polish \\\n--bam </path/to/reads_2_draft_assembly.bam> \\\n--fasta <path/to/draft_assembly.fasta> \\\n--model_path <path/to/pepper/models/XXX.pkl> \\\n--output_file <path/to/output_polished_sequence/output_file_prefix> \\\n--threads <total_threads> \\\n--batch_size 128\n```\n\n#### Case 2: GPU machine\nYou can check your `CUDA` availability by running `pepper torch_stat`. If you have CUDA available and GPU devices on your machine, you can do:\n```bash\npepper polish \\\n--bam </path/to/reads_2_draft_assembly.bam> \\\n--fasta <path/to/draft_assembly.fasta> \\\n--model_path <path/to/pepper/models/XXX.pkl> \\\n--output_file <path/to/output_polished_sequence/output_file_prefix> \\\n--threads <number_of_threads> \\\n--batch_size 512 \\\n--gpu \\\n--num_workers <num_workers>\n```\nYou can select which `CUDA` devices to use with `--device_ids` parameter.\n\n```bash\nARGUMENT DETAILS:\n  -h, --help            show this help message and exit\n  -b BAM, --bam BAM     BAM file containing mapping between reads and the\n                        draft assembly.\n  -f FASTA, --fasta FASTA\n                        FASTA file containing the draft assembly.\n  -m MODEL_PATH, --model_path MODEL_PATH\n                        Path to a trained model.\n  -o OUTPUT_FILE, --output_file OUTPUT_FILE\n                        Path to output file with an expected prefix (i.e. -o\n                        ./outputs/polished_genome)\n  -t THREADS, --threads THREADS\n                        Number of threads to use. Default is 5.\n  -r REGION, --region REGION\n                        Region in [contig_name:start-end] format\n  -bs BATCH_SIZE, --batch_size BATCH_SIZE\n                        Batch size for testing, default is 100. Suggested\n                        values: 256/512/1024.\n  -g, --gpu             If set then PyTorch will use GPUs for inference. CUDA\n                        required.\n  -dx, --distributed_off\n                        Turn off distributed inference. This mode will disable\n                        the use of multiple callers.\n  -d_ids DEVICE_IDS, --device_ids DEVICE_IDS\n                        List of gpu device ids to use for inference. Only used\n                        in distributed setting. Example usage: --device_ids\n                        0,1,2 (this will create three callers in id 'cuda:0,\n                        cuda:1 and cuda:2' If none then it will use all\n                        available devices.\n  -w NUM_WORKERS, --num_workers NUM_WORKERS\n                        Number of workers for loading images. Default is 4.\n  -tpc THREADS_PER_CALLER, --threads_per_caller THREADS_PER_CALLER\n                        Total threads to be used per caller. A sane value\n                        would be num_callers * threads <= total_threads.\n  -c CALLERS, --callers CALLERS\n                        Total number of callers to spawn if doing CPU\n                        inference in distributed mode.\n```\n\n## Results\n\n#### PEPPER achieves lower error rate than ONT suggested pipeline.\nWe compared `PEPPER` against `Racon-Medaka` pipeline and we demonstrate significantly better results for microbial genomes. We used Staphylococcus Aureus samples to evaluate these two pipelines. The PEPPER microbial model was trained on samples excluding Staphylococcus Aureus. We used `r941_prom_high` model to run `Medaka`.\n<p align=\"center\">\n<img src=\"img/PEPPER_error_rate.png\" alt=\"PEPPER_error_rate.png\" height=\"420\">\n</p>\n\n#### New R10 chemistry shows further improvement in polishing results\nThe new `R10` data is now available for `MinION` and we polished the assembly generated with `R9` data using the `R10` reads. The R10 data provides significant improvement in overall quality of the genome.\n<p align=\"center\">\n<img src=\"img/PEPPER_chemistry.png\" alt=\"PEPPER_chemistry.png\" height=\"420p\">\n</p>\n\n## Acknowledgement\nWe are thankful to the developers of these packages: </br>\n* [Medaka](https://github.com/nanoporetech/medaka)\n* [htslib & samtools](http://www.htslib.org/)\n* [ssw library](https://github.com/mengyao/Complete-Striped-Smith-Waterman-Library)\n* [hdf5 python (h5py)](https://www.h5py.org/)\n* [pytorch](https://pytorch.org/)\n\n## Fun Fact\n<img src=\"https://vignette.wikia.nocookie.net/marveldatabase/images/7/72/Anthony_Stark_%28Earth-616%29_from_Iron_Man_Vol_5_2_002.jpg/revision/latest?cb=20130407031815\" alt=\"guppy235\" width=\"240p\"> <br/>\n\nThe name \"P.E.P.P.E.R.\" is also inspired from an A.I. created by Tony Stark in the  Marvel Comics (Earth-616). PEPPER is named after Tony Stark's then friend and the CEO of Resilient, Pepper Potts.\n\n\n\u00a9 2020 Kishwar Shafin, Trevor Pesout, Miten Jain, Benedict Paten.\n\n\n", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/kishwarshafin/pepper", "keywords": "", "license": "", "maintainer": "", "maintainer_email": "", "name": "pepper-polish", "package_url": "https://pypi.org/project/pepper-polish/", "platform": "", "project_url": "https://pypi.org/project/pepper-polish/", "project_urls": {"Homepage": "https://github.com/kishwarshafin/pepper"}, "release_url": "https://pypi.org/project/pepper-polish/0.0.6/", "requires_dist": ["h5py", "tqdm", "numpy", "wget", "torch", "torchvision", "torchnet", "pyyaml", "onnx", "onnxruntime", "hyperopt"], "requires_python": ">=3.5.*", "summary": "RNN based standalone assembly polisher.", "version": "0.0.6"}, "last_serial": 6748798, "releases": {"0.0.1": [{"comment_text": "", "digests": {"md5": "9b4954e0780b843e98f179d6bf9478db", "sha256": "3cb8d2af07a831ab9c86af2cf421aa85f7cde720d21323e3294473b17778e3e2"}, "downloads": -1, "filename": "pepper_polish-0.0.1-cp36-cp36m-macosx_10_9_x86_64.whl", "has_sig": false, "md5_digest": "9b4954e0780b843e98f179d6bf9478db", "packagetype": "bdist_wheel", "python_version": "cp36", "requires_python": ">=3.5.*", "size": 445591, "upload_time": "2020-02-23T17:25:39", "upload_time_iso_8601": "2020-02-23T17:25:39.882475Z", "url": "https://files.pythonhosted.org/packages/32/d0/7898e50a163fa91a2d11fa2faa3948cd2d599907543d59032c041ad4ee6d/pepper_polish-0.0.1-cp36-cp36m-macosx_10_9_x86_64.whl"}, {"comment_text": "", "digests": {"md5": "996e66ebb316eb46ee6854c3d9779157", "sha256": "cb831728336c8dba6a6bc01d97cd6bc5580527cc02c7e60e730e0e15a2f5ebb1"}, "downloads": -1, "filename": "pepper_polish-0.0.1-py3.6-macosx-10.9-x86_64.egg", "has_sig": false, "md5_digest": "996e66ebb316eb46ee6854c3d9779157", "packagetype": "bdist_egg", "python_version": "3.6", "requires_python": ">=3.5.*", "size": 520692, "upload_time": "2020-03-03T22:49:18", "upload_time_iso_8601": "2020-03-03T22:49:18.598417Z", "url": "https://files.pythonhosted.org/packages/53/00/dd2f471fbafb5bc7b77c4874a917378f69e29195b8f5b035ac5320f3c66b/pepper_polish-0.0.1-py3.6-macosx-10.9-x86_64.egg"}, {"comment_text": "", "digests": {"md5": "4ab82c697a9f5e1b1f2ece3fa808289d", "sha256": "6cd749364dfecff8986a9972fabe2f825a0047a0e8bc96853cc4747a6f6b0366"}, "downloads": -1, "filename": "pepper_polish-0.0.1.tar.gz", "has_sig": false, "md5_digest": "4ab82c697a9f5e1b1f2ece3fa808289d", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.5.*", "size": 575696, "upload_time": "2020-02-23T17:25:48", "upload_time_iso_8601": "2020-02-23T17:25:48.801523Z", "url": "https://files.pythonhosted.org/packages/31/34/63b9f97acf36790039200752e50ab25ca6cf049f71a367d29c005cca30a9/pepper_polish-0.0.1.tar.gz"}], "0.0.2": [{"comment_text": "", "digests": {"md5": "be430d21d5225efd3b1a6aaef9ff9952", "sha256": "28775f24dafc60d7bde68fd1ec5572a5079774fe14f2571c4a88f24aa5b3aef9"}, "downloads": -1, "filename": "pepper_polish-0.0.2-cp36-cp36m-macosx_10_9_x86_64.whl", "has_sig": false, "md5_digest": "be430d21d5225efd3b1a6aaef9ff9952", "packagetype": "bdist_wheel", "python_version": "cp36", "requires_python": ">=3.5.*", "size": 445833, "upload_time": "2020-03-03T22:49:17", "upload_time_iso_8601": "2020-03-03T22:49:17.482794Z", "url": "https://files.pythonhosted.org/packages/0a/8d/3b1018336bfe37ad5a4527606401dc934e7387feffa793d208b1cdb5c1e1/pepper_polish-0.0.2-cp36-cp36m-macosx_10_9_x86_64.whl"}, {"comment_text": "", "digests": {"md5": "ee96f962f262b62205354be289ad6af3", "sha256": "e8cdc8858ec4d1ed30ce5120f9c86426c9aa07ef4aea501ffaca4ddca7c551ab"}, "downloads": -1, "filename": "pepper_polish-0.0.2-py3.6-macosx-10.9-x86_64.egg", "has_sig": false, "md5_digest": "ee96f962f262b62205354be289ad6af3", "packagetype": "bdist_egg", "python_version": "3.6", "requires_python": ">=3.5.*", "size": 520739, "upload_time": "2020-03-03T22:51:33", "upload_time_iso_8601": "2020-03-03T22:51:33.626163Z", "url": "https://files.pythonhosted.org/packages/5a/69/89972751a96086897bed240bfa37f697303a613a68db27ecee90720c35b9/pepper_polish-0.0.2-py3.6-macosx-10.9-x86_64.egg"}, {"comment_text": "", "digests": {"md5": "9c6bc4814283bd51e33548e90c87c0c6", "sha256": "21225b0768df4beac0a51bcc786b54a60592d71c479b5c9d98d5bd0aa8624028"}, "downloads": -1, "filename": "pepper_polish-0.0.2.tar.gz", "has_sig": false, "md5_digest": "9c6bc4814283bd51e33548e90c87c0c6", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.5.*", "size": 536246, "upload_time": "2020-03-03T22:49:19", "upload_time_iso_8601": "2020-03-03T22:49:19.740847Z", "url": "https://files.pythonhosted.org/packages/53/c6/add741abe68f490cb0ac0e309c42cce3cd5d5d75f4512abf6a51d5e8f671/pepper_polish-0.0.2.tar.gz"}], "0.0.3": [{"comment_text": "", "digests": {"md5": "4fd2aa4cf2aa6c880971367ad5f70005", "sha256": "1f3fefaf6b673f5c9632689fe1084ce9c1eef25d9525477b55cf9b4cdda9f3cf"}, "downloads": -1, "filename": "pepper_polish-0.0.3-cp36-cp36m-macosx_10_9_x86_64.whl", "has_sig": false, "md5_digest": "4fd2aa4cf2aa6c880971367ad5f70005", "packagetype": "bdist_wheel", "python_version": "cp36", "requires_python": ">=3.5.*", "size": 445836, "upload_time": "2020-03-03T22:54:15", "upload_time_iso_8601": "2020-03-03T22:54:15.852603Z", "url": "https://files.pythonhosted.org/packages/fa/66/31114d81f536d2aa6776b09277272d1ae2922864b415591a27337af7d12a/pepper_polish-0.0.3-cp36-cp36m-macosx_10_9_x86_64.whl"}, {"comment_text": "", "digests": {"md5": "f7798b6c36f4157f654e27fb81601016", "sha256": "9a7ac34b17ed96fa88db6160b2fb4f855fb1596c96d4a72832d0995616c4a5fb"}, "downloads": -1, "filename": "pepper_polish-0.0.3.tar.gz", "has_sig": false, "md5_digest": "f7798b6c36f4157f654e27fb81601016", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.5.*", "size": 536242, "upload_time": "2020-03-03T22:54:16", "upload_time_iso_8601": "2020-03-03T22:54:16.892794Z", "url": "https://files.pythonhosted.org/packages/e0/57/200f0e4930da9cb874f07764577a4b400dec32f59dc4694066fc6e40d56f/pepper_polish-0.0.3.tar.gz"}], "0.0.5": [{"comment_text": "", "digests": {"md5": "d704a24c5c56c94bfbe392a9dc9f369d", "sha256": "03c30b6c9aadbd0de4e5ea95bcfd234a41722cab010142e38b9fcd94c3a9753f"}, "downloads": -1, "filename": "pepper_polish-0.0.5-cp36-cp36m-macosx_10_9_x86_64.whl", "has_sig": false, "md5_digest": "d704a24c5c56c94bfbe392a9dc9f369d", "packagetype": "bdist_wheel", "python_version": "cp36", "requires_python": ">=3.5.*", "size": 446470, "upload_time": "2020-03-04T15:57:14", "upload_time_iso_8601": "2020-03-04T15:57:14.791222Z", "url": "https://files.pythonhosted.org/packages/39/9a/1e149cbb0d3bba0b60e5b22fe2adba92d7af93d3239abb3708ce3a5dab2f/pepper_polish-0.0.5-cp36-cp36m-macosx_10_9_x86_64.whl"}, {"comment_text": "", "digests": {"md5": "06e31f9ab973db0635dd59d29e5f9c51", "sha256": "571821525e6ef013cb400e427784eb7906fc712a187ec7da7e7afcf6c431061e"}, "downloads": -1, "filename": "pepper_polish-0.0.5-py3.6-macosx-10.9-x86_64.egg", "has_sig": false, "md5_digest": "06e31f9ab973db0635dd59d29e5f9c51", "packagetype": "bdist_egg", "python_version": "3.6", "requires_python": ">=3.5.*", "size": 521942, "upload_time": "2020-03-04T15:57:16", "upload_time_iso_8601": "2020-03-04T15:57:16.320431Z", "url": "https://files.pythonhosted.org/packages/c1/38/a981642b6bb43e45c058e128e870a00c7768e8e9ec200d50b58b528ec7a0/pepper_polish-0.0.5-py3.6-macosx-10.9-x86_64.egg"}, {"comment_text": "", "digests": {"md5": "52b2873d8b70c8dc15a4525c445f4090", "sha256": "90e76bf2c55294082c4a2579227f876a1ce82d56c05a7291d27ef82805ae9315"}, "downloads": -1, "filename": "pepper_polish-0.0.5.tar.gz", "has_sig": false, "md5_digest": "52b2873d8b70c8dc15a4525c445f4090", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.5.*", "size": 502060, "upload_time": "2020-03-04T15:57:17", "upload_time_iso_8601": "2020-03-04T15:57:17.518761Z", "url": "https://files.pythonhosted.org/packages/e9/b3/80becd6dc17b1feb9d97efc4abc916b5b0509a22eda6f355160e98e9d8e4/pepper_polish-0.0.5.tar.gz"}], "0.0.6": [{"comment_text": "", "digests": {"md5": "29e2ab7c2331f83f9596d7a5c7445de1", "sha256": "b3bae82310c96fe8f456512743785cf949c59cb1d2d883fa3e4e670203402d2d"}, "downloads": -1, "filename": "pepper_polish-0.0.6-cp36-cp36m-macosx_10_9_x86_64.whl", "has_sig": false, "md5_digest": "29e2ab7c2331f83f9596d7a5c7445de1", "packagetype": "bdist_wheel", "python_version": "cp36", "requires_python": ">=3.5.*", "size": 446468, "upload_time": "2020-03-04T16:08:08", "upload_time_iso_8601": "2020-03-04T16:08:08.826010Z", "url": "https://files.pythonhosted.org/packages/20/13/9ff7ad3d6592d8898daba5907e4d13d709fcc4f779d29274c39d775b1ac4/pepper_polish-0.0.6-cp36-cp36m-macosx_10_9_x86_64.whl"}, {"comment_text": "", "digests": {"md5": "76938f0969a50921aa31dcc167fc0cf1", "sha256": "434bd7cb63b8d581a442aedcfb3c7c9aaa17d01a5960a118079cd52d9a6e36d2"}, "downloads": -1, "filename": "pepper_polish-0.0.6.tar.gz", "has_sig": false, "md5_digest": "76938f0969a50921aa31dcc167fc0cf1", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.5.*", "size": 535015, "upload_time": "2020-03-04T16:08:10", "upload_time_iso_8601": "2020-03-04T16:08:10.690785Z", "url": "https://files.pythonhosted.org/packages/79/f5/f193595dd7f6c66f3b8cd6d1695e2f4c646aa9ef0db0bc02f21a737d7f9c/pepper_polish-0.0.6.tar.gz"}]}, "urls": [{"comment_text": "", "digests": {"md5": "29e2ab7c2331f83f9596d7a5c7445de1", "sha256": "b3bae82310c96fe8f456512743785cf949c59cb1d2d883fa3e4e670203402d2d"}, "downloads": -1, "filename": "pepper_polish-0.0.6-cp36-cp36m-macosx_10_9_x86_64.whl", "has_sig": false, "md5_digest": "29e2ab7c2331f83f9596d7a5c7445de1", "packagetype": "bdist_wheel", "python_version": "cp36", "requires_python": ">=3.5.*", "size": 446468, "upload_time": "2020-03-04T16:08:08", "upload_time_iso_8601": "2020-03-04T16:08:08.826010Z", "url": "https://files.pythonhosted.org/packages/20/13/9ff7ad3d6592d8898daba5907e4d13d709fcc4f779d29274c39d775b1ac4/pepper_polish-0.0.6-cp36-cp36m-macosx_10_9_x86_64.whl"}, {"comment_text": "", "digests": {"md5": "76938f0969a50921aa31dcc167fc0cf1", "sha256": "434bd7cb63b8d581a442aedcfb3c7c9aaa17d01a5960a118079cd52d9a6e36d2"}, "downloads": -1, "filename": "pepper_polish-0.0.6.tar.gz", "has_sig": false, "md5_digest": "76938f0969a50921aa31dcc167fc0cf1", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.5.*", "size": 535015, "upload_time": "2020-03-04T16:08:10", "upload_time_iso_8601": "2020-03-04T16:08:10.690785Z", "url": "https://files.pythonhosted.org/packages/79/f5/f193595dd7f6c66f3b8cd6d1695e2f4c646aa9ef0db0bc02f21a737d7f9c/pepper_polish-0.0.6.tar.gz"}]}