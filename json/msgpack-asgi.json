{"info": {"author": "Florimond Manca", "author_email": "florimond.manca@gmail.com", "bugtrack_url": null, "classifiers": ["Development Status :: 5 - Production/Stable", "Intended Audience :: Developers", "Operating System :: OS Independent", "Programming Language :: Python :: 3", "Programming Language :: Python :: 3.6", "Programming Language :: Python :: 3.7", "Programming Language :: Python :: 3.8"], "description": "# msgpack-asgi\n\n[![Build Status](https://dev.azure.com/florimondmanca/public/_apis/build/status/florimondmanca.msgpack-asgi?branchName=master)](https://dev.azure.com/florimondmanca/public/_build/latest?definitionId=5&branchName=master)\n[![Coverage](https://codecov.io/gh/florimondmanca/msgpack-asgi/branch/master/graph/badge.svg)](https://codecov.io/gh/florimondmanca/msgpack-asgi)\n[![Package version](https://badge.fury.io/py/msgpack-asgi.svg)](https://pypi.org/project/msgpack-asgi)\n\n`msgpack-asgi` allows you to add automatic [MessagePack](https://msgpack.org/) content negotiation to ASGI applications (Starlette, FastAPI, Quart, etc.), with a single line of code:\n\n```python\napp.add_middleware(MessagePackMiddleware)\n```\n\n_(You may want to adapt this snippet to your framework-specific middleware API.)_\n\nThis gives you the performance benefits of MessagePack (e.g. reduced bandwidth usage) without having to change existing code. See also [How it works](#how-it-works).\n\n## Installation\n\nInstall with pip:\n\n```bash\npip install \"mspack-asgi==1.*\"\n```\n\n## Quickstart\n\nFirst, you'll need an ASGI application. Let's use this sample application, which exposes an endpoint that returns JSON data:\n\n```python\n# For convenience, we use some ASGI components from Starlette.\n# Install with: `$ pip install starlette`.\nfrom starlette.requests import Request\nfrom starlette.responses import JSONResponse\n\n\nasync def get_response(request):\n    if request.method == \"POST\":\n        data = await request.json()\n        return JSONResponse({\"data\": data})\n    else:\n        return JSONResponse({\"message\": \"Hello, msgpack!\"})\n\n\nasync def app(scope, receive, send):\n    assert scope[\"type\"] == \"http\"\n    request = Request(scope=scope)\n    response = await get_response(request)\n    await response(scope, receive, send)\n```\n\nThen, wrap your application around `MessagePackMiddleware`:\n\n```python\nfrom msgpack_asgi import MessagePackMiddleware\n\napp = MessagePackMiddleware(app)\n```\n\nServe your application using an ASGI server, for example with [Uvicorn](https://www.uvicorn.org):\n\n```bash\nuvicorn app:app\n```\n\nNow, let's make a request that accepts MessagePack data in response:\n\n```bash\ncurl -i http://localhost:8000 -H \"Accept: application/x-msgpack\"\n```\n\nYou should get the following output:\n\n```http\nHTTP/1.1 200 OK\ndate: Fri, 01 Nov 2019 17:40:14 GMT\nserver: uvicorn\ncontent-length: 25\ncontent-type: application/x-msgpack\n\n\ufffd\ufffdmessage\ufffdHello, msgpack!\n```\n\nWhat happened? Since we told the application that we accepted MessagePack-encoded responses, `msgpack-asgi` automatically converted the JSON data returned by the Starlette application to MessagePack.\n\nWe can make sure the response contains valid MessagePack data by making the request again in Python, and decoding the response content:\n\n```python\n>>> import requests\n>>> import msgpack\n>>> url = \"http://localhost:8000\"\n>>> headers = {\"accept\": \"application/x-msgpack\"}\n>>> r = requests.get(url, headers=headers)\n>>> r.content\nb'\\x81\\xa7message\\xafHello, msgpack!'\n>>> msgpack.unpackb(r.content, raw=False)\n{'message': 'Hello, msgpack!'}\n```\n\n`msgpack-asgi` also works in reverse: it will automatically decode MessagePack-encoded data sent by the client to JSON. We can try this out by making a `POST` request to our sample application with a MessagePack-encoded body:\n\n```python\n>>> import requests\n>>> import msgpack\n>>> url = \"http://localhost:8000\"\n>>> data = msgpack.packb({\"message\": \"Hi, there!\"})\n>>> headers = {\"content-type\": \"application/x-msgpack\"}\n>>> r = requests.post(url, data=data, headers=headers)\n>>> r.json()\n{'data': {'message': 'Hi, there!'}}\n```\n\nThat's all there is to it! You can now go reduce the size of your payloads.\n\n## Limitations\n\n`msgpack-asgi` does not support request or response streaming. This is because the full request and response body content has to be loaded in memory before it can be re-encoded.\n\n## How it works\n\n![](https://github.com/florimondmanca/msgpack-asgi/blob/master/img/msgpack-asgi.png)\n\nAn ASGI application wrapped around `MessagePackMiddleware` will perform automatic content negotiation based on the client's capabilities. More precisely:\n\n- If the client sends MessagePack-encoded data with the `application/x-msgpack` content type, `msgpack-asgi` will automatically re-encode it to JSON for your application to consume.\n- If the client sent the `Accept: application/x-msgpack` header, `msgpack-asgi` will automatically re-encode any JSON response data to MessagePack for the client to consume.\n\n(In other cases, `msgpack-asgi` won't intervene at all.)\n\n## License\n\nMIT\n\n\n# Changelog\n\nAll notable changes to this project will be documented in this file.\n\nThe format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/).\n\n## 1.0.0 - 2020-26-03\n\n_First production/stable release._\n\n### Changed\n\n- Switch to private module naming. Components should now be imported from the root package, e.g. `from msgpack_asgi import MessagePackMiddleware`. (Pull #5)\n\n### Fixed\n\n- Add missing `MANIFEST.in`. (Pull #4)\n\n## 0.1.0 - 2019-11-04\n\nInitial release.\n\n### Added\n\n- Add the `MessagePackMiddleware` ASGI middleware.\n- Add the `MessagePackResponse` ASGI response class.\n\n\n", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "http://github.com/florimondmanca/msgpack-asgi", "keywords": "", "license": "MIT", "maintainer": "", "maintainer_email": "", "name": "msgpack-asgi", "package_url": "https://pypi.org/project/msgpack-asgi/", "platform": "", "project_url": "https://pypi.org/project/msgpack-asgi/", "project_urls": {"Homepage": "http://github.com/florimondmanca/msgpack-asgi"}, "release_url": "https://pypi.org/project/msgpack-asgi/1.0.0/", "requires_dist": ["msgpack", "starlette (==0.*)"], "requires_python": ">=3.6", "summary": "Drop-in MessagePack support for ASGI applications and frameworks", "version": "1.0.0"}, "last_serial": 6891596, "releases": {"0.1.0": [{"comment_text": "", "digests": {"md5": "f41c546295ee45e5f759af4897cc91d3", "sha256": "afcc337d6459862e27cd5db3644f1d92582d557f15cee0786842979c1aed7e5e"}, "downloads": -1, "filename": "msgpack_asgi-0.1.0-py3-none-any.whl", "has_sig": false, "md5_digest": "f41c546295ee45e5f759af4897cc91d3", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.6", "size": 5854, "upload_time": "2019-11-04T11:13:25", "upload_time_iso_8601": "2019-11-04T11:13:25.444934Z", "url": "https://files.pythonhosted.org/packages/4b/92/26e855a672ede0f08073686edf2b297a4fc5a62662e4b7be3d3087be16bf/msgpack_asgi-0.1.0-py3-none-any.whl"}, {"comment_text": "", "digests": {"md5": "c718e0821f3fd9bec074a18f6da28bdd", "sha256": "10b77dffa75691ed30624ea4e5c9d2a2885c40fe6787853bd5a8387c82806cac"}, "downloads": -1, "filename": "msgpack-asgi-0.1.0.tar.gz", "has_sig": false, "md5_digest": "c718e0821f3fd9bec074a18f6da28bdd", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.6", "size": 6049, "upload_time": "2019-11-04T11:13:27", "upload_time_iso_8601": "2019-11-04T11:13:27.903094Z", "url": "https://files.pythonhosted.org/packages/80/af/eea18f01d714685c60bb8875723d6eaadbdf23711e50d1201502217b024e/msgpack-asgi-0.1.0.tar.gz"}], "1.0.0": [{"comment_text": "", "digests": {"md5": "40f685022a9084aa9d41604fc205a3a5", "sha256": "77dfbf422c170cab56520423e104c4103e766aa6313492a3cd992ff24072fa35"}, "downloads": -1, "filename": "msgpack_asgi-1.0.0-py3-none-any.whl", "has_sig": false, "md5_digest": "40f685022a9084aa9d41604fc205a3a5", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.6", "size": 6547, "upload_time": "2020-03-26T20:22:35", "upload_time_iso_8601": "2020-03-26T20:22:35.241976Z", "url": "https://files.pythonhosted.org/packages/00/42/83830a240814c2d93a8c250ff801bcf909aeede5a9485ef272949fa0e11a/msgpack_asgi-1.0.0-py3-none-any.whl"}, {"comment_text": "", "digests": {"md5": "5ee61ef3badfc0984873a348b266957c", "sha256": "dab20e5ed5cdba96704ffd86d40f3d3b6da19e9093255b88b01c3ae045749a05"}, "downloads": -1, "filename": "msgpack-asgi-1.0.0.tar.gz", "has_sig": false, "md5_digest": "5ee61ef3badfc0984873a348b266957c", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.6", "size": 7446, "upload_time": "2020-03-26T20:22:36", "upload_time_iso_8601": "2020-03-26T20:22:36.770164Z", "url": "https://files.pythonhosted.org/packages/bd/ea/d52c8a8be1a19ccdedf6ef5c3287110478dcd71b8183015d9a1cd85111b3/msgpack-asgi-1.0.0.tar.gz"}]}, "urls": [{"comment_text": "", "digests": {"md5": "40f685022a9084aa9d41604fc205a3a5", "sha256": "77dfbf422c170cab56520423e104c4103e766aa6313492a3cd992ff24072fa35"}, "downloads": -1, "filename": "msgpack_asgi-1.0.0-py3-none-any.whl", "has_sig": false, "md5_digest": "40f685022a9084aa9d41604fc205a3a5", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.6", "size": 6547, "upload_time": "2020-03-26T20:22:35", "upload_time_iso_8601": "2020-03-26T20:22:35.241976Z", "url": "https://files.pythonhosted.org/packages/00/42/83830a240814c2d93a8c250ff801bcf909aeede5a9485ef272949fa0e11a/msgpack_asgi-1.0.0-py3-none-any.whl"}, {"comment_text": "", "digests": {"md5": "5ee61ef3badfc0984873a348b266957c", "sha256": "dab20e5ed5cdba96704ffd86d40f3d3b6da19e9093255b88b01c3ae045749a05"}, "downloads": -1, "filename": "msgpack-asgi-1.0.0.tar.gz", "has_sig": false, "md5_digest": "5ee61ef3badfc0984873a348b266957c", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.6", "size": 7446, "upload_time": "2020-03-26T20:22:36", "upload_time_iso_8601": "2020-03-26T20:22:36.770164Z", "url": "https://files.pythonhosted.org/packages/bd/ea/d52c8a8be1a19ccdedf6ef5c3287110478dcd71b8183015d9a1cd85111b3/msgpack-asgi-1.0.0.tar.gz"}]}