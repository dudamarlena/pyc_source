{"info": {"author": "Jaime Zamorano", "author_email": "jzamoran@ucm.es", "bugtrack_url": null, "classifiers": ["Development Status :: 4 - Beta", "Environment :: Console", "Intended Audience :: Developers", "Intended Audience :: Science/Research", "License :: OSI Approved :: MIT License", "Operating System :: POSIX :: Linux", "Programming Language :: Python :: 2.7", "Programming Language :: Python :: 3.6", "Topic :: Scientific/Engineering :: Astronomy", "Topic :: Scientific/Engineering :: Atmospheric Science"], "description": "# azotea\n\nPipeline Python de reducci\u00f3n de datos para [AZOTEA](https://guaix.ucm.es/AZOTEA) (Astronom\u00eda Zenital desde el hOgar en Tiempos de Extremo Aislamiento).\n\nEsta es una herramienta de l\u00ednea de comandos.\n\n\n# Instalaci\u00f3n y actualizaci\u00f3n\n\nInstalar primero ***Python 3*** y su herramienta `pip`. Esta suele venir incluida en Linux y MacOS pero no as\u00ed en Windows. Una vez que tenemos esto, se instala AZOTEA como sigue:\n\n```bash\npip install --user azotea\n```\n\nPara actualizar a la \u00faltima versi\u00f3n de AZOTEA, teclear:\n\n```bash\npip install --user -U azotea\n```\n\n\nComprobar la version instalada\n\n```bash\n~$ azotea --version\n```\n\n```\nazotea 0.3.0\n```\n\n\n## Compatibilidad con Python 2\n\nAZOTEA *No es compatible con Python 2*\n\n# Configuracion\n\n## Configuraci\u00f3n global\n\nAntes de poder operar con AZOTEA hay que crear un fichero de configuraci\u00f3n para el observador.\nLa primera vez que se vaya a usar azotea, se puede hacer lo siguiente:\n\n```bash\n~$ azotea init\n```\n\n\nLa inicializaci\u00f3n crear\u00e1 un fichero `azotea.ini` en el directorio `$HOME/azotea/config` de cada usuario.\nEditar el fichero con un block de notas o similar. Los campos son descriptivos y no deber\u00eda haber ningin problema al rellenarlos.\n\n\n## Camaras soportadas\n\nAZOTEA se ir\u00e1 actualizando a medida que soporte m\u00e1s c\u00e1maras.\n\nLos modelos de camara soportados hasta el momento se pueden ver listando el fichero de configuracion interno\n\n```bash\nazotea config camera --list\n```\n\n***Uso Avanzado, no recomendado***: Si hay necesidad de crar una entrada m\u00e1s a este fichero, se puede hacer una copia de \u00e9l y luego editarlo de manera an\u00e1loga a la configuraci\u00f3n global. Este fichero no es para todo el mundo, s\u00f3lo los que entienden c\u00f3mo funciona el software deben hacerlo.\n\n\n```bash\nazotea config camera --create\n```\n\n```\n2020-04-01 19:25:12,998 [INFO] Created /home/rafa/azotea/config/camera.ini file\n```\n\nPara probar la c\u00e1mara comn este nuevo fichero en todos los comandos `azotea` posteriores hay que especificarlo como opci\u00f3n global antes de los comandos. Ejemplo:\n\n\n```bash\nazotea --camera mycamera.ini stats compute\n```\n\n# Operativa\n\n## ***La version corta***\n\nPara observadores impacientes que quieren reducir la observaci\u00f3n una noche en un directorio.\n\n1. Configurado el fichero `azotea.ini`, que debe residir en `$HOME/azotea/azotea.ini`\n\n2. Volcar *todas* las imagenes de la c\u00e1mara de una misma noche a un directorio de trabajo (p.e. `/home/rafa/demo/test`)\n\n3. Si hay tomas *dark*, renombrar dichas tomas a `dark_<nombre original>`\n\n4. \u00a1Por fin! ejecutar en una linea de comandos:\n\n```bash\nazotea image reduce --work-dir <directorio donde est\u00e1n las im\u00e1genes>\n```\n\nSi se desea detalle del proceso, ejecutar en su lugar\n\n```bash\nazotea --verbose image reduce --work-dir <directorio donde est\u00e1n las im\u00e1genes>\n```\n\n## Ejemplo de sesion de reducci\u00f3n\n\n1. Primera inicializacion\n\n```bash\n~$ azotea init\n```\n\n```\n2020-04-08 10:58:20,949 [INFO] Creating /home/rafa/azotea directory\n2020-04-08 10:58:20,951 [INFO] Creating /home/rafa/azotea/config directory\n2020-04-08 10:58:20,951 [INFO] Creating /home/rafa/azotea/dbase directory\n2020-04-08 10:58:20,951 [INFO] Creating /home/rafa/azotea/backup directory\n2020-04-08 10:58:20,951 [INFO] Creating /home/rafa/azotea/log directory\n2020-04-08 10:58:20,951 [INFO] Created /home/rafa/azotea/config/azotea.ini file, please review it\n2020-04-08 10:58:20,951 [INFO] Created database file /home/rafa/azotea/dbase/azotea.db\n2020-04-08 10:58:21,451 [INFO] Created data model from schema.sql\n2020-04-08 10:58:21,452 [INFO] Populating data model from auxiliar.sql\n```\n\n2. Reorganizacion de un lote de observaciones de varias noches\n\n```bash\n ~$ azotea reorganize images --input-dir mis_observaciones --output-dir zamorano\n```\n\n```\n2020-04-08 11:53:43,826 [INFO] read 6 images\n2020-04-08 11:53:43,826 [INFO] creating 2 output directories\n2020-04-08 11:53:43,826 [INFO] copying images to output directories\n2020-04-08 11:53:43,885 [INFO] copied 6 images\n```\n\n3. Reducci\u00f3n separada de cada noche\n\n***Noche del 25 al 26 de Marzo de 2020***\n\n```bash\n~$ azotea image reduce --work-dir zamorano/2020-03-25\n```\n\n```\n2020-04-08 11:57:19,807 [INFO] Opening configuration file /home/rafa/azotea/config/azotea.ini\n2020-04-08 11:57:19,807 [INFO] Found 3 candidate images\n2020-04-08 11:57:19,867 [INFO] 2020_03_2523_59_139999.CR2 from Canon EOS 450D being registered in database\n2020-04-08 11:57:19,922 [INFO] 2020_03_2522_50_529999.CR2 from Canon EOS 450D being registered in database\n2020-04-08 11:57:19,992 [INFO] 2020_03_2519_07_239999.CR2 from Canon EOS 450D being registered in database\n2020-04-08 11:57:20,064 [INFO] 3 new images registered in database\n2020-04-08 11:57:20,489 [INFO] 2020_03_2523_59_139999.CR2: ROI = [828:1328,519:919], \u03bc = [1082.4, 1105.8, 1104.8, 1067.0], \u03c3 = [41.3, 55.5, 59.4, 27.6] \n2020-04-08 11:57:20,875 [INFO] 2020_03_2522_50_529999.CR2: ROI = [828:1328,519:919], \u03bc = [1119.1, 1147.3, 1146.4, 1079.2], \u03c3 = [42.9, 53.3, 57.5, 22.0] \n2020-04-08 11:57:21,306 [INFO] 2020_03_2519_07_239999.CR2: ROI = [828:1328,519:919], \u03bc = [3688.1, 10030.8, 10050.6, 13061.8], \u03c3 = [496.2, 1303.5, 1298.6, 1311.0] \n2020-04-08 11:57:21,398 [INFO] 2020_03_2523_59_139999.CR2 is type LIGHT\n2020-04-08 11:57:21,398 [INFO] 2020_03_2522_50_529999.CR2 is type LIGHT\n2020-04-08 11:57:21,398 [INFO] 2020_03_2519_07_239999.CR2 is type LIGHT\n2020-04-08 11:57:21,466 [INFO] Saved data to session  CSV file /home/rafa/azotea/session-2020-03-25.csv\n```\n\n***Noche del 25 al 26 de Marzo de 2020***\n\n```bash\n~$ azotea image reduce --work-dir zamorano/2020-03-26\n```\n\n```\n2020-04-08 11:57:41,103 [INFO] Opening configuration file /home/rafa/azotea/config/azotea.ini\n2020-04-08 11:57:41,103 [INFO] Found 3 candidate images\n2020-04-08 11:57:41,163 [INFO] 2020_03_2600_00_199999.CR2 from Canon EOS 450D being registered in database\n2020-04-08 11:57:41,219 [INFO] 2020_03_2602_45_139999.CR2 from Canon EOS 450D being registered in database\n2020-04-08 11:57:41,274 [INFO] 2020_03_2604_31_319999.CR2 from Canon EOS 450D being registered in database\n2020-04-08 11:57:41,343 [INFO] 3 new images registered in database\n2020-04-08 11:57:41,756 [INFO] 2020_03_2600_00_199999.CR2: ROI = [828:1328,519:919], \u03bc = [1082.5, 1106.0, 1105.0, 1067.2], \u03c3 = [41.5, 55.3, 59.5, 27.7] \n2020-04-08 11:57:42,141 [INFO] 2020_03_2602_45_139999.CR2: ROI = [828:1328,519:919], \u03bc = [1085.3, 1110.0, 1109.3, 1068.6], \u03c3 = [37.6, 51.8, 55.8, 23.9] \n2020-04-08 11:57:42,524 [INFO] 2020_03_2604_31_319999.CR2: ROI = [828:1328,519:919], \u03bc = [1087.0, 1117.6, 1116.7, 1077.4], \u03c3 = [43.6, 86.3, 88.5, 64.9] \n2020-04-08 11:57:42,599 [INFO] 2020_03_2600_00_199999.CR2 is type LIGHT\n2020-04-08 11:57:42,599 [INFO] 2020_03_2602_45_139999.CR2 is type LIGHT\n2020-04-08 11:57:42,600 [INFO] 2020_03_2604_31_319999.CR2 is type LIGHT\n2020-04-08 11:57:42,667 [INFO] Saved data to session  CSV file /home/rafa/azotea/session-2020-03-26.csv\n```\n\nLa observacion de la noches se deja en los ficheros CSV `$HOME/azotea/session-2020-03-25.csv` y `$HOME/azotea/session-2020-03-26.csv` respectivamente\n\n4. Obtencion de un fichero global CSV con todas las mediciones de todas las sesiones de reduccion de datos\n\n```bash\n~$ azotea image export --all\n```\n\n```\n2020-04-08 11:58:33,750 [INFO] Saved data to global CSV file /home/rafa/azotea/azotea.csv\n```\n\n\n5. Volver a reprocesar un directorio \n\nSi hemos cambiado la region de interes en el fichero config.ini, \ndebemos reprocesar los directorios que nos interese, especificando la opcion --reset.\n\n\n```bash\n~$ azotea image reduce --reset --work-dir zamorano/2020-03-26\n```\n\n\n## Por si todo va mal ...\n\n\n```bash\n~$ azotea database clear\n```\n\n```\n2020-04-08 11:49:57,045 [INFO] Cleared data from database azotea.db\n```\n\nY a empezar el proceso desde el punto 3.\n\n# Procesado para varios observadores\n\n## Fichero de camaras\n\nPara ir a\u00f1adiendo camaras no conocidas hasta la fecha a un fichero:\n\n```bash\nazotea config camera --create\nemacs ~$/azotea/config/camera.ini\n```\n\n## Por cada observador:\n\n1. Preparar su fichero exclusivo de configuracion global y colocarlo en $HOME/azotea/config/\n\n```bash\ncp $HOME/azotea/config/azotea.ini $HOME/azotea/config/jizquierdo.ini\nemacs $HOME/azotea/config/jizquierdo.ini\n```\n\n2. Recolectar las im\u00e1genes de los observadores cada una en un direcorio distinto\n\n```bash\nmkdir contribuciones/jizquierdo\n```\n\n3. Reorganizar las imagenes por noche de observacion\n\n```bash\nazotea reorganize images --input-dir contribuciones/jizquierdo --output-dir clasificadas/jizquierdo\nls clasificadas/jizquierdo\n```\n\n4. Reducir las im\u00e1genes usuando su fichero de configuraci\u00f3n\n\n```\nazotea --config ~/azotea/config/jizquierdo.ini --camera ~/azotea/config/camera.ini image reduce --work-dir clasificadas/jizquierdo/<directorio de fecha>\n\n## Cuando hemos terminado\n\n1. Exportar el fichero global que incluye las contribuciones de todos los observadores\n\n\n```bash\n~$ azotea image export --all\n```\n\n\n## La version larga\n\n### P\u00eepeline de reducci\u00f3n de datos\n\nAZOTEA es un programa que lleva una peque\u00f1a base de datos incorporada para recordar los valores medidos y el estado de procesamiento de las imagenes. El usuario nunca trata con la base de datos directamente sino que actua con comandos. Las imagenes nunca se modifican ni se cambian de lugar y tipicamente se genera una sesion de procesado con el lote de im\u00e1genes del directorio de trabajo. Lo habitual ser\u00eda un directorio por d\u00eda lleno de imagenes.\n\nLos datos de inter\u00e9s se guardan en la base de datos y a partir de ellos se generan ficheros para publicar o compartir. \n\nSi la base de datos se corrompe o se borra, para recuperar su contenido habr\u00eda que correr el pipeline de reducci\u00f3m de im\u00e1genes con todos los directorios que se hayan generado, cosa no siempre posible. Por ello se incluyen comandos de backup de la base de datos.\n\nEl pipeline de AZOTEA consta de los siguientes pasos en secuencia:\n\n* Registro de las im\u00e1genes en la base de datos\n* Calculo de estad\u00edstcas en la regi\u00f3n de inter\u00e9s (ROI) (media y varianza)\n* Clasificacion de las imagenes den LIGHT y DARK para la sustracci\u00f3n de cuadro oscuro\n* Elaboraci\u00f3n de un DARK maestro por cada directorio de trabajo si es que hay im\u00e1genes de tipo DARK y sustracci\u00f3n del nivel de oscuro a las tomas de tipo LIGHT.\n* Exportaci\u00f3n de los resultados de la sesion de reducci\u00f3n. En la actualidad s\u00f3lo se soporta un solo formato de tipo CSV\n\nTodos estos pasos se efectuan secuencialmente con `azotea image reduce`\nOpcionalmente se puede invocar `azotea image export --all` sin especificar directorio de trabajo para exportar en un sencillo CSV todas las seisones de reducci\u00f3n.\n\n### Otros comandos\n\nAZOTEA tiene otros comandos para\n1. efectuar y listar backups de la base de datos\n2. limpiar o recrear la base de datos desde cero.\n\n# Ficheros CSV de salida\n\nEl pipeline de reducci\u00f3n genera dos ficheros CSV:\n\n* Un fichero global CSV donde se van acumulando todos los datos de todos los lotes procesados hasta el momento: `azotea.csv`\n\n* Un fichero CSV con los resultados de la reducci\u00f3n del \u00faltimo lote. Si el lote solo abarca un directorio de trabajo, el nombre ser\u00e1 `session-<directorio de trabajo>.csv`. Si el lote comprende varios directorios de trabajo, el fichero incluye el identificador del lote, no el directorio de trabajo `session-YYYYMMDDHHMMSS.csv` (Ejemplo: `session-20200402103223.csv`)\n\n\nAmbos ficheros se situan en la el directorio raiz (`$HOME`) de cada usuario.\n\nEl fichero CSV tiene una cabecera con los nombres de las columnas, a saber:\n\n\n|    Columna      |  Descripcion                                           |\n|:---------------:|:-------------------------------------------------------|\n| session         | Id. de sesion de reducci\u00f3n de datos (YYYYMMDDHHMMSS).  |\n| observer        | Nombre del observador.                                 |\n| organization    | Organizacion a la que pertenece el observador.         |\n| location        | Localidad desde donde ha sido tomada la imagen.        |\n| type            | Tipo de imagen (LIGHT/DARK)                            |\n| tstamp          | Fecha y hora de la imagen, formato ISO 8601            |\n| name            | Nombre de la imagen (=nombre del fichero sin la ruta.) |\n| model           | Modelo de c\u00e1mara.                                      |\n| ISO             | Sensibilidad ISO de la toma.                           |\n| roi             | Region de inter\u00e9s [x1:x2, y1:y2]                       |\n| dark_roi        | Region de interes para medida oscura [x1:x2, y1:y2]    |\n| exptime         | Tiempo de exposicion                                   |\n| mean_signal_R1  | Promedio de se\u00f1al canal R.                             |\n| stdev_signal_R1 | Desviaci\u00f3n tipica se\u00f1al del canal R.                   |\n| mean_signal_G2  | Promedio de se\u00f1al en un canal G.                       |\n| stdev_signal_G2 | Desviaci\u00f3n tipica de se\u00f1al en un canal G.              |\n| mean_signal_G3  | Promedio de se\u00f1al en el otro canal G.                  |\n| stdev_signal_G3 | Desviaci\u00f3n tipica de se\u00f1al en el otro canal G.         |\n| mean_signal_B4  | Promedio de se\u00f1al del canal B.                         |\n| stdev_signal_B4 | Desviaci\u00f3n tipica se\u00f1al del canal B.                   |\n\n# Referencia de comandos\n\n1. Version del programa\n\n```bash \nazotea --version\n```\n\n2. Comandos\n\nLa lista de comandos soportados por AZOTEA puede ir cambiando con las versiones. A\u00fan as\u00ed siempre se podr\u00e1n averiguar todos con la opcion --help en cada nivel.\n\n\nLa invocaci\u00f3n de AZOTEA tiene la forma general de:\n\n```\nazotea [--opcion1, --opcion2, ...] <comando>  <subcomando> [--opcion3, --opcion4, ...]\n```\n\nCada comando y subcomando dentro del comando tienen su propia ayuda:\n\n```bash\nazotea --help\nazotea <comando> --help\nazotea <comando> <subcomando> --help\n```\n\nEjemplos:\n\n```bash\nazotea --help\nazotea image --help\nazotea image list --help\n```", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://guaix.ucm.es/AZOTEA", "keywords": "Astronomy Python LightPollution", "license": "MIT", "maintainer": "", "maintainer_email": "", "name": "azotea", "package_url": "https://pypi.org/project/azotea/", "platform": "", "project_url": "https://pypi.org/project/azotea/", "project_urls": {"Homepage": "https://guaix.ucm.es/AZOTEA"}, "release_url": "https://pypi.org/project/azotea/0.3.1/", "requires_dist": null, "requires_python": "", "summary": "('command line tool to reduce DSLR RAW images',)", "version": "0.3.1"}, "last_serial": 7017295, "releases": {"0.3.1": [{"comment_text": "", "digests": {"md5": "ac0e9158fcedb4cfdddfa00ff65ecd70", "sha256": "bc49ab519147c33122a6e4b49c80b627beba0f7a6cad0dcb6603ecc6fe317019"}, "downloads": -1, "filename": "azotea-0.3.1.tar.gz", "has_sig": false, "md5_digest": "ac0e9158fcedb4cfdddfa00ff65ecd70", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 46979, "upload_time": "2020-04-14T13:53:11", "upload_time_iso_8601": "2020-04-14T13:53:11.629731Z", "url": "https://files.pythonhosted.org/packages/7f/10/624e3dc34cb03c6b43147b1b64da2424ac29fcba24171b6dce8be28fb7ef/azotea-0.3.1.tar.gz"}]}, "urls": [{"comment_text": "", "digests": {"md5": "ac0e9158fcedb4cfdddfa00ff65ecd70", "sha256": "bc49ab519147c33122a6e4b49c80b627beba0f7a6cad0dcb6603ecc6fe317019"}, "downloads": -1, "filename": "azotea-0.3.1.tar.gz", "has_sig": false, "md5_digest": "ac0e9158fcedb4cfdddfa00ff65ecd70", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 46979, "upload_time": "2020-04-14T13:53:11", "upload_time_iso_8601": "2020-04-14T13:53:11.629731Z", "url": "https://files.pythonhosted.org/packages/7f/10/624e3dc34cb03c6b43147b1b64da2424ac29fcba24171b6dce8be28fb7ef/azotea-0.3.1.tar.gz"}]}