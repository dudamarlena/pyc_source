# uncompyle6 version 3.7.4
# Python bytecode 2.7 (62211)
# Decompiled from: Python 3.6.9 (default, Apr 18 2020, 01:56:04) 
# [GCC 8.4.0]
# Embedded file name: build/bdist.linux-x86_64/egg/insights/parsers/tests/test_cpuinfo.py
# Compiled at: 2020-03-25 13:10:41
from insights.parsers.cpuinfo import CpuInfo
from insights.parsers import cpuinfo
from insights.tests import context_wrap
import doctest
CPUINFO = ('\nCOMMAND> cat /proc/cpuinfo\nCOMMAND> cat /proc/cpuinfo\nprocessor       : 0\nvendor_id       : GenuineIntel\ncpu family      : 6\nmodel           : 45\nmodel name      : Intel(R) Xeon(R) CPU E5-2690 0 @ 2.90GHz\nstepping        : 2\nmicrocode       : 1808\ncpu MHz         : 2900.000\ncache size      : 20480 KB\nphysical id     : 0\nsiblings        : 1\ncore id         : 0\ncpu cores       : 1\napicid          : 0\nflags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc art arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 fma cx16 xtpr pdcm pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm 3dnowprefetch epb intel_pt tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 hle avx2 smep bmi2 erms invpcid rtm mpx rdseed adx smap clflushopt xsaveopt xsavec xgetbv1 dtherm ida arat pln pts hwp hwp_notify hwp_act_window hwp_epp\naddress sizes   : 40 bits physical, 48 bits virtual\nbugs            : cpu_meltdown spectre_v1 spectre_v2 spec_store_bypass l1tf mds swapgs taa itlb_multihit\n\nprocessor       : 1\nvendor_id       : GenuineIntel\ncpu family      : 6\nmodel           : 45\nmodel name      : Intel(R) Xeon(R) CPU E5-2690 0 @ 2.90GHz\nstepping        : 2\nmicrocode       : 1808\ncpu MHz         : 2900.000\ncache size      : 20480 KB\nphysical id     : 2\nsiblings        : 1\ncore id         : 0\ncpu cores       : 1\napicid          : 2\nflags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc art arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 fma cx16 xtpr pdcm pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm 3dnowprefetch epb intel_pt tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 hle avx2 smep bmi2 erms invpcid rtm mpx rdseed adx smap clflushopt xsaveopt xsavec xgetbv1 dtherm ida arat pln pts hwp hwp_notify hwp_act_window hwp_epp\naddress sizes   : 40 bits physical, 48 bits virtual\nbugs            : cpu_meltdown spectre_v1 spectre_v2 spec_store_bypass l1tf mds swapgs taa itlb_multihit\n').strip()
ONE_SOCKET_CPUINFO = '\nprocessor\t: 0\nvendor_id\t: GenuineIntel\ncpu family\t: 6\nmodel\t\t: 60\nmodel name\t: Intel(R) Core(TM) i7-4800MQ CPU @ 2.70GHz\nstepping\t: 3\nmicrocode\t: 0x1c\ncpu MHz\t\t: 3154.042\ncache size\t: 6144 KB\nphysical id\t: 0\nsiblings\t: 8\ncore id\t\t: 0\ncpu cores\t: 4\napicid\t\t: 0\ninitial apicid\t: 0\nfpu\t\t: yes\nfpu_exception\t: yes\ncpuid level\t: 13\nwp\t\t: yes\nflags\t\t: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 fma cx16 xtpr pdcm pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm ida arat epb pln pts dtherm tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid xsaveopt\nbogomips\t: 5388.09\nclflush size\t: 64\ncache_alignment\t: 64\naddress sizes\t: 39 bits physical, 48 bits virtual\npower management:\n\nprocessor\t: 1\nvendor_id\t: GenuineIntel\ncpu family\t: 6\nmodel\t\t: 60\nmodel name\t: Intel(R) Core(TM) i7-4800MQ CPU @ 2.70GHz\nstepping\t: 3\nmicrocode\t: 0x1c\ncpu MHz\t\t: 3160.371\ncache size\t: 6144 KB\nphysical id\t: 0\nsiblings\t: 8\ncore id\t\t: 0\ncpu cores\t: 4\napicid\t\t: 1\ninitial apicid\t: 1\nfpu\t\t: yes\nfpu_exception\t: yes\ncpuid level\t: 13\nwp\t\t: yes\nflags\t\t: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 fma cx16 xtpr pdcm pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm ida arat epb pln pts dtherm tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid xsaveopt\nbogomips\t: 5388.09\nclflush size\t: 64\ncache_alignment\t: 64\naddress sizes\t: 39 bits physical, 48 bits virtual\npower management:\n\nprocessor\t: 2\nvendor_id\t: GenuineIntel\ncpu family\t: 6\nmodel\t\t: 60\nmodel name\t: Intel(R) Core(TM) i7-4800MQ CPU @ 2.70GHz\nstepping\t: 3\nmicrocode\t: 0x1c\ncpu MHz\t\t: 3149.929\ncache size\t: 6144 KB\nphysical id\t: 0\nsiblings\t: 8\ncore id\t\t: 1\ncpu cores\t: 4\napicid\t\t: 2\ninitial apicid\t: 2\nfpu\t\t: yes\nfpu_exception\t: yes\ncpuid level\t: 13\nwp\t\t: yes\nflags\t\t: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 fma cx16 xtpr pdcm pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm ida arat epb pln pts dtherm tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid xsaveopt\nbogomips\t: 5388.09\nclflush size\t: 64\ncache_alignment\t: 64\naddress sizes\t: 39 bits physical, 48 bits virtual\npower management:\n\nprocessor\t: 3\nvendor_id\t: GenuineIntel\ncpu family\t: 6\nmodel\t\t: 60\nmodel name\t: Intel(R) Core(TM) i7-4800MQ CPU @ 2.70GHz\nstepping\t: 3\nmicrocode\t: 0x1c\ncpu MHz\t\t: 3149.929\ncache size\t: 6144 KB\nphysical id\t: 0\nsiblings\t: 8\ncore id\t\t: 1\ncpu cores\t: 4\napicid\t\t: 3\ninitial apicid\t: 3\nfpu\t\t: yes\nfpu_exception\t: yes\ncpuid level\t: 13\nwp\t\t: yes\nflags\t\t: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 fma cx16 xtpr pdcm pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm ida arat epb pln pts dtherm tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid xsaveopt\nbogomips\t: 5388.09\nclflush size\t: 64\ncache_alignment\t: 64\naddress sizes\t: 39 bits physical, 48 bits virtual\npower management:\n\nprocessor\t: 4\nvendor_id\t: GenuineIntel\ncpu family\t: 6\nmodel\t\t: 60\nmodel name\t: Intel(R) Core(TM) i7-4800MQ CPU @ 2.70GHz\nstepping\t: 3\nmicrocode\t: 0x1c\ncpu MHz\t\t: 3153.937\ncache size\t: 6144 KB\nphysical id\t: 0\nsiblings\t: 8\ncore id\t\t: 2\ncpu cores\t: 4\napicid\t\t: 4\ninitial apicid\t: 4\nfpu\t\t: yes\nfpu_exception\t: yes\ncpuid level\t: 13\nwp\t\t: yes\nflags\t\t: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 fma cx16 xtpr pdcm pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm ida arat epb pln pts dtherm tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid xsaveopt\nbogomips\t: 5388.09\nclflush size\t: 64\ncache_alignment\t: 64\naddress sizes\t: 39 bits physical, 48 bits virtual\npower management:\n\nprocessor\t: 5\nvendor_id\t: GenuineIntel\ncpu family\t: 6\nmodel\t\t: 60\nmodel name\t: Intel(R) Core(TM) i7-4800MQ CPU @ 2.70GHz\nstepping\t: 3\nmicrocode\t: 0x1c\ncpu MHz\t\t: 3160.371\ncache size\t: 6144 KB\nphysical id\t: 0\nsiblings\t: 8\ncore id\t\t: 2\ncpu cores\t: 4\napicid\t\t: 5\ninitial apicid\t: 5\nfpu\t\t: yes\nfpu_exception\t: yes\ncpuid level\t: 13\nwp\t\t: yes\nflags\t\t: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 fma cx16 xtpr pdcm pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm ida arat epb pln pts dtherm tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid xsaveopt\nbogomips\t: 5388.09\nclflush size\t: 64\ncache_alignment\t: 64\naddress sizes\t: 39 bits physical, 48 bits virtual\npower management:\n\nprocessor\t: 6\nvendor_id\t: GenuineIntel\ncpu family\t: 6\nmodel\t\t: 60\nmodel name\t: Intel(R) Core(TM) i7-4800MQ CPU @ 2.70GHz\nstepping\t: 3\nmicrocode\t: 0x1c\ncpu MHz\t\t: 3154.042\ncache size\t: 6144 KB\nphysical id\t: 0\nsiblings\t: 8\ncore id\t\t: 3\ncpu cores\t: 4\napicid\t\t: 6\ninitial apicid\t: 6\nfpu\t\t: yes\nfpu_exception\t: yes\ncpuid level\t: 13\nwp\t\t: yes\nflags\t\t: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 fma cx16 xtpr pdcm pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm ida arat epb pln pts dtherm tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid xsaveopt\nbogomips\t: 5388.09\nclflush size\t: 64\ncache_alignment\t: 64\naddress sizes\t: 39 bits physical, 48 bits virtual\npower management:\n\nprocessor\t: 7\nvendor_id\t: GenuineIntel\ncpu family\t: 6\nmodel\t\t: 60\nmodel name\t: Intel(R) Core(TM) i7-4800MQ CPU @ 2.70GHz\nstepping\t: 3\nmicrocode\t: 0x1c\ncpu MHz\t\t: 3133.687\ncache size\t: 6144 KB\nphysical id\t: 0\nsiblings\t: 8\ncore id\t\t: 3\ncpu cores\t: 4\napicid\t\t: 7\ninitial apicid\t: 7\nfpu\t\t: yes\nfpu_exception\t: yes\ncpuid level\t: 13\nwp\t\t: yes\nflags\t\t: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 fma cx16 xtpr pdcm pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm ida arat epb pln pts dtherm tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid xsaveopt\nbogomips\t: 5388.09\nclflush size\t: 64\ncache_alignment\t: 64\naddress sizes\t: 39 bits physical, 48 bits virtual\npower management:\n\n'
ARM_CPUINFO = '\nprocessor       : 0\nmodel name      : ARMv7 Processor rev 5 (v7l)\nBogoMIPS        : 38.40\nFeatures        : half thumb fastmult vfp edsp neon vfpv3 tls vfpv4 idiva idivt vfpd32 lpae evtstrm\nCPU implementer : 0x41\nCPU architecture: 7\nCPU variant     : 0x0\nCPU part        : 0xc07\nCPU revision    : 5\n\nprocessor       : 1\nmodel name      : ARMv7 Processor rev 5 (v7l)\nBogoMIPS        : 38.40\nFeatures        : half thumb fastmult vfp edsp neon vfpv3 tls vfpv4 idiva idivt vfpd32 lpae evtstrm\nCPU implementer : 0x41\nCPU architecture: 7\nCPU variant     : 0x0\nCPU part        : 0xc07\nCPU revision    : 5\n\nprocessor       : 2\nmodel name      : ARMv7 Processor rev 5 (v7l)\nBogoMIPS        : 38.40\nFeatures        : half thumb fastmult vfp edsp neon vfpv3 tls vfpv4 idiva idivt vfpd32 lpae evtstrm\nCPU implementer : 0x41\nCPU architecture: 7\nCPU variant     : 0x0\nCPU part        : 0xc07\nCPU revision    : 5\n\nprocessor       : 3\nmodel name      : ARMv7 Processor rev 5 (v7l)\nBogoMIPS        : 38.40\nFeatures        : half thumb fastmult vfp edsp neon vfpv3 tls vfpv4 idiva idivt vfpd32 lpae evtstrm\nCPU implementer : 0x41\nCPU architecture: 7\nCPU variant     : 0x0\nCPU part        : 0xc07\nCPU revision    : 5\n\nHardware        : BCM2709\nRevision        : a01041\n'
POWER_CPUINFO = '\nprocessor\t: 0\ncpu\t\t: POWER7 (architected), altivec supported\nclock\t\t: 3612.000000MHz\nrevision\t: 2.0 (pvr 004a 0200)\n\nprocessor\t: 1\ncpu\t\t: POWER7 (architected), altivec supported\nclock\t\t: 3612.000000MHz\nrevision\t: 2.0 (pvr 004a 0200)\n\nprocessor\t: 2\ncpu\t\t: POWER7 (architected), altivec supported\nclock\t\t: 3612.000000MHz\nrevision\t: 2.0 (pvr 004a 0200)\n\nprocessor\t: 3\ncpu\t\t: POWER7 (architected), altivec supported\nclock\t\t: 3612.000000MHz\nrevision\t: 2.0 (pvr 004a 0200)\n\nprocessor\t: 4\ncpu\t\t: POWER7 (architected), altivec supported\nclock\t\t: 3612.000000MHz\nrevision\t: 2.0 (pvr 004a 0200)\n\nprocessor\t: 5\ncpu\t\t: POWER7 (architected), altivec supported\nclock\t\t: 3612.000000MHz\nrevision\t: 2.0 (pvr 004a 0200)\n\nprocessor\t: 6\ncpu\t\t: POWER7 (architected), altivec supported\nclock\t\t: 3612.000000MHz\nrevision\t: 2.0 (pvr 004a 0200)\n\nprocessor\t: 7\ncpu\t\t: POWER7 (architected), altivec supported\nclock\t\t: 3612.000000MHz\nrevision\t: 2.0 (pvr 004a 0200)\n\nprocessor\t: 8\ncpu\t\t: POWER7 (architected), altivec supported\nclock\t\t: 3612.000000MHz\nrevision\t: 2.0 (pvr 004a 0200)\n\nprocessor\t: 9\ncpu\t\t: POWER7 (architected), altivec supported\nclock\t\t: 3612.000000MHz\nrevision\t: 2.0 (pvr 004a 0200)\n\nprocessor\t: 10\ncpu\t\t: POWER7 (architected), altivec supported\nclock\t\t: 3612.000000MHz\nrevision\t: 2.0 (pvr 004a 0200)\n\nprocessor\t: 11\ncpu\t\t: POWER7 (architected), altivec supported\nclock\t\t: 3612.000000MHz\nrevision\t: 2.0 (pvr 004a 0200)\n\nprocessor\t: 12\ncpu\t\t: POWER7 (architected), altivec supported\nclock\t\t: 3612.000000MHz\nrevision\t: 2.0 (pvr 004a 0200)\n\nprocessor\t: 13\ncpu\t\t: POWER7 (architected), altivec supported\nclock\t\t: 3612.000000MHz\nrevision\t: 2.0 (pvr 004a 0200)\n\nprocessor\t: 14\ncpu\t\t: POWER7 (architected), altivec supported\nclock\t\t: 3612.000000MHz\nrevision\t: 2.0 (pvr 004a 0200)\n\nprocessor\t: 15\ncpu\t\t: POWER7 (architected), altivec supported\nclock\t\t: 3612.000000MHz\nrevision\t: 2.0 (pvr 004a 0200)\n\nprocessor\t: 16\ncpu\t\t: POWER7 (architected), altivec supported\nclock\t\t: 3612.000000MHz\nrevision\t: 2.0 (pvr 004a 0200)\n\nprocessor\t: 17\ncpu\t\t: POWER7 (architected), altivec supported\nclock\t\t: 3612.000000MHz\nrevision\t: 2.0 (pvr 004a 0200)\n\nprocessor\t: 18\ncpu\t\t: POWER7 (architected), altivec supported\nclock\t\t: 3612.000000MHz\nrevision\t: 2.0 (pvr 004a 0200)\n\nprocessor\t: 19\ncpu\t\t: POWER7 (architected), altivec supported\nclock\t\t: 3612.000000MHz\nrevision\t: 2.0 (pvr 004a 0200)\n\nprocessor\t: 20\ncpu\t\t: POWER7 (architected), altivec supported\nclock\t\t: 3612.000000MHz\nrevision\t: 2.0 (pvr 004a 0200)\n\nprocessor\t: 21\ncpu\t\t: POWER7 (architected), altivec supported\nclock\t\t: 3612.000000MHz\nrevision\t: 2.0 (pvr 004a 0200)\n\nprocessor\t: 22\ncpu\t\t: POWER7 (architected), altivec supported\nclock\t\t: 3612.000000MHz\nrevision\t: 2.0 (pvr 004a 0200)\n\nprocessor\t: 23\ncpu\t\t: POWER7 (architected), altivec supported\nclock\t\t: 3612.000000MHz\nrevision\t: 2.0 (pvr 004a 0200)\n\nprocessor\t: 24\ncpu\t\t: POWER7 (architected), altivec supported\nclock\t\t: 3612.000000MHz\nrevision\t: 2.0 (pvr 004a 0200)\n\nprocessor\t: 25\ncpu\t\t: POWER7 (architected), altivec supported\nclock\t\t: 3612.000000MHz\nrevision\t: 2.0 (pvr 004a 0200)\n\nprocessor\t: 26\ncpu\t\t: POWER7 (architected), altivec supported\nclock\t\t: 3612.000000MHz\nrevision\t: 2.0 (pvr 004a 0200)\n\nprocessor\t: 27\ncpu\t\t: POWER7 (architected), altivec supported\nclock\t\t: 3612.000000MHz\nrevision\t: 2.0 (pvr 004a 0200)\n\ntimebase\t: 512000000\nplatform\t: pSeries\nmodel\t\t: IBM,8231-E2D\nmachine\t\t: CHRP IBM,8231-E2D\n'

def test_cpuinfo():
    cpu_info = CpuInfo(context_wrap(CPUINFO))
    assert cpu_info.cpu_count == 2
    assert cpu_info.apicid == ['0', '2']
    assert cpu_info.socket_count == 2
    assert cpu_info.vendor == 'GenuineIntel'
    assert cpu_info.model_name == 'Intel(R) Xeon(R) CPU E5-2690 0 @ 2.90GHz'
    assert cpu_info.get_processor_by_index(0) == {'cpus': '0', 
       'vendors': 'GenuineIntel', 
       'families': '6', 
       'model_ids': '45', 
       'models': 'Intel(R) Xeon(R) CPU E5-2690 0 @ 2.90GHz', 
       'stepping': '2', 
       'clockspeeds': '2900.000', 
       'cache_sizes': '20480 KB', 
       'sockets': '0', 
       'cpu_cores': '1', 
       'apicid': '0', 
       'flags': 'fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc art arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 fma cx16 xtpr pdcm pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm 3dnowprefetch epb intel_pt tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 hle avx2 smep bmi2 erms invpcid rtm mpx rdseed adx smap clflushopt xsaveopt xsavec xgetbv1 dtherm ida arat pln pts hwp hwp_notify hwp_act_window hwp_epp', 
       'address_sizes': '40 bits physical, 48 bits virtual', 
       'bugs': 'cpu_meltdown spectre_v1 spectre_v2 spec_store_bypass l1tf mds swapgs taa itlb_multihit'}
    assert cpu_info.cpu_speed == '2900.000'
    assert cpu_info.cache_size == '20480 KB'
    assert cpu_info.model_number == '45'
    assert 'mmx' in cpu_info.flags
    assert 'avx512f' not in cpu_info.flags
    for i, cpu in enumerate(cpu_info):
        assert cpu['cpus'] == str(i)


def test_one_socket_cpuinfo():
    cpu_info = CpuInfo(context_wrap(ONE_SOCKET_CPUINFO))
    assert cpu_info.cpu_count == 8
    assert cpu_info.socket_count == 1
    assert cpu_info.core_total == 32


def test_empty_cpuinfo():
    cpu_info = CpuInfo(context_wrap(''))
    assert cpu_info.cpu_count == 0
    assert cpu_info.core_total is None
    return


def test_arm_cpuinfo():
    cpu_info = CpuInfo(context_wrap(ARM_CPUINFO))
    assert cpu_info.cpu_count == 4
    assert cpu_info.socket_count == 0
    for i, cpu in enumerate(cpu_info):
        assert cpu['models'] == 'ARMv7 Processor rev 5 (v7l)'
        assert cpu['features'] == 'half thumb fastmult vfp edsp neon vfpv3 tls vfpv4 idiva idivt vfpd32 lpae evtstrm'
        assert cpu['cpu_implementer'] == '0x41'
        assert cpu['cpu_architecture'] == '7'
        assert cpu['cpu_variant'] == '0x0'
        assert cpu['cpu_part'] == '0xc07'
        assert cpu['cpu_revision'] == '5'


def test_power_cpuinfo():
    cpu_info = CpuInfo(context_wrap(POWER_CPUINFO))
    assert cpu_info.cpu_count == 28
    assert cpu_info.socket_count == 0
    for i, cpu in enumerate(cpu_info):
        assert cpu['cpu'] == 'POWER7 (architected), altivec supported'
        assert cpu['revision'] == '2.0 (pvr 004a 0200)'


def test_cpuinfo_doc_examples():
    env = {'cpu_info': CpuInfo(context_wrap(CPUINFO))}
    failed, total = doctest.testmod(cpuinfo, globs=env)
    assert failed == 0