# uncompyle6 version 3.7.4
# Python bytecode 2.7 (62211)
# Decompiled from: Python 3.6.9 (default, Apr 18 2020, 01:56:04) 
# [GCC 8.4.0]
# Embedded file name: build/bdist.linux-x86_64/egg/insights/parsers/tests/test_podman_inspect.py
# Compiled at: 2019-11-14 13:57:46
import pytest, doctest
from insights.parsers import podman_inspect, SkipException
from insights.tests import context_wrap
PODMAN_CONTAINER_INSPECT = ('\n[\n    {\n        "ID": "66db151828e9beede0cdd9c17fc9bd5ebb5d125dd036f7230bc6b6433e5c0dda",\n        "Created": "2019-08-21T10:38:34.753548542Z",\n        "Path": "dumb-init",\n        "Args": [\n            "--single-child",\n            "--",\n            "kolla_start"\n        ],\n        "State": {\n            "OciVersion": "1.0.1-dev",\n            "Status": "running",\n            "Running": true,\n            "Paused": false,\n            "Restarting": false,\n            "OOMKilled": false,\n            "Dead": false,\n            "Pid": 6606,\n            "ExitCode": 0,\n            "Error": "",\n            "StartedAt": "2019-09-06T19:16:08.066138727Z",\n            "FinishedAt": "0001-01-01T00:00:00Z"\n        },\n        "Image": "a6b8f27df9feb9d820527d413f24ec9b1fcfb12049dd91af5fc188636bebe504",\n        "ImageName": "192.168.24.1:8787/rhosp15/openstack-gnocchi-metricd:20190819.1",\n        "Rootfs": "",\n        "ResolvConfPath": "/var/run/containers/storage/overlay-containers/66db151828e9beede0cdd9c17fc9bd5ebb5d125dd036f7230bc6b6433e5c0dda/userdata/resolv.conf",\n        "HostnamePath": "/var/run/containers/storage/overlay-containers/66db151828e9beede0cdd9c17fc9bd5ebb5d125dd036f7230bc6b6433e5c0dda/userdata/hostname",\n        "HostsPath": "/var/run/containers/storage/overlay-containers/66db151828e9beede0cdd9c17fc9bd5ebb5d125dd036f7230bc6b6433e5c0dda/userdata/hosts",\n        "StaticDir": "/var/lib/containers/storage/overlay-containers/66db151828e9beede0cdd9c17fc9bd5ebb5d125dd036f7230bc6b6433e5c0dda/userdata",\n        "LogPath": "/var/log/containers/stdouts/gnocchi_metricd.log",\n        "Name": "gnocchi_metricd",\n        "RestartCount": 0,\n        "Driver": "overlay",\n        "MountLabel": "system_u:object_r:container_file_t:s0:c514,c813",\n        "ProcessLabel": "system_u:system_r:container_t:s0:c514,c813",\n        "AppArmorProfile": "",\n        "EffectiveCaps": null,\n        "BoundingCaps": [\n            "CAP_CHOWN",\n            "CAP_DAC_OVERRIDE",\n            "CAP_FSETID",\n            "CAP_FOWNER",\n            "CAP_MKNOD",\n            "CAP_NET_RAW",\n            "CAP_SETGID",\n            "CAP_SETUID",\n            "CAP_SETFCAP",\n            "CAP_SETPCAP",\n            "CAP_NET_BIND_SERVICE",\n            "CAP_SYS_CHROOT",\n            "CAP_KILL",\n            "CAP_AUDIT_WRITE"\n        ],\n        "ExecIDs": [],\n        "GraphDriver": {\n            "Name": "overlay",\n            "Data": {\n                "LowerDir": "/var/lib/containers/storage/overlay/8cf325ff3583d7b6e10f170f85605e14797460f4ee0fa8d4eef2176c27627a26/diff:/var/lib/containers/storage/overlay/3fcda38b3b3199f8d0a1aa61a20d9561ba4ca4805e09ae18d6b50f2854cd5091/diff:/var/lib/containers/storage/overlay/1344d596d37069ebcdd447b67559396b6d046f2f98a63093f229621c544da013/diff:/var/lib/containers/storage/overlay/4faa8d5827f59db011a639ea73621234812291ff51d875f58e1e4197c6239429/diff:/var/lib/containers/storage/overlay/671441d9601355a777b2ce9afceef5a7d0d4890d11ef4f5744e534394ef7c447/diff:/var/lib/containers/storage/overlay/c7269138daa6b23e16efdcbf7ee323ba42fba93eb2406192ac22631bdd0cb4e3/diff",\n                "MergedDir": "/var/lib/containers/storage/overlay/87b994364ae69db1d3d8ff1e19a5882f230514bce4a3362ee25bfe618f9fa5ee/merged",\n                "UpperDir": "/var/lib/containers/storage/overlay/87b994364ae69db1d3d8ff1e19a5882f230514bce4a3362ee25bfe618f9fa5ee/diff",\n                "WorkDir": "/var/lib/containers/storage/overlay/87b994364ae69db1d3d8ff1e19a5882f230514bce4a3362ee25bfe618f9fa5ee/work"\n            }\n        },\n        "Mounts": [\n            {\n                "destination": "/sys",\n                "type": "sysfs",\n                "source": "sysfs",\n                "options": [\n                    "nosuid",\n                    "noexec",\n                    "nodev",\n                    "ro"\n                ]\n            },\n            {\n                "destination": "/dev",\n                "type": "tmpfs",\n                "source": "tmpfs",\n                "options": [\n                    "nosuid",\n                    "strictatime",\n                    "mode=755",\n                    "size=65536k"\n                ]\n            },\n            {\n                "destination": "/etc/pki/ca-trust/source/anchors",\n                "type": "bind",\n                "source": "/etc/pki/ca-trust/source/anchors",\n                "options": [\n                    "ro",\n                    "rbind",\n                    "rprivate"\n                ]\n            },\n            {\n                "destination": "/var/lib/kolla/config_files/src-ceph",\n                "type": "bind",\n                "source": "/etc/ceph",\n                "options": [\n                    "ro",\n                    "rbind",\n                    "rprivate"\n                ]\n            }\n        ],\n        "Dependencies": [],\n        "NetworkSettings": {\n            "Bridge": "",\n            "SandboxID": "",\n            "HairpinMode": false,\n            "LinkLocalIPv6Address": "",\n            "LinkLocalIPv6PrefixLen": 0,\n            "Ports": [],\n            "SandboxKey": "",\n            "SecondaryIPAddresses": null,\n            "SecondaryIPv6Addresses": null,\n            "EndpointID": "",\n            "Gateway": "",\n            "GlobalIPv6Address": "",\n            "GlobalIPv6PrefixLen": 0,\n            "IPAddress": "",\n            "IPPrefixLen": 0,\n            "IPv6Gateway": "",\n            "MacAddress": ""\n        },\n        "ExitCommand": [\n            "/usr/bin/podman",\n            "--root",\n            "/var/lib/containers/storage",\n            "--runroot",\n            "/var/run/containers/storage",\n            "--log-level",\n            "error",\n            "--cgroup-manager",\n            "systemd",\n            "--tmpdir",\n            "/var/run/libpod",\n            "--storage-driver",\n            "overlay",\n            "container",\n            "cleanup",\n            "66db151828e9beede0cdd9c17fc9bd5ebb5d125dd036f7230bc6b6433e5c0dda"\n        ],\n        "Namespace": "",\n        "IsInfra": false,\n        "HostConfig": {\n            "ContainerIDFile": "",\n            "LogConfig": null,\n            "NetworkMode": "host",\n            "PortBindings": null,\n            "AutoRemove": false,\n            "CapAdd": [],\n            "CapDrop": [],\n            "DNS": [],\n            "DNSOptions": [],\n            "DNSSearch": [],\n            "ExtraHosts": null,\n            "GroupAdd": null,\n            "IpcMode": "",\n            "Cgroup": "host",\n            "OomScoreAdj": 0,\n            "PidMode": "",\n            "Privileged": false,\n            "PublishAllPorts": false,\n            "ReadonlyRootfs": false,\n            "SecurityOpt": [],\n            "UTSMode": "",\n            "UsernsMode": "",\n            "ShmSize": 65536000,\n            "Runtime": "runc",\n            "ConsoleSize": null,\n            "CpuShares": null,\n            "Memory": 0,\n            "NanoCpus": 0,\n            "CgroupParent": "",\n            "BlkioWeight": null,\n            "BlkioWeightDevice": null,\n            "BlkioDeviceReadBps": null,\n            "BlkioDeviceWriteBps": null,\n            "BlkioDeviceReadIOps": null,\n            "BlkioDeviceWriteIOps": null,\n            "CpuPeriod": null,\n            "CpuQuota": null,\n            "CpuRealtimePeriod": null,\n            "CpuRealtimeRuntime": null,\n            "CpuSetCpus": "",\n            "CpuSetMems": "",\n            "Devices": null,\n            "DiskQuota": 0,\n            "KernelMemory": null,\n            "MemoryReservation": null,\n            "MemorySwap": null,\n            "MemorySwappiness": null,\n            "OomKillDisable": false,\n            "PidsLimit": null,\n            "Ulimits": [],\n            "CpuCount": 0,\n            "CpuPercent": 0,\n            "IOMaximumIOps": 0,\n            "IOMaximumBandwidth": 0,\n            "Tmpfs": []\n        },\n        "Config": {\n            "Hostname": "controller-0",\n            "Domainname": "",\n            "User": {\n                "uid": 0,\n                "gid": 0\n            },\n            "AttachStdin": false,\n            "AttachStdout": false,\n            "AttachStderr": false,\n            "Tty": false,\n            "OpenStdin": false,\n            "StdinOnce": false,\n            "Env": [\n                "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin",\n                "TERM=xterm",\n                "HOSTNAME=controller-0",\n                "container=oci",\n                "KOLLA_CONFIG_STRATEGY=COPY_ALWAYS",\n                "TRIPLEO_CONFIG_HASH=3faca5d7029273bb994631cb4a075e0f",\n                "KOLLA_INSTALL_TYPE=binary",\n                "KOLLA_INSTALL_METATYPE=rhos",\n                "KOLLA_DISTRO_PYTHON_VERSION=3.6",\n                "KOLLA_BASE_DISTRO=rhel",\n                "PS1=$(tput bold)($(printenv KOLLA_SERVICE_NAME))$(tput sgr0)[$(id -un)@$(hostname -s) $(pwd)]$ "\n            ],\n            "Cmd": [\n                "dumb-init",\n                "--single-child",\n                "--",\n                "kolla_start"\n            ],\n            "Image": "192.168.24.1:8787/rhosp15/openstack-gnocchi-metricd:20190819.1",\n            "Volumes": null,\n            "WorkingDir": "/",\n            "Entrypoint": "dumb-init --single-child --",\n            "Labels": {\n                "architecture": "x86_64",\n                "authoritative-source-url": "registry.access.redhat.com",\n                "batch": "20190819.1",\n                "build-date": "2019-08-19T20:42:03.096048",\n                "com.redhat.build-host": "cpt-1004.osbs.prod.upshift.rdu2.redhat.com",\n                "com.redhat.component": "openstack-gnocchi-metricd-container",\n                "com.redhat.license_terms": "https://www.redhat.com/en/about/red-hat-end-user-license-agreements",\n                "config_id": "tripleo_step5",\n                "container_name": "gnocchi_metricd",\n                "description": "Red Hat OpenStack Platform 15.0 gnocchi-metricd",\n                "distribution-scope": "public",\n                "io.k8s.description": "Red Hat OpenStack Platform 15.0 gnocchi-metricd",\n                "io.k8s.display-name": "Red Hat OpenStack Platform 15.0 gnocchi-metricd",\n                "io.openshift.expose-services": "",\n                "io.openshift.tags": "rhosp osp openstack osp-15.0",\n                "maintainer": "Red Hat, Inc.",\n                "managed_by": "paunch",\n                "name": "rhosp15/openstack-gnocchi-metricd",\n                "release": "58",\n                "summary": "Red Hat OpenStack Platform 15.0 gnocchi-metricd",\n                "url": "https://access.redhat.com/containers/#/registry.access.redhat.com/rhosp15/openstack-gnocchi-metricd/images/15.0-58",\n                "vcs-ref": "18e6ecd9e04f6590526657b85423347b7543391a",\n                "vcs-type": "git",\n                "vendor": "Red Hat, Inc.",\n                "version": "15.0"\n            },\n            "Annotations": {\n                "io.kubernetes.cri-o.ContainerType": "sandbox",\n                "io.kubernetes.cri-o.TTY": "false"\n            },\n            "StopSignal": 15\n        }\n    }\n]\n').splitlines()
PODMAN_IMAGE_INSPECT = ('\n[\n    {\n        "Id": "013125b8a088f45be8f85f88b5504f05c02463b10a6eea2b66809a262bb911ca",\n        "Digest": "sha256:f9662cdd45e3db182372a4fa6bfff10e1c601cc785bac09ccae3b18f0bc429df",\n        "RepoTags": [\n            "192.168.24.1:8787/rhosp15/openstack-rabbitmq:20190819.1",\n            "192.168.24.1:8787/rhosp15/openstack-rabbitmq:pcmklatest"\n        ],\n        "RepoDigests": [\n            "192.168.24.1:8787/rhosp15/openstack-rabbitmq@sha256:f9662cdd45e3db182372a4fa6bfff10e1c601cc785bac09ccae3b18f0bc429df",\n            "192.168.24.1:8787/rhosp15/openstack-rabbitmq@sha256:f9662cdd45e3db182372a4fa6bfff10e1c601cc785bac09ccae3b18f0bc429df"\n        ],\n        "Parent": "",\n        "Comment": "",\n        "Created": "2019-08-19T19:39:31.939714Z",\n        "Config": {\n            "User": "rabbitmq",\n            "Env": [\n                "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin",\n                "container=oci",\n                "KOLLA_BASE_DISTRO=rhel",\n                "KOLLA_INSTALL_TYPE=binary",\n                "KOLLA_INSTALL_METATYPE=rhos",\n                "KOLLA_DISTRO_PYTHON_VERSION=3.6",\n                "PS1=$(tput bold)($(printenv KOLLA_SERVICE_NAME))$(tput sgr0)[$(id -un)@$(hostname -s) $(pwd)]$ "\n            ],\n            "Entrypoint": [\n                "dumb-init",\n                "--single-child",\n                "--"\n            ],\n            "Cmd": [\n                "kolla_start"\n            ],\n            "Labels": {\n                "architecture": "x86_64",\n                "authoritative-source-url": "registry.access.redhat.com",\n                "batch": "20190819.1",\n                "build-date": "2019-08-19T19:38:18.798307",\n                "com.redhat.build-host": "cpt-1003.osbs.prod.upshift.rdu2.redhat.com",\n                "com.redhat.component": "openstack-rabbitmq-container",\n                "com.redhat.license_terms": "https://www.redhat.com/en/about/red-hat-end-user-license-agreements",\n                "description": "Red Hat OpenStack Platform 15.0 rabbitmq",\n                "distribution-scope": "public",\n                "io.k8s.description": "Red Hat OpenStack Platform 15.0 rabbitmq",\n                "io.k8s.display-name": "Red Hat OpenStack Platform 15.0 rabbitmq",\n                "io.openshift.expose-services": "",\n                "io.openshift.tags": "rhosp osp openstack osp-15.0",\n                "maintainer": "Red Hat, Inc.",\n                "name": "rhosp15/openstack-rabbitmq",\n                "release": "64",\n                "summary": "Red Hat OpenStack Platform 15.0 rabbitmq",\n                "url": "https://access.redhat.com/containers/#/registry.access.redhat.com/rhosp15/openstack-rabbitmq/images/15.0-64",\n                "vcs-ref": "292efe508dcdf588e92503273c5abcc89af574d6",\n                "vcs-type": "git",\n                "vendor": "Red Hat, Inc.",\n                "version": "15.0"\n            },\n            "StopSignal": "SIGTERM"\n        },\n        "Version": "1.13.1",\n        "Author": "",\n        "Architecture": "amd64",\n        "Os": "linux",\n        "Size": 542316943,\n        "VirtualSize": 542316943,\n        "GraphDriver": {\n            "Name": "overlay",\n            "Data": {\n                "LowerDir": "/var/lib/containers/storage/overlay/4faa8d5827f59db011a639ea73621234812291ff51d875f58e1e4197c6239429/diff:/var/lib/containers/storage/overlay/671441d9601355a777b2ce9afceef5a7d0d4890d11ef4f5744e534394ef7c447/diff:/var/lib/containers/storage/overlay/c7269138daa6b23e16efdcbf7ee323ba42fba93eb2406192ac22631bdd0cb4e3/diff",\n                "MergedDir": "/var/lib/containers/storage/overlay/b25ec647038ff1d35285422ddbedb5b5c7d36d64e67fcbbd2a2f205dc2aa1eb5/merged",\n                "UpperDir": "/var/lib/containers/storage/overlay/b25ec647038ff1d35285422ddbedb5b5c7d36d64e67fcbbd2a2f205dc2aa1eb5/diff",\n                "WorkDir": "/var/lib/containers/storage/overlay/b25ec647038ff1d35285422ddbedb5b5c7d36d64e67fcbbd2a2f205dc2aa1eb5/work"\n            }\n        },\n        "RootFS": {\n            "Type": "layers",\n            "Layers": [\n                "sha256:c7269138daa6b23e16efdcbf7ee323ba42fba93eb2406192ac22631bdd0cb4e3",\n                "sha256:786011f2f6269cc2512d58fd7d6c8feac1330754b12b4ffacfcaa8bd685ed898",\n                "sha256:d74075ef7bbc7f840dec3cafc7bf8f82e900ee2f8b4a4d328448965bd8e398ce",\n                "sha256:272314807b476c2c183edd6427bd450cea885976446afcdbd6b52ad47943a60f"\n            ]\n        },\n        "Labels": {\n            "architecture": "x86_64",\n            "authoritative-source-url": "registry.access.redhat.com",\n            "batch": "20190819.1",\n            "build-date": "2019-08-19T19:38:18.798307",\n            "com.redhat.build-host": "cpt-1003.osbs.prod.upshift.rdu2.redhat.com",\n            "com.redhat.component": "openstack-rabbitmq-container",\n            "com.redhat.license_terms": "https://www.redhat.com/en/about/red-hat-end-user-license-agreements",\n            "description": "Red Hat OpenStack Platform 15.0 rabbitmq",\n            "distribution-scope": "public",\n            "io.k8s.description": "Red Hat OpenStack Platform 15.0 rabbitmq",\n            "io.k8s.display-name": "Red Hat OpenStack Platform 15.0 rabbitmq",\n            "io.openshift.expose-services": "",\n            "io.openshift.tags": "rhosp osp openstack osp-15.0",\n            "maintainer": "Red Hat, Inc.",\n            "name": "rhosp15/openstack-rabbitmq",\n            "release": "64",\n            "summary": "Red Hat OpenStack Platform 15.0 rabbitmq",\n            "url": "https://access.redhat.com/containers/#/registry.access.redhat.com/rhosp15/openstack-rabbitmq/images/15.0-64",\n            "vcs-ref": "292efe508dcdf588e92503273c5abcc89af574d6",\n            "vcs-type": "git",\n            "vendor": "Red Hat, Inc.",\n            "version": "15.0"\n        },\n        "Annotations": {},\n        "ManifestType": "application/vnd.docker.distribution.manifest.v2+json",\n        "User": "rabbitmq",\n        "History": [\n            {\n                "created": "2019-07-15T05:10:57.589513378Z",\n                "comment": "Imported from -"\n            },\n            {\n                "created": "2019-07-15T05:11:04.220661Z"\n            },\n            {\n                "created": "2019-08-19T19:24:22.99993Z"\n            },\n            {\n                "created": "2019-08-19T19:39:31.939714Z"\n            }\n        ]\n    }\n]\n').splitlines()
PODMAN_CONTAINER_INSPECT_TRUNCATED = '\n[\n    {\n        "ID": "66db151828e9beede0cdd9c17fc9bd5ebb5d125dd036f7230bc6b6433e5c0dda",\n        "Created": "2019-08-21T10:38:34.753548542Z",\n        "Path": "dumb-init",\n'

def test_podman_object_container_inspect():
    result = podman_inspect.PodmanInspect(context_wrap(PODMAN_CONTAINER_INSPECT))
    assert result.get('ID') == '66db151828e9beede0cdd9c17fc9bd5ebb5d125dd036f7230bc6b6433e5c0dda'
    assert result.get('NetworkSettings').get('HairpinMode') is False
    assert result.get('Config').get('Env') == [
     'PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin',
     'TERM=xterm',
     'HOSTNAME=controller-0',
     'container=oci',
     'KOLLA_CONFIG_STRATEGY=COPY_ALWAYS',
     'TRIPLEO_CONFIG_HASH=3faca5d7029273bb994631cb4a075e0f',
     'KOLLA_INSTALL_TYPE=binary',
     'KOLLA_INSTALL_METATYPE=rhos',
     'KOLLA_DISTRO_PYTHON_VERSION=3.6',
     'KOLLA_BASE_DISTRO=rhel',
     'PS1=$(tput bold)($(printenv KOLLA_SERVICE_NAME))$(tput sgr0)[$(id -un)@$(hostname -s) $(pwd)]$ ']
    assert result.get('GraphDriver').get('Name') == 'overlay'


def test_podman_object_image_inspect():
    result = podman_inspect.PodmanInspect(context_wrap(PODMAN_IMAGE_INSPECT))
    assert result.get('Id') == '013125b8a088f45be8f85f88b5504f05c02463b10a6eea2b66809a262bb911ca'
    assert result.get('Size') == 542316943
    assert result.get('Digest') == 'sha256:f9662cdd45e3db182372a4fa6bfff10e1c601cc785bac09ccae3b18f0bc429df'


def test_podman_container_inspect_truncated_input():
    with pytest.raises(SkipException):
        podman_inspect.PodmanInspectContainer(context_wrap(PODMAN_CONTAINER_INSPECT_TRUNCATED))


def test_doc_test():
    dic = podman_inspect.PodmanInspectContainer(context_wrap(PODMAN_CONTAINER_INSPECT))
    dii = podman_inspect.PodmanInspectImage(context_wrap(PODMAN_IMAGE_INSPECT))
    env = {'container': dic, 
       'image': dii}
    failed, total = doctest.testmod(podman_inspect, globs=env)
    assert failed == 0