# uncompyle6 version 3.7.4
# Python bytecode 2.7 (62211)
# Decompiled from: Python 3.6.9 (default, Apr 18 2020, 01:56:04) 
# [GCC 8.4.0]
# Embedded file name: build/bdist.linux-x86_64/egg/insights/parsers/tests/test_ceph_insights.py
# Compiled at: 2019-05-16 13:41:33
from insights.parsers.ceph_insights import CephInsights
from insights.parsers import ceph_insights
from insights.tests import context_wrap
import six, doctest
TEST_DATA = '\n{\n  "crush_map": {\n    "tunables": {\n      "profile": "jewel",\n      "minimum_required_version": "jewel",\n      "has_v3_rules": 0,\n      "has_v4_buckets": 1,\n      "choose_total_tries": 50,\n      "require_feature_tunables3": 1,\n      "require_feature_tunables5": 1,\n      "legacy_tunables": 0,\n      "chooseleaf_descend_once": 1,\n      "chooseleaf_stable": 1,\n      "choose_local_fallback_tries": 0,\n      "has_v2_rules": 0,\n      "straw_calc_version": 1,\n      "allowed_bucket_algs": 54,\n      "has_v5_rules": 0,\n      "require_feature_tunables2": 1,\n      "optimal_tunables": 1,\n      "choose_local_tries": 0,\n      "chooseleaf_vary_r": 1,\n      "require_feature_tunables": 1\n    },\n    "rules": [\n      {\n        "min_size": 1,\n        "rule_name": "replicated_rule",\n        "steps": [\n          {\n            "item_name": "default",\n            "item": -1,\n            "op": "take"\n          },\n          {\n            "num": 0,\n            "type": "osd",\n            "op": "choose_firstn"\n          },\n          {\n            "op": "emit"\n          }\n        ],\n        "ruleset": 0,\n        "type": 1,\n        "rule_id": 0,\n        "max_size": 10\n      }\n    ],\n    "buckets": [\n      {\n        "hash": "rjenkins1",\n        "name": "default",\n        "weight": 1926,\n        "type_id": 10,\n        "alg": "straw2",\n        "type_name": "root",\n        "items": [\n          {\n            "id": -3,\n            "weight": 1926,\n            "pos": 0\n          }\n        ],\n        "id": -1\n      },\n      {\n        "hash": "rjenkins1",\n        "name": "default~ssd",\n        "weight": 1926,\n        "type_id": 10,\n        "alg": "straw2",\n        "type_name": "root",\n        "items": [\n          {\n            "id": -4,\n            "weight": 1926,\n            "pos": 0\n          }\n        ],\n        "id": -2\n      },\n      {\n        "hash": "rjenkins1",\n        "name": "daq",\n        "weight": 1926,\n        "type_id": 1,\n        "alg": "straw2",\n        "type_name": "host",\n        "items": [\n          {\n            "id": 0,\n            "weight": 642,\n            "pos": 0\n          },\n          {\n            "id": 1,\n            "weight": 642,\n            "pos": 1\n          },\n          {\n            "id": 2,\n            "weight": 642,\n            "pos": 2\n          }\n        ],\n        "id": -3\n      },\n      {\n        "hash": "rjenkins1",\n        "name": "daq~ssd",\n        "weight": 1926,\n        "type_id": 1,\n        "alg": "straw2",\n        "type_name": "host",\n        "items": [\n          {\n            "id": 0,\n            "weight": 642,\n            "pos": 0\n          },\n          {\n            "id": 1,\n            "weight": 642,\n            "pos": 1\n          },\n          {\n            "id": 2,\n            "weight": 642,\n            "pos": 2\n          }\n        ],\n        "id": -4\n      }\n    ],\n    "devices": [\n      {\n        "class": "ssd",\n        "id": 0,\n        "name": "osd.0"\n      },\n      {\n        "class": "ssd",\n        "id": 1,\n        "name": "osd.1"\n      },\n      {\n        "class": "ssd",\n        "id": 2,\n        "name": "osd.2"\n      }\n    ],\n    "choose_args": {},\n    "types": [\n      {\n        "name": "osd",\n        "type_id": 0\n      },\n      {\n        "name": "host",\n        "type_id": 1\n      },\n      {\n        "name": "chassis",\n        "type_id": 2\n      },\n      {\n        "name": "rack",\n        "type_id": 3\n      },\n      {\n        "name": "row",\n        "type_id": 4\n      },\n      {\n        "name": "pdu",\n        "type_id": 5\n      },\n      {\n        "name": "pod",\n        "type_id": 6\n      },\n      {\n        "name": "room",\n        "type_id": 7\n      },\n      {\n        "name": "datacenter",\n        "type_id": 8\n      },\n      {\n        "name": "region",\n        "type_id": 9\n      },\n      {\n        "name": "root",\n        "type_id": 10\n      }\n    ]\n  },\n  "pg_summary": {\n    "by_osd": {\n      "1": {\n        "peering": 13\n      },\n      "0": {\n        "peering": 16\n      },\n      "2": {\n        "peering": 16\n      }\n    },\n    "by_pool": {\n      "1": {\n        "peering": 8\n      },\n      "2": {\n        "peering": 8\n      }\n    },\n    "all": {\n      "peering": 16\n    },\n    "pg_stats_sum": {\n      "acting": 45,\n      "log_size": 39,\n      "ondisk_log_size": 39,\n      "stat_sum": {\n        "num_evict": 0,\n        "num_evict_kb": 0,\n        "num_bytes_hit_set_archive": 0,\n        "num_whiteouts": 0,\n        "num_objects_pinned": 0,\n        "num_scrub_errors": 0,\n        "num_evict_mode_full": 0,\n        "num_read": 0,\n        "num_objects_recovered": 0,\n        "num_objects_omap": 14,\n        "num_objects_missing_on_primary": 0,\n        "num_write": 45,\n        "num_object_clones": 0,\n        "num_objects": 22,\n        "num_deep_scrub_errors": 0,\n        "num_shallow_scrub_errors": 0,\n        "num_read_kb": 0,\n        "num_objects_missing": 0,\n        "num_flush_kb": 0,\n        "num_flush_mode_high": 0,\n        "num_write_kb": 13,\n        "num_large_omap_objects": 0,\n        "num_evict_mode_some": 0,\n        "num_objects_degraded": 0,\n        "num_flush": 0,\n        "num_objects_misplaced": 0,\n        "num_bytes_recovered": 0,\n        "num_objects_hit_set_archive": 0,\n        "num_legacy_snapsets": 0,\n        "num_keys_recovered": 0,\n        "num_flush_mode_low": 0,\n        "num_objects_manifest": 0,\n        "num_objects_unfound": 0,\n        "num_promote": 0,\n        "num_object_copies": 66,\n        "num_bytes": 2286,\n        "num_objects_dirty": 22\n      },\n      "up": 45\n    }\n  },\n  "service_map": {\n    "services": {},\n    "epoch": 1,\n    "modified": "0.000000"\n  },\n  "crashes": {\n    "hours": 24,\n    "summary": {}\n  },\n  "mon_status": {\n    "election_epoch": 12,\n    "quorum_age": "11.1322s",\n    "outside_quorum": [],\n    "rank": 0,\n    "monmap": {\n      "features": {\n        "optional": [],\n        "persistent": [\n          "kraken",\n          "luminous",\n          "mimic",\n          "osdmap-prune",\n          "nautilus"\n        ]\n      },\n      "created": "2018-09-21 10:41:49.406653",\n      "modified": "2018-09-21 10:41:49.406653",\n      "epoch": 1,\n      "mons": [\n        {\n          "public_addr": "127.0.0.1:40226/0",\n          "name": "a",\n          "rank": 0,\n          "addr": "127.0.0.1:40226/0"\n        },\n        {\n          "public_addr": "127.0.0.1:40227/0",\n          "name": "b",\n          "rank": 1,\n          "addr": "127.0.0.1:40227/0"\n        },\n        {\n          "public_addr": "127.0.0.1:40228/0",\n          "name": "c",\n          "rank": 2,\n          "addr": "127.0.0.1:40228/0"\n        }\n      ],\n      "fsid": "d02162fd-bee9-4cb5-973b-2f7b6d97102a"\n    },\n    "state": "leader",\n    "features": {\n      "quorum_con": "4611087854031142911",\n      "quorum_mon": [\n        "kraken",\n        "luminous",\n        "mimic",\n        "osdmap-prune",\n        "nautilus"\n      ],\n      "required_mon": [\n        "kraken",\n        "luminous",\n        "mimic",\n        "osdmap-prune",\n        "nautilus"\n      ],\n      "required_con": "2449958747315912708"\n    },\n    "extra_probe_peers": [],\n    "feature_map": {\n      "mds": [\n        {\n          "release": "luminous",\n          "num": 1,\n          "features": "0x3ffddff8ffa4ffff"\n        }\n      ],\n      "mon": [\n        {\n          "release": "luminous",\n          "num": 1,\n          "features": "0x3ffddff8ffa4ffff"\n        }\n      ],\n      "mgr": [\n        {\n          "release": "luminous",\n          "num": 1,\n          "features": "0x3ffddff8ffa4ffff"\n        }\n      ]\n    },\n    "quorum": [\n      0,\n      1,\n      2\n    ],\n    "sync_provider": [],\n    "name": "a"\n  },\n  "df": {\n    "pools": [\n      {\n        "stats": {\n          "wr": 0,\n          "quota_objects": 0,\n          "bytes_used": 0,\n          "max_avail": 9553910784,\n          "rd": 0,\n          "rd_bytes": 0,\n          "objects": 0,\n          "percent_used": 0.0,\n          "kb_used": 0,\n          "quota_bytes": 0,\n          "raw_bytes_used": 0,\n          "wr_bytes": 0,\n          "dirty": 0\n        },\n        "name": "cephfs_data_a",\n        "id": 1\n      },\n      {\n        "stats": {\n          "wr": 45,\n          "quota_objects": 0,\n          "bytes_used": 2286,\n          "max_avail": 9553910784,\n          "rd": 0,\n          "rd_bytes": 0,\n          "objects": 22,\n          "percent_used": 2.3927370307319507e-07,\n          "kb_used": 3,\n          "quota_bytes": 0,\n          "raw_bytes_used": 6858,\n          "wr_bytes": 13312,\n          "dirty": 22\n        },\n        "name": "cephfs_metadata_a",\n        "id": 2\n      }\n    ],\n    "stats": {\n      "total_objects": 22,\n      "total_used_bytes": 3425656832,\n      "total_bytes": 32413556736,\n      "total_percent_used": 10.56859302520752,\n      "total_avail_bytes": 28987899904\n    }\n  },\n  "osd_tree": {\n    "nodes": [\n      {\n        "children": [\n          -3\n        ],\n        "type_id": 10,\n        "type": "root",\n        "id": -1,\n        "name": "default"\n      },\n      {\n        "name": "daq",\n        "type_id": 1,\n        "id": -3,\n        "pool_weights": {},\n        "type": "host",\n        "children": [\n          2,\n          1,\n          0\n        ]\n      },\n      {\n        "status": "up",\n        "name": "osd.0",\n        "exists": 1,\n        "type_id": 0,\n        "reweight": 1.0,\n        "crush_weight": 0.009796142578125,\n        "pool_weights": {},\n        "primary_affinity": 1.0,\n        "depth": 2,\n        "device_class": "ssd",\n        "type": "osd",\n        "id": 0\n      },\n      {\n        "status": "up",\n        "name": "osd.1",\n        "exists": 1,\n        "type_id": 0,\n        "reweight": 1.0,\n        "crush_weight": 0.009796142578125,\n        "pool_weights": {},\n        "primary_affinity": 1.0,\n        "depth": 2,\n        "device_class": "ssd",\n        "type": "osd",\n        "id": 1\n      },\n      {\n        "status": "up",\n        "name": "osd.2",\n        "exists": 1,\n        "type_id": 0,\n        "reweight": 1.0,\n        "crush_weight": 0.009796142578125,\n        "pool_weights": {},\n        "primary_affinity": 1.0,\n        "depth": 2,\n        "device_class": "ssd",\n        "type": "osd",\n        "id": 2\n      }\n    ],\n    "stray": []\n  },\n  "osd_metadata": {\n    "1": {\n      "bluefs_db_size": "67108864",\n      "bluestore_bdev_size": "10737418240",\n      "bluestore_bdev_driver": "KernelDevice"\n    },\n    "0": {\n      "bluefs_db_size": "67108864",\n      "bluestore_bdev_size": "10737418240",\n      "bluestore_bdev_driver": "KernelDevice"\n    },\n    "2": {\n      "bluefs_db_size": "67108864",\n      "bluestore_bdev_size": "10737418240",\n      "bluestore_bdev_driver": "KernelDevice"\n    }\n  },\n  "osd_dump": {\n    "nearfull_ratio": 0.9900000095367432,\n    "backfillfull_ratio": 0.9900000095367432,\n    "last_in_change": "2018-09-21 10:42:23.201021",\n    "full_ratio": 0.9900000095367432,\n    "cluster_snapshot": "",\n    "pg_upmap": [],\n    "new_purged_snaps": [],\n    "erasure_code_profiles": {\n      "default": {\n        "crush-failure-domain": "osd",\n        "k": "2",\n        "technique": "reed_sol_van",\n        "m": "1",\n        "plugin": "jerasure"\n      }\n    },\n    "osds": [\n      {\n        "public_addrs": {\n          "addrvec": [\n            {\n              "nonce": 4283,\n              "type": "legacy",\n              "addr": "127.0.0.1:6800"\n            }\n          ]\n        },\n        "weight": 1.0,\n        "up_from": 17,\n        "heartbeat_front_addr": {\n          "addrvec": [\n            {\n              "nonce": 4283,\n              "type": "legacy",\n              "addr": "127.0.0.1:6802"\n            }\n          ]\n        },\n        "down_at": 16,\n        "up": 1,\n        "cluster_addrs": {\n          "addrvec": [\n            {\n              "nonce": 4283,\n              "type": "legacy",\n              "addr": "127.0.0.1:6801"\n            }\n          ]\n        },\n        "lost_at": 0,\n        "primary_affinity": 1.0,\n        "state": [\n          "exists",\n          "up"\n        ],\n        "last_clean_begin": 5,\n        "last_clean_end": 15,\n        "in": 1,\n        "public_addr": "127.0.0.1:6800/4283",\n        "up_thru": 19,\n        "heartbeat_back_addrs": {\n          "addrvec": [\n            {\n              "nonce": 4283,\n              "type": "legacy",\n              "addr": "127.0.0.1:6803"\n            }\n          ]\n        },\n        "cluster_addr": "127.0.0.1:6801/4283",\n        "osd": 0,\n        "uuid": "c8c26eda-d1e4-4ab2-839d-a07573414e41"\n      },\n      {\n        "public_addrs": {\n          "addrvec": [\n            {\n              "nonce": 4559,\n              "type": "legacy",\n              "addr": "127.0.0.1:6804"\n            }\n          ]\n        },\n        "weight": 1.0,\n        "up_from": 18,\n        "heartbeat_front_addr": {\n          "addrvec": [\n            {\n              "nonce": 4559,\n              "type": "legacy",\n              "addr": "127.0.0.1:6806"\n            }\n          ]\n        },\n        "down_at": 17,\n        "up": 1,\n        "cluster_addrs": {\n          "addrvec": [\n            {\n              "nonce": 4559,\n              "type": "legacy",\n              "addr": "127.0.0.1:6805"\n            }\n          ]\n        },\n        "lost_at": 0,\n        "primary_affinity": 1.0,\n        "state": [\n          "exists",\n          "up"\n        ],\n        "last_clean_begin": 8,\n        "last_clean_end": 15,\n        "in": 1,\n        "public_addr": "127.0.0.1:6804/4559",\n        "up_thru": 19,\n        "heartbeat_back_addrs": {\n          "addrvec": [\n            {\n              "nonce": 4559,\n              "type": "legacy",\n              "addr": "127.0.0.1:6807"\n            }\n          ]\n        },\n        "cluster_addr": "127.0.0.1:6805/4559",\n        "osd": 1,\n        "uuid": "b6105fad-2e66-4ea3-a0ff-b14eb1f3e52f"\n      },\n      {\n        "public_addrs": {\n          "addrvec": [\n            {\n              "nonce": 4723,\n              "type": "legacy",\n              "addr": "127.0.0.1:6809"\n            }\n          ]\n        },\n        "weight": 1.0,\n        "up_from": 19,\n        "heartbeat_front_addr": {\n          "addrvec": [\n            {\n              "nonce": 4723,\n              "type": "legacy",\n              "addr": "127.0.0.1:6811"\n            }\n          ]\n        },\n        "down_at": 18,\n        "up": 1,\n        "cluster_addrs": {\n          "addrvec": [\n            {\n              "nonce": 4723,\n              "type": "legacy",\n              "addr": "127.0.0.1:6810"\n            }\n          ]\n        },\n        "lost_at": 0,\n        "primary_affinity": 1.0,\n        "state": [\n          "exists",\n          "up"\n        ],\n        "last_clean_begin": 11,\n        "last_clean_end": 15,\n        "in": 1,\n        "public_addr": "127.0.0.1:6809/4723",\n        "up_thru": 19,\n        "heartbeat_back_addrs": {\n          "addrvec": [\n            {\n              "nonce": 4723,\n              "type": "legacy",\n              "addr": "127.0.0.1:6812"\n            }\n          ]\n        },\n        "cluster_addr": "127.0.0.1:6810/4723",\n        "osd": 2,\n        "uuid": "178b1a4e-1f8d-454e-b2b4-9fccc25e047e"\n      }\n    ],\n    "epoch": 21,\n    "require_min_compat_client": "jewel",\n    "crush_version": 7,\n    "primary_temp": [],\n    "pool_max": 2,\n    "max_osd": 3,\n    "require_osd_release": "nautilus",\n    "min_compat_client": "jewel",\n    "osd_xinfo": [\n      {\n        "laggy_probability": 0.0,\n        "laggy_interval": 0,\n        "features": 4611087854031142911,\n        "old_weight": 0,\n        "down_stamp": "2018-09-21 10:58:51.931192",\n        "osd": 0\n      },\n      {\n        "laggy_probability": 0.0,\n        "laggy_interval": 0,\n        "features": 4611087854031142911,\n        "old_weight": 0,\n        "down_stamp": "2018-09-21 10:58:54.178595",\n        "osd": 1\n      },\n      {\n        "laggy_probability": 0.0,\n        "laggy_interval": 0,\n        "features": 4611087854031142911,\n        "old_weight": 0,\n        "down_stamp": "2018-09-21 10:58:55.191632",\n        "osd": 2\n      }\n    ],\n    "blacklist": {\n      "127.0.0.1:6815/347750185": "2018-09-22 10:58:55.672857"\n    },\n    "last_up_change": "2018-09-21 10:58:55.510104",\n    "flags_set": [\n      "purged_snapdirs",\n      "recovery_deletes",\n      "sortbitwise"\n    ],\n    "fsid": "d02162fd-bee9-4cb5-973b-2f7b6d97102a",\n    "flags_num": 1605632,\n    "created": "2018-09-21 10:41:55.238114",\n    "modified": "2018-09-21 10:58:55.672887",\n    "flags": "sortbitwise,recovery_deletes,purged_snapdirs",\n    "pg_upmap_items": [],\n    "pools": [\n      {\n        "cache_target_full_ratio_micro": 800000,\n        "fast_read": false,\n        "stripe_width": 0,\n        "flags_names": "hashpspool",\n        "tier_of": -1,\n        "hit_set_grade_decay_rate": 0,\n        "pg_placement_num": 8,\n        "use_gmt_hitset": true,\n        "last_force_op_resend_preluminous": "0",\n        "create_time": "2018-09-21 10:42:28.846328",\n        "quota_max_bytes": 0,\n        "erasure_code_profile": "",\n        "snap_seq": 0,\n        "expected_num_objects": 0,\n        "size": 3,\n        "pg_num_pending": 8,\n        "auid": 0,\n        "cache_min_flush_age": 0,\n        "hit_set_period": 0,\n        "min_read_recency_for_promote": 0,\n        "target_max_objects": 0,\n        "pg_placement_num_target": 8,\n        "pg_num": 8,\n        "type": 1,\n        "pg_num_pending_dec_epoch": 12,\n        "grade_table": [],\n        "pool_name": "cephfs_data_a",\n        "cache_min_evict_age": 0,\n        "snap_mode": "selfmanaged",\n        "pg_num_target": 8,\n        "cache_mode": "none",\n        "min_size": 1,\n        "cache_target_dirty_high_ratio_micro": 600000,\n        "object_hash": 2,\n        "application_metadata": {\n          "cephfs": {\n            "data": "cephfs_a"\n          }\n        },\n        "write_tier": -1,\n        "cache_target_dirty_ratio_micro": 400000,\n        "pool": 1,\n        "removed_snaps": "[]",\n        "crush_rule": 0,\n        "tiers": [],\n        "hit_set_params": {\n          "type": "none"\n        },\n        "last_force_op_resend": "0",\n        "pool_snaps": [],\n        "quota_max_objects": 0,\n        "last_force_op_resend_prenautilus": "0",\n        "options": {},\n        "hit_set_count": 0,\n        "flags": 1,\n        "target_max_bytes": 0,\n        "snap_epoch": 0,\n        "hit_set_search_last_n": 0,\n        "last_change": "14",\n        "min_write_recency_for_promote": 0,\n        "read_tier": -1\n      },\n      {\n        "cache_target_full_ratio_micro": 800000,\n        "fast_read": false,\n        "stripe_width": 0,\n        "flags_names": "hashpspool",\n        "tier_of": -1,\n        "hit_set_grade_decay_rate": 0,\n        "pg_placement_num": 8,\n        "use_gmt_hitset": true,\n        "last_force_op_resend_preluminous": "0",\n        "create_time": "2018-09-21 10:42:29.266816",\n        "quota_max_bytes": 0,\n        "erasure_code_profile": "",\n        "snap_seq": 0,\n        "expected_num_objects": 0,\n        "size": 3,\n        "pg_num_pending": 8,\n        "auid": 0,\n        "cache_min_flush_age": 0,\n        "hit_set_period": 0,\n        "min_read_recency_for_promote": 0,\n        "target_max_objects": 0,\n        "pg_placement_num_target": 8,\n        "pg_num": 8,\n        "type": 1,\n        "pg_num_pending_dec_epoch": 13,\n        "grade_table": [],\n        "pool_name": "cephfs_metadata_a",\n        "cache_min_evict_age": 0,\n        "snap_mode": "selfmanaged",\n        "pg_num_target": 8,\n        "cache_mode": "none",\n        "min_size": 1,\n        "cache_target_dirty_high_ratio_micro": 600000,\n        "object_hash": 2,\n        "application_metadata": {\n          "cephfs": {\n            "metadata": "cephfs_a"\n          }\n        },\n        "write_tier": -1,\n        "cache_target_dirty_ratio_micro": 400000,\n        "pool": 2,\n        "removed_snaps": "[]",\n        "crush_rule": 0,\n        "tiers": [],\n        "hit_set_params": {\n          "type": "none"\n        },\n        "last_force_op_resend": "0",\n        "pool_snaps": [],\n        "quota_max_objects": 0,\n        "last_force_op_resend_prenautilus": "0",\n        "options": {},\n        "hit_set_count": 0,\n        "flags": 1,\n        "target_max_bytes": 0,\n        "snap_epoch": 0,\n        "hit_set_search_last_n": 0,\n        "last_change": "15",\n        "min_write_recency_for_promote": 0,\n        "read_tier": -1\n      }\n    ],\n    "new_removed_snaps": [],\n    "removed_snaps_queue": []\n  },\n  "fs_map": {\n    "compat": {\n      "compat": {},\n      "ro_compat": {},\n      "incompat": {\n        "feature_10": "snaprealm v2",\n        "feature_8": "no anchor table",\n        "feature_9": "file layout v2",\n        "feature_2": "client writeable ranges",\n        "feature_3": "default file layouts on dirs",\n        "feature_1": "base v0.20",\n        "feature_6": "dirfrag is stored in omap",\n        "feature_4": "dir inode in separate object",\n        "feature_5": "mds uses versioned encoding"\n      }\n    },\n    "feature_flags": {\n      "ever_enabled_multiple": false,\n      "enable_multiple": false\n    },\n    "default_fscid": 1,\n    "filesystems": [\n      {\n        "id": 1,\n        "mdsmap": {\n          "session_autoclose": 300,\n          "balancer": "",\n          "modified": "2018-09-21 10:58:59.856070",\n          "last_failure_osd_epoch": 21,\n          "in": [\n            0\n          ],\n          "last_failure": 0,\n          "max_file_size": 1099511627776,\n          "explicitly_allowed_features": 0,\n          "damaged": [],\n          "tableserver": 0,\n          "failed": [],\n          "metadata_pool": 2,\n          "epoch": 11,\n          "flags": 18,\n          "max_mds": 1,\n          "compat": {\n            "compat": {},\n            "ro_compat": {},\n            "incompat": {\n              "feature_10": "snaprealm v2",\n              "feature_8": "no anchor table",\n              "feature_9": "file layout v2",\n              "feature_2": "client writeable ranges",\n              "feature_3": "default file layouts on dirs",\n              "feature_1": "base v0.20",\n              "feature_6": "dirfrag is stored in omap",\n              "feature_4": "dir inode in separate object",\n              "feature_5": "mds uses versioned encoding"\n            }\n          },\n          "min_compat_client": "-1 (unspecified)",\n          "data_pools": [\n            1\n          ],\n          "info": {\n            "gid_34136": {\n              "standby_for_rank": -1,\n              "addr": "127.0.0.1:6814/2139526630",\n              "export_targets": [],\n              "name": "b",\n              "incarnation": 8,\n              "state": "up:active",\n              "state_seq": 4,\n              "standby_for_fscid": -1,\n              "standby_replay": false,\n              "gid": 34136,\n              "features": 4611087854031142911,\n              "rank": 0,\n              "standby_for_name": "",\n              "addrs": {\n                "addrvec": [\n                  {\n                    "nonce": 2139526630,\n                    "type": "legacy",\n                    "addr": "127.0.0.1:6814"\n                  }\n                ]\n              }\n            }\n          },\n          "fs_name": "cephfs_a",\n          "created": "2018-09-21 10:42:30.305761",\n          "standby_count_wanted": 1,\n          "enabled": true,\n          "up": {\n            "mds_0": 34136\n          },\n          "session_timeout": 60,\n          "stopped": [],\n          "ever_allowed_features": 0,\n          "root": 0\n        }\n      }\n    ],\n    "epoch": 11,\n    "standbys": [\n      {\n        "standby_for_rank": -1,\n        "addr": "127.0.0.1:6815/1585121408",\n        "export_targets": [],\n        "name": "c",\n        "state": "up:standby",\n        "incarnation": 0,\n        "epoch": 7,\n        "state_seq": 1,\n        "standby_for_fscid": -1,\n        "standby_replay": false,\n        "gid": 34116,\n        "features": 4611087854031142911,\n        "rank": -1,\n        "standby_for_name": "",\n        "addrs": {\n          "addrvec": [\n            {\n              "nonce": 1585121408,\n              "type": "legacy",\n              "addr": "127.0.0.1:6815"\n            }\n          ]\n        }\n      },\n      {\n        "standby_for_rank": -1,\n        "addr": "127.0.0.1:6813/3705009905",\n        "export_targets": [],\n        "name": "a",\n        "state": "up:standby",\n        "incarnation": 0,\n        "epoch": 7,\n        "state_seq": 1,\n        "standby_for_fscid": -1,\n        "standby_replay": false,\n        "gid": 34123,\n        "features": 4611087854031142911,\n        "rank": -1,\n        "standby_for_name": "",\n        "addrs": {\n          "addrvec": [\n            {\n              "nonce": 3705009905,\n              "type": "legacy",\n              "addr": "127.0.0.1:6813"\n            }\n          ]\n        }\n      }\n    ]\n  },\n  "version": {\n    "release": 14,\n    "major": 0,\n    "full": "ceph version 14.0.0-3517-g5322f99370 (5322f99370d629f6927b9c948522a003fc5da5bb) nautilus (dev)",\n    "minor": 0\n  },\n  "health": {\n    "current": {\n      "status": "HEALTH_WARN",\n      "checks": {\n        "PG_AVAILABILITY": {\n          "detail": [\n            {\n              "message": "pg 1.0 is stuck peering for 990.119101, current state peering, last acting [1,0,2]"\n            },\n            {\n              "message": "pg 1.1 is stuck peering for 990.111854, current state peering, last acting [2,0,1]"\n            },\n            {\n              "message": "pg 1.2 is stuck peering for 990.119186, current state peering, last acting [0,2]"\n            },\n            {\n              "message": "pg 1.3 is stuck peering for 990.118224, current state peering, last acting [1,2,0]"\n            },\n            {\n              "message": "pg 1.4 is stuck peering for 990.119116, current state peering, last acting [1,0,2]"\n            },\n            {\n              "message": "pg 1.5 is stuck peering for 990.111987, current state peering, last acting [2,0,1]"\n            },\n            {\n              "message": "pg 1.6 is stuck peering for 990.118940, current state peering, last acting [1,0,2]"\n            },\n            {\n              "message": "pg 1.7 is stuck peering for 990.117449, current state peering, last acting [1,2,0]"\n            },\n            {\n              "message": "pg 2.0 is stuck peering for 989.765896, current state peering, last acting [2,1,0]"\n            },\n            {\n              "message": "pg 2.1 is stuck peering for 989.768816, current state peering, last acting [2,1,0]"\n            },\n            {\n              "message": "pg 2.2 is stuck peering for 989.765611, current state peering, last acting [0,2]"\n            },\n            {\n              "message": "pg 2.3 is stuck peering for 989.768059, current state peering, last acting [1,2,0]"\n            },\n            {\n              "message": "pg 2.4 is stuck peering for 989.750743, current state peering, last acting [1,0,2]"\n            },\n            {\n              "message": "pg 2.5 is stuck peering for 989.768270, current state peering, last acting [1,0,2]"\n            },\n            {\n              "message": "pg 2.6 is stuck peering for 988.783800, current state peering, last acting [0,2]"\n            },\n            {\n              "message": "pg 2.7 is stuck peering for 989.768669, current state peering, last acting [1,0,2]"\n            }\n          ],\n          "severity": "HEALTH_WARN",\n          "summary": {\n            "message": "Reduced data availability: 16 pgs peering"\n          }\n        }\n      }\n    },\n    "history": {\n      "checks": {\n        "OSD_DOWN": {\n          "HEALTH_WARN": {\n            "detail": [\n              "osd.1 (root=default,host=daq) is down",\n              "osd.2 (root=default,host=daq) is down"\n            ],\n            "summary": [\n              "1 osds down"\n            ]\n          }\n        },\n        "PG_AVAILABILITY": {\n          "HEALTH_WARN": {\n            "detail": [\n              "pg 1.3 is stuck peering for 986.117085, current state peering, last acting [1,2,0]",\n              "pg 1.5 is stuck peering for 988.111424, current state peering, last acting [2,0,1]",\n              "pg 2.5 is stuck peering for 989.768270, current state peering, last acting [1,0,2]",\n              "pg 1.7 is stuck peering for 990.117449, current state peering, last acting [1,2,0]",\n              "pg 2.2 is stuck peering for 985.764472, current state peering, last acting [0,2]",\n              "pg 1.2 is stuck peering for 988.118624, current state peering, last acting [0,2]",\n              "pg 2.6 is stuck peering for 986.783237, current state peering, last acting [0,2]",\n              "pg 2.6 is stuck peering for 988.783800, current state peering, last acting [0,2]",\n              "pg 1.5 is stuck peering for 990.111987, current state peering, last acting [2,0,1]",\n              "pg 1.5 is stuck peering for 986.110848, current state peering, last acting [2,0,1]",\n              "pg 2.1 is stuck peering for 989.768816, current state peering, last acting [2,1,0]",\n              "pg 1.7 is stuck peering for 986.116310, current state peering, last acting [1,2,0]",\n              "pg 2.3 is stuck peering for 985.766920, current state peering, last acting [1,2,0]",\n              "pg 2.5 is stuck peering for 987.767707, current state peering, last acting [1,0,2]",\n              "pg 1.1 is stuck peering for 990.111854, current state peering, last acting [2,0,1]",\n              "pg 2.7 is stuck peering for 985.767530, current state peering, last acting [1,0,2]",\n              "pg 2.0 is stuck peering for 985.764757, current state peering, last acting [2,1,0]",\n              "pg 2.1 is stuck peering for 987.768253, current state peering, last acting [2,1,0]",\n              "pg 2.0 is stuck peering for 989.765896, current state peering, last acting [2,1,0]",\n              "pg 1.2 is stuck peering for 990.119186, current state peering, last acting [0,2]",\n              "pg 2.6 is stuck peering for 984.782661, current state peering, last acting [0,2]",\n              "pg 2.7 is stuck peering for 987.768106, current state peering, last acting [1,0,2]",\n              "pg 1.2 is stuck peering for 986.118047, current state peering, last acting [0,2]",\n              "pg 2.4 is stuck peering for 987.750181, current state peering, last acting [1,0,2]",\n              "pg 1.6 is stuck peering for 986.117801, current state peering, last acting [1,0,2]",\n              "pg 1.6 is stuck peering for 988.118377, current state peering, last acting [1,0,2]",\n              "pg 2.3 is stuck peering for 987.767497, current state peering, last acting [1,2,0]",\n              "pg 2.2 is stuck peering for 987.765049, current state peering, last acting [0,2]",\n              "pg 1.0 is stuck peering for 986.117962, current state peering, last acting [1,0,2]",\n              "pg 1.4 is stuck peering for 988.118553, current state peering, last acting [1,0,2]",\n              "pg 2.5 is stuck peering for 985.767131, current state peering, last acting [1,0,2]",\n              "pg 1.0 is stuck peering for 990.119101, current state peering, last acting [1,0,2]",\n              "pg 1.0 is stuck peering for 988.118539, current state peering, last acting [1,0,2]",\n              "pg 2.4 is stuck peering for 985.749604, current state peering, last acting [1,0,2]",\n              "pg 2.3 is stuck peering for 989.768059, current state peering, last acting [1,2,0]",\n              "pg 2.2 is stuck peering for 989.765611, current state peering, last acting [0,2]",\n              "pg 2.4 is stuck peering for 989.750743, current state peering, last acting [1,0,2]",\n              "pg 2.0 is stuck peering for 987.765334, current state peering, last acting [2,1,0]",\n              "pg 1.7 is stuck peering for 988.116886, current state peering, last acting [1,2,0]",\n              "pg 1.4 is stuck peering for 986.117976, current state peering, last acting [1,0,2]",\n              "pg 1.3 is stuck peering for 990.118224, current state peering, last acting [1,2,0]",\n              "pg 2.7 is stuck peering for 989.768669, current state peering, last acting [1,0,2]",\n              "pg 1.1 is stuck peering for 988.111291, current state peering, last acting [2,0,1]",\n              "pg 1.1 is stuck peering for 986.110715, current state peering, last acting [2,0,1]",\n              "pg 1.3 is stuck peering for 988.117661, current state peering, last acting [1,2,0]",\n              "pg 1.4 is stuck peering for 990.119116, current state peering, last acting [1,0,2]",\n              "pg 1.6 is stuck peering for 990.118940, current state peering, last acting [1,0,2]",\n              "pg 2.1 is stuck peering for 985.767677, current state peering, last acting [2,1,0]"\n            ],\n            "summary": [\n              "Reduced data availability: 16 pgs peering"\n            ]\n          }\n        },\n        "FS_DEGRADED": {\n          "HEALTH_WARN": {\n            "detail": [\n              "fs cephfs_a is degraded"\n            ],\n            "summary": [\n              "1 filesystem is degraded"\n            ]\n          }\n        },\n        "MDS_ALL_DOWN": {\n          "HEALTH_ERR": {\n            "detail": [\n              "fs cephfs_a is offline because no MDS is active for it."\n            ],\n            "summary": [\n              "1 filesystem is offline"\n            ]\n          }\n        }\n      }\n    }\n  },\n  "manager_map": {\n    "available": true,\n    "active_change": "2018-09-21 10:58:50.982610",\n    "available_modules": [\n      {\n        "name": "dashboard",\n        "error_string": "No module named rbd",\n        "can_run": false\n      },\n      {\n        "name": "diskprediction",\n        "error_string": "No module named rbd",\n        "can_run": false\n      },\n      {\n        "name": "hello",\n        "error_string": "",\n        "can_run": true\n      },\n      {\n        "name": "influx",\n        "error_string": "influxdb python module not found",\n        "can_run": false\n      },\n      {\n        "name": "insights",\n        "error_string": "",\n        "can_run": true\n      },\n      {\n        "name": "iostat",\n        "error_string": "",\n        "can_run": true\n      },\n      {\n        "name": "localpool",\n        "error_string": "",\n        "can_run": true\n      },\n      {\n        "name": "orchestrator_cli",\n        "error_string": "",\n        "can_run": true\n      },\n      {\n        "name": "progress",\n        "error_string": "",\n        "can_run": true\n      },\n      {\n        "name": "prometheus",\n        "error_string": "",\n        "can_run": true\n      },\n      {\n        "name": "restful",\n        "error_string": "",\n        "can_run": true\n      },\n      {\n        "name": "rook",\n        "error_string": "Kubernetes module not found",\n        "can_run": false\n      },\n      {\n        "name": "selftest",\n        "error_string": "",\n        "can_run": true\n      },\n      {\n        "name": "smart",\n        "error_string": "",\n        "can_run": true\n      },\n      {\n        "name": "telegraf",\n        "error_string": "",\n        "can_run": true\n      },\n      {\n        "name": "telemetry",\n        "error_string": "",\n        "can_run": true\n      },\n      {\n        "name": "zabbix",\n        "error_string": "",\n        "can_run": true\n      }\n    ],\n    "modules": [\n      "balancer",\n      "devicehealth",\n      "insights",\n      "iostat",\n      "restful",\n      "status"\n    ],\n    "active_name": "x",\n    "epoch": 10,\n    "standbys": [],\n    "active_addrs": {\n      "addrvec": [\n        {\n          "nonce": 4254,\n          "type": "legacy",\n          "addr": "127.0.0.1:6808"\n        }\n      ]\n    },\n    "services": {\n      "restful": "https://daq:42226/"\n    },\n    "active_gid": 34106\n  },\n  "errors": [],\n  "mon_map": {\n    "features": {\n      "optional": [],\n      "persistent": [\n        "kraken",\n        "luminous",\n        "mimic",\n        "osdmap-prune",\n        "nautilus"\n      ]\n    },\n    "created": "2018-09-21 10:41:49.406653",\n    "modified": "2018-09-21 10:41:49.406653",\n    "epoch": 1,\n    "mons": [\n      {\n        "public_addr": "127.0.0.1:40226/0",\n        "name": "a",\n        "rank": 0,\n        "addr": "127.0.0.1:40226/0"\n      },\n      {\n        "public_addr": "127.0.0.1:40227/0",\n        "name": "b",\n        "rank": 1,\n        "addr": "127.0.0.1:40227/0"\n      },\n      {\n        "public_addr": "127.0.0.1:40228/0",\n        "name": "c",\n        "rank": 2,\n        "addr": "127.0.0.1:40228/0"\n      }\n    ],\n    "fsid": "d02162fd-bee9-4cb5-973b-2f7b6d97102a"\n  },\n  "config": [\n    {\n      "name": "mon_pg_warn_min_per_osd",\n      "level": "advanced",\n      "section": "global",\n      "mask": "",\n      "value": "3",\n      "can_update_at_runtime": true\n    },\n    {\n      "name": "osd_pool_default_min_size",\n      "level": "advanced",\n      "section": "global",\n      "mask": "",\n      "value": "1",\n      "can_update_at_runtime": true\n    },\n    {\n      "name": "osd_pool_default_size",\n      "level": "advanced",\n      "section": "global",\n      "mask": "",\n      "value": "3",\n      "can_update_at_runtime": true\n    },\n    {\n      "name": "mon_allow_pool_delete",\n      "level": "advanced",\n      "section": "mon",\n      "mask": "",\n      "value": "true",\n      "can_update_at_runtime": true\n    },\n    {\n      "name": "mon_data_avail_crit",\n      "level": "advanced",\n      "section": "mon",\n      "mask": "",\n      "value": "1",\n      "can_update_at_runtime": true\n    },\n    {\n      "name": "mon_data_avail_warn",\n      "level": "advanced",\n      "section": "mon",\n      "mask": "",\n      "value": "2",\n      "can_update_at_runtime": true\n    },\n    {\n      "name": "mon_osd_reporter_subtree_level",\n      "level": "advanced",\n      "section": "mon",\n      "mask": "",\n      "value": "osd",\n      "can_update_at_runtime": true\n    },\n    {\n      "name": "mgr/restful/x/server_port",\n      "level": "unknown",\n      "section": "mgr",\n      "mask": "",\n      "value": "42226",\n      "can_update_at_runtime": false\n    },\n    {\n      "name": "osd_copyfrom_max_chunk",\n      "level": "advanced",\n      "section": "osd",\n      "mask": "",\n      "value": "524288",\n      "can_update_at_runtime": true\n    },\n    {\n      "name": "osd_debug_misdirected_ops",\n      "level": "dev",\n      "section": "osd",\n      "mask": "",\n      "value": "true",\n      "can_update_at_runtime": true\n    },\n    {\n      "name": "osd_debug_op_order",\n      "level": "dev",\n      "section": "osd",\n      "mask": "",\n      "value": "true",\n      "can_update_at_runtime": true\n    },\n    {\n      "name": "osd_scrub_load_threshold",\n      "level": "advanced",\n      "section": "osd",\n      "mask": "",\n      "value": "2000.000000",\n      "can_update_at_runtime": true\n    },\n    {\n      "name": "mds_debug_auth_pins",\n      "level": "dev",\n      "section": "mds",\n      "mask": "",\n      "value": "true",\n      "can_update_at_runtime": true\n    },\n    {\n      "name": "mds_debug_frag",\n      "level": "dev",\n      "section": "mds",\n      "mask": "",\n      "value": "true",\n      "can_update_at_runtime": true\n    },\n    {\n      "name": "mds_debug_subtrees",\n      "level": "dev",\n      "section": "mds",\n      "mask": "",\n      "value": "true",\n      "can_update_at_runtime": true\n    }\n  ]\n}\n'
DEV_TEST_DATA = '\n*** DEVELOPER MODE: setting PATH, PYTHONPATH and LD_LIBRARY_PATH ***\n2018-09-26 11:32:02.830 7f39e866c700 -1 WARNING: all dangerous and experimental features are enabled.\n2018-09-26 11:32:02.879 7f39e866c700 -1 WARNING: all dangerous and experimental features are enabled.\n' + TEST_DATA

def test_ceph_insights():
    for content in (TEST_DATA, DEV_TEST_DATA):
        ceph = CephInsights(context_wrap(content))
        assert ceph is not None
        assert isinstance(ceph.version, dict)
        assert isinstance(ceph.version['full'], six.string_types)
        for key in ('release', 'major', 'minor'):
            assert isinstance(ceph.version[key], int)

        assert isinstance(ceph.data['crashes'], dict)
        assert isinstance(ceph.data['health'], dict)
        assert isinstance(ceph.data['config'], list)
        assert isinstance(ceph.data['osd_dump'], dict)
        assert isinstance(ceph.data['df'], dict)
        assert isinstance(ceph.data['osd_tree'], dict)
        assert isinstance(ceph.data['fs_map'], dict)
        assert isinstance(ceph.data['crush_map'], dict)
        assert isinstance(ceph.data['mon_map'], dict)
        assert isinstance(ceph.data['service_map'], dict)
        assert isinstance(ceph.data['manager_map'], dict)
        assert isinstance(ceph.data['mon_status'], dict)
        assert isinstance(ceph.data['pg_summary'], dict)
        assert isinstance(ceph.data['osd_metadata'], dict)
        assert isinstance(ceph.data['version'], dict)
        assert isinstance(ceph.data['errors'], list)

    return


def test_ceph_insights_documentation():
    env = {'ceph_insights': CephInsights(context_wrap(TEST_DATA))}
    failed, total = doctest.testmod(ceph_insights, globs=env)
    assert failed == 0