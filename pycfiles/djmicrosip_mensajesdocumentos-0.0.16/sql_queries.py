# uncompyle6 version 3.7.4
# Python bytecode 2.7 (62211)
# Decompiled from: Python 3.6.9 (default, Apr 18 2020, 01:56:04) 
# [GCC 8.4.0]
# Embedded file name: C:\GitHub\django-microsip-base\django_microsip_base\django_microsip_base\apps\plugins\djmicrosip_mensajesdocumentos\djmicrosip_mensajesdocumentos\custom_db\ventas\sql_queries.py
# Compiled at: 2015-09-03 18:24:02
triggers_activate = {}
triggers_activate['SIC_mensajesdocs_DOCTOS_VE'] = '\n  CREATE OR ALTER TRIGGER SIC_MENSAJESDOCS_DOCTOS_VE FOR DOCTOS_VE\nACTIVE BEFORE UPDATE POSITION 0\nAS\n  DECLARE VARIABLE TELEFONO VARCHAR(80);\n  DECLARE VARIABLE CLIENTE_NOMBRE VARCHAR(100);\n  DECLARE VARIABLE VALORES CHAR(200);\n  DECLARE VARIABLE TIPO_DOCUMENTO CHAR(1);\n  DECLARE VARIABLE SMS_GENERADO INTEGER;\n  DECLARE VARIABLE RESPONSABLE_CAMPOEXISTE INTEGER;\n  DECLARE VARIABLE RESPONSABLE VARCHAR(50);\n\n  BEGIN\n\n    SELECT VALOR FROM REGISTRY WHERE NOMBRE = \'SIC_MensajeDocumentos_VentasTipoDocumento\' INTO :TIPO_DOCUMENTO;\n\n    /*  PARA CHECAR SI NO SE A GENERADO EL MENSAJE ANTES*/\n    IF (NEW.DESCRIPCION IS NULL) THEN\n      NEW.DESCRIPCION =\'\';\n    SMS_GENERADO = POSITION(\'[SIC SMS GENERADO]\' IN NEW.DESCRIPCION);\n\n    IF (TIPO_DOCUMENTO <> \'-\' AND SMS_GENERADO = 0) THEN\n    BEGIN\n      IF  (OLD.APLICADO = \'N\' AND NEW.APLICADO = \'S\' AND NEW.TIPO_DOCTO = :TIPO_DOCUMENTO AND NOT NEW.CLIENTE_ID IS NULL) THEN\n      BEGIN\n\n        /* PARA SACAR SI EL DOUMENTO TIENE UN RESPONSABLE */\n        IF (TIPO_DOCUMENTO=\'R\') THEN\n          SELECT 1 FROM RDB$RELATION_FIELDS RF WHERE RF.RDB$RELATION_NAME = \'LIBRES_REM_VE\' AND RF.RDB$FIELD_NAME = \'RESPONSABLE\' INTO :RESPONSABLE_CAMPOEXISTE;\n        ELSE IF (TIPO_DOCUMENTO=\'F\') THEN\n          SELECT 1 FROM RDB$RELATION_FIELDS RF WHERE RF.RDB$RELATION_NAME = \'LIBRES_FAC_VE\' AND RF.RDB$FIELD_NAME = \'RESPONSABLE\' INTO :RESPONSABLE_CAMPOEXISTE;\n\n        IF (NOT RESPONSABLE_CAMPOEXISTE IS NULL) THEN\n        BEGIN\n            IF (TIPO_DOCUMENTO=\'R\') THEN\n              SELECT TRIM(RESPONSABLE) FROM LIBRES_REM_VE WHERE DOCTO_VE_ID=NEW.DOCTO_VE_ID INTO :RESPONSABLE;\n            ELSE IF (TIPO_DOCUMENTO=\'F\') THEN\n              SELECT TRIM(RESPONSABLE) FROM LIBRES_FAC_VE WHERE DOCTO_VE_ID=NEW.DOCTO_VE_ID INTO :RESPONSABLE;\n        END\n        IF (RESPONSABLE IS NULL) THEN\n          RESPONSABLE = \'\';\n\n        SELECT FIRST 1 TELEFONO1 FROM DIRS_CLIENTES WHERE CLIENTE_ID = NEW.CLIENTE_ID INTO :TELEFONO;\n        SELECT NOMBRE FROM CLIENTES WHERE CLIENTE_ID= NEW.CLIENTE_ID INTO CLIENTE_NOMBRE;\n        VALORES = \'{"folio":"\'|| NEW.FOLIO ||\'", "importe":"\'||(NEW.IMPORTE_NETO+NEW.TOTAL_IMPUESTOS)||\'", "responsable":"\'||RESPONSABLE||\'", "telefono":"\'||TELEFONO||\'", "cliente_nombre":"\'||CLIENTE_NOMBRE||\'"}\';\n        IF (NOT :TELEFONO IS NULL) THEN\n        BEGIN\n          NEW.DESCRIPCION = NEW.DESCRIPCION || \'[SIC SMS GENERADO]\';\n          INSERT INTO SIC_PENDINGTASK (TYPE, APP, PARAMETERS, INTENTS) VALUES(\'GRACIAS\', \'SMS\', :VALORES,  0);\n        END\n      END\n    END\n  END\n  '
triggers_activate['premisos'] = 'GRANT ALL ON SIC_PENDINGTASK TO USUARIO_MICROSIP'