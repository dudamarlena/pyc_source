# uncompyle6 version 3.7.4
# Python bytecode 2.6 (62161)
# Decompiled from: Python 3.6.9 (default, Apr 18 2020, 01:56:04) 
# [GCC 8.4.0]
# Embedded file name: build/bdist.linux-x86_64/egg/ageliaco/rd/content/projet.py
# Compiled at: 2012-01-07 05:34:07
canvas = '\n<p><i>Enlever les parties de texte pas nécessaires</i></p>\n<H3 CLASS="western">Objectifs et retombées attendues du projet</H3>\n<H4 CLASS="western"><FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt"><B>Quels\nsont les objectifs du projet ? Liste des changements concrets\nauxquels il est raisonnable de s\'attendre à l\'issue de la recherche,\nmais également à long terme (indicateurs de changement, outils\nd\'évaluation)</B></FONT></FONT></FONT></H4>\n<P ALIGN=LEFT STYLE="margin-bottom: 0cm; font-weight: normal"><FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Les\nobjectifs sont exprimés en termes d\'actions à mener ou de\nchangements auxquels on peut raisonnablement s\'attendre à l\'issue de\nla recherche.</FONT></FONT></FONT></P>\n<P ALIGN=LEFT STYLE="margin-bottom: 0cm; font-weight: normal"><FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Ils\ndoivent être réalistes, mais liés à un résultat tangible tout en\ntenant compte des différentes contraintes, le temps et les moyens à\ndisposition, par exemple, ou encore les difficultés prévisibles que\nl\'on rencontrera pour les atteindre et les faire atteindre par\nd\'autres</FONT></FONT></FONT></P>\n<H4 CLASS="western"><FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt"><B>Bénéficiaires\nde ces changements (retombées pour les maîtres et les élèves)</B></FONT></FONT></FONT></H4>\n<P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt"><SPAN STYLE="font-weight: normal">Implantation\net diffusion du projet (modalités prévues pour la diffusion et\nl\'implantation du produit, de l\'expérience)</SPAN></FONT></FONT></FONT><FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 11pt"><I><B>.\n</B></I></FONT></FONT></FONT><FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">Il\ns\'agit aussi d\'essayer de prévoir quels résultats concrets et\nquelles autres implications, locales ou générales, la réalisa-\ntion des objectifs pourrait entraîner à court et long terme, dans\nd\'autres domaines, sur d\'autres plans.</SPAN></SPAN></FONT></FONT></FONT></P>\n<P ALIGN=LEFT STYLE="margin-bottom: 0cm; font-style: normal; font-weight: normal">\n<FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">On\npeut imaginer, par exemple, que l\'utilisation de tel didacticiel\nréclamera la modification des conditions d\'accès au matériel\ninformatique ou l\'adaptation de la politique d\'équipement en la\nmatière.</FONT></FONT></FONT></P>\n<H3 CLASS="western">Problématique et contexte</H3>\n<H4 CLASS="western" STYLE="font-style: normal"><FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt"><B>Quels\néléments de la situation présente sont à l\'origine du besoin\nexprimé et justifient l\'existence du pro- jet ? Preuve du besoin :\nétude, enquête, sondage, argumentaire précis, etc.</B></FONT></FONT></FONT></H4>\n<P ALIGN=LEFT STYLE="margin-bottom: 0cm; font-style: normal; font-weight: normal">\n<FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">L\'exposé\nde ces motifs est un élément capital pour plusieurs raisons :</FONT></FONT></FONT></P>\n<UL>\n\t<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm; font-style: normal; font-weight: normal">\n\t<FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">définition\n\tdu point de départ que constitue la situation actuelle, il permet\n\td\'apprécier la distance à couvrir pour atteindre les objectifs (la\n\tconnaissance d\'études menées dans le domaine considéré apporte,\n\tle cas échéant, une précision supplémentaire);</FONT></FONT></FONT></P>\n\t<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm; font-style: normal; font-weight: normal">\n\t<FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">il\n\tconstitue une justification de l\'action à entreprendre dans la\n\tmesure où il met en évidence et définit un besoin réel, montre\n\tque ce besoin est largement partagé et laisse supposer, par\n\tconséquent, que la diffusion pourra se développer dans des\n\tconditions favorables.</FONT></FONT></FONT></P>\n\t<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm; font-style: normal; font-weight: normal">\n\t<FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">le\n\tsimple constat d\'une nécessité ne semble pas suffisant. Par\n\texemple, la création d\'un site qui devrait être réalisé parce\n\tqu\' &quot;il pourra être utilisé par des élèves, des maîtres...\n\t&quot;, sur simple conviction personnelle est un motif insuffisant.\n\tPeut-être faut-il concevoir une enquête sur la forme, le contenu,\n\tl\'utilisation ou la nécessité du projet auprès des futurs\n\tutilisateurs, cela avant même d\'en élaborer la forme exacte</FONT></FONT></FONT></P>\n</UL>\n<H4 CLASS="western" STYLE="font-style: normal"><FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt"><B>Quelles\npersonnes partagent les préoccupations des auteurs, ressentent le\nmême besoin et seraient réellement intéressées par\nl\'aboutissement de cette recherche ? (Sujet intéressant plus d\'un\nétablissement ou plus d\'un centre de concertation, priorité\ninstitutionnelle, lien avec une innovation, contacts pris avec un ou\ndes groupes de discipline, avec des personnes extérieures à\nl\'institution, etc.).</B></FONT></FONT></FONT></H4>\n<H3 CLASS="western">Nature du projet</H3>\n<H4 CLASS="western" STYLE="font-style: normal"><FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt"><B>Type\net originalité du projet (création d\'un produit, évaluation d\'une\nexpérience, résolution de problèmes pédagogiques, développement\nd\'initiatives locales, etc.)</B></FONT></FONT></FONT></H4>\n<P ALIGN=LEFT STYLE="margin-bottom: 0cm; font-style: normal; font-weight: normal">\n<FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Caractéristiques\ndu projet ou des apports prévus (maquette, plan détaillé,\nprototype, etc.)</FONT></FONT></FONT></P>\n<P ALIGN=LEFT STYLE="margin-bottom: 0cm; font-style: normal; font-weight: normal">\n<FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Cette\npartie doit être à la fois concise et précise: la &quot;nature&quot;\ndoit faire apparaître le genre de recherche proposée. Il convient\nde donner une description aussi précise et complète des buts du\nprojet.</FONT></FONT></FONT></P>\n<P ALIGN=LEFT STYLE="margin-bottom: 0cm; font-style: normal; font-weight: normal">\n<FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Si\nle projet vise la réalisation d\'un produit, il importe que les\nauteurs s\'efforcent d\'imaginer des &quot;produits ouverts&quot; que\nles utilisateurs pourront améliorer et enrichir au gré de leurs\nbesoins et qui seront suffisamment flexibles pour s\'adap- ter à\ndifférents types d\'utilisation. Pour favoriser la diffusion, il\nconviendra non seulement de prévoir des supports maté- riels\ncommodes et attrayants, mais aussi d\'accompagner le produit lui-même\nde toutes les indications facilitant son emploi (descriptif,\nrésultats de l\'expérimentation, suggestions d\'utilisation, par\nexemple).</FONT></FONT></FONT></P>\n<H4 CLASS="western" STYLE="font-style: normal"><FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt"><B>Connaissances\net expériences préalables </B></FONT></FONT></FONT>\n</H4>\n<P ALIGN=LEFT STYLE="margin-bottom: 0cm; font-style: normal; font-weight: normal">\n<FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Travail\npréalable et réflexion déjà entamée dans le domaine de recherche\nproposé : bibliographie, inventaire éventuel</FONT></FONT></FONT></P>\n<P ALIGN=LEFT STYLE="margin-bottom: 0cm; font-style: normal; font-weight: normal">\n<FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">d\'expériences\nsemblables, de sites existants, de matériel comparable, etc.</FONT></FONT></FONT></P>\n<H3 CLASS="western">Constitution de l\'équipe et répartition des\ntâches</H3>\n<UL>\n\t<UL>\n\t\t<UL>\n\t\t\t<UL>\n\t\t\t\t<LI><H4 CLASS="western" STYLE="font-style: normal"><FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt"><B>Constitution\n\t\t\t\tde l\'équipe membres provenant de différents établissements, de\n\t\t\t\tdifférents ordres d\'ensei- gnement - recherche de collaborations\n\t\t\t\tou de personnes de référence autour des différents pôles du\n\t\t\t\ttravail - diagramme de répartition des responsabilités au sein\n\t\t\t\tdu groupe</B></FONT></FONT></FONT></H4>\n\t\t\t</UL>\n\t\t</UL>\n\t</UL>\n</UL>\n<P ALIGN=LEFT STYLE="margin-bottom: 0cm; font-style: normal; font-weight: normal">\n<FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Sans\nune adhésion minimale de l\'équipe, le projet ne peut aboutir, et\ncela même si l\'on bénéficie de l\'appui d\'autres acteurs et des\nressources nécessaires pour sa mise en œuvre. Ce degré d\'adhésion\npeut être obtenu à condition qu\'il y ait une véritable démarche\nd\'équipe permettant l\'appropriation par chacun de la problématique\ndu projet (construction d\'une représentation commune).</FONT></FONT></FONT></P>\n<UL>\n\t<UL>\n\t\t<UL>\n\t\t\t<UL>\n\t\t\t\t<LI><H4 CLASS="western" STYLE="font-style: normal"><FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt"><B>Regard\n\t\t\t\textérieur - validation scientifique</B></FONT></FONT></FONT></H4>\n\t\t\t</UL>\n\t\t</UL>\n\t</UL>\n</UL>\n<P ALIGN=LEFT STYLE="margin-bottom: 0cm; font-style: normal"><FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 11pt"><B>Planification\net ressources</B></FONT></FONT></FONT></P>\n<UL>\n\t<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm; font-style: normal"><FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt"><B>Nombre\n\td\'années de travail prévu, nombre d\'heures demandées\n\t(justification précise)</B></FONT></FONT></FONT></P>\n</UL>\n<P ALIGN=LEFT STYLE="margin-bottom: 0cm; font-style: normal; font-weight: normal">\n<FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">La\nplanification demeure indispensable puisqu\'elle fait apparaître\nl\'ensemble des relations entre les actions prévues. Elle peut subir\ndes adaptations en fonction de l\'évolution du projet.</FONT></FONT></FONT></P>\n<UL>\n\t<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm; font-style: normal"><FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt"><B>Autres\n\tressources demandées par maître ou appui technique demandé</B></FONT></FONT></FONT></P>\n\t<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm; font-style: normal"><FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt"><B>Organisation\n\tdu travail - planification du travail (étapes clés avec :\n\tobjectifs spécifiques, traces ou indicateur de réalisation, temps\n\tde travail prévu </B></FONT></FONT></FONT>\n\t</P>\n</UL>\n<H3 CLASS="western" STYLE="font-style: normal"><FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 11pt"><B>Moyens</B></FONT></FONT></FONT></H3>\n<H4 CLASS="western" STYLE="font-style: normal"><FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt"><B>C\'est\nseulement de manière progressive que l\'on parviendra à les\nidentifier de manière précise, après avoir défini les actions,\ntrouvé des collaborateurs et pris les contacts indispensables.</B></FONT></FONT></FONT></H4>\n'
from five import grok
from zope import schema
from plone.namedfile import field as namedfile
from z3c.relationfield.schema import RelationChoice, RelationList
from plone.formwidget.contenttree import ObjPathSourceBinder
from plone.directives import form, dexterity
from zope.security import checkPermission
from ageliaco.rd import _
from auteur import IAuteur
from Products.CMFPlone.utils import log
from plone.app.textfield import RichText
from zope.lifecycleevent.interfaces import IObjectModifiedEvent, IObjectRemovedEvent
import datetime
from zope.schema.interfaces import IContextSourceBinder
from zope.schema.vocabulary import SimpleVocabulary
from zope.app.container.interfaces import IObjectAddedEvent
from Products.CMFCore.utils import getToolByName
from plone.formwidget.autocomplete import AutocompleteMultiFieldWidget
from plone.z3cform.textlines import TextLinesFieldWidget
from zope.interface import invariant, Invalid
from plone.app.textfield.value import RichTextValue
from AccessControl.interfaces import IRoleManager
from DateTime import DateTime
from plone.indexer import indexer
import datetime
from zope.schema.interfaces import IVocabularyFactory
from Acquisition import aq_inner, aq_parent
from Products.CMFCore.utils import getToolByName
from cycle import ICycle
from Products.CMFCore.interfaces import IFolderish
from zope.security import checkPermission
from plone.namedfile.field import NamedBlobImage

class ProfsVocabulary(object):
    grok.implements(IVocabularyFactory)

    def __call__(self, context):
        acl_users = getToolByName(context, 'acl_users')
        membership = getToolByName(context, 'portal_membership')
        terms = []
        users = acl_users.getUserNames()
        if users is not None:
            for member_id in users:
                user = acl_users.getUserById(member_id)
                if user is not None:
                    member_name = user.getProperty('fullname') or member_id
                    terms.append(SimpleVocabulary.createTerm(member_id, str(member_id), member_name))
                else:
                    user = membership.getMemberById(member_id)
                    if user is not None:
                        member_name = user.getProperty('fullname') or member_id
                        terms.append(SimpleVocabulary.createTerm(member_id, str(member_id), member_name))
                    else:
                        member_name = member_id
                        terms.append(SimpleVocabulary.createTerm(member_id, str(member_id), member_name))

        return SimpleVocabulary(terms)


grok.global_utility(ProfsVocabulary, name='ageliaco.rd.Profs')

class GroupMembers(object):
    """Context source binder to provide a vocabulary of users in a given
    group.
    """
    grok.implements(IContextSourceBinder)

    def __init__(self, group_name):
        self.group_name = group_name

    def __call__(self, context):
        acl_users = getToolByName(context, 'acl_users')
        group = acl_users.getGroupById(self.group_name)
        terms = []
        if group is not None:
            for member_id in group.getMemberIds():
                user = acl_users.getUserById(member_id)
                if user is not None:
                    member_name = user.getProperty('fullname') or member_id
                    terms.append(SimpleVocabulary.createTerm(member_id, str(member_id), member_name))

        return SimpleVocabulary(terms)


class IProjet(form.Schema):
    """
    Projet RD
    """
    start = schema.TextLine(title=_('Année'), description=_("L'année à laquelle le projet a commencé ou devrait commencer"), required=True)
    duration = schema.Int(title=_('Durée'), description=_('Durée (en années) du projet, prévue ou effective'), required=True)
    dexterity.write_permission(num='cmf.ReviewPortalContent')
    num = schema.Int(title=_('Numéro'), description=_('Numéro du projet'), default=0, required=True)
    presentation = RichText(title=_('Présentation'), description=_('Présentation synthétique du projet (présentation publiée)'), required=True)
    picture = NamedBlobImage(title=_('Chargez une image pour le projet'), required=False)


@indexer(IProjet)
def startIndexer(obj):
    if obj.start is None:
        return
    else:
        adate = datetime.date(int(obj.start.split('-')[0]), 9, 1)
        return DateTime(adate.isoformat())


grok.global_adapter(startIndexer, name='start')

@indexer(IProjet)
def endIndexer(obj):
    if obj.duration is None:
        return
    else:
        adate = datetime.date(int(obj.start.split('-')[0]) + obj.duration, 9, 1)
        return DateTime(adate.isoformat())


grok.global_adapter(endIndexer, name='end')

@indexer(IProjet)
def numIndexer(obj):
    if hasattr(obj, 'num'):
        return obj.num
    else:
        return


grok.global_adapter(numIndexer, name='num')

@indexer(IProjet)
def cycleIndexer(obj):
    admin = 'admin_' + obj.id
    if admin in obj.objectIds():
        administration = obj[admin]
        ret = []
        for cycle in administration.objectValues():
            if cycle.portal_type == 'ageliaco.rd.cycle':
                ret.append(cycle.id)

        return ret


grok.global_adapter(cycleIndexer, name='cycles')

@indexer(IProjet)
def authorsIndexer(obj):
    admin = 'admin_' + obj.id
    if admin in obj.objectIds():
        administration = obj[admin]
        ret = []
        for auteur in administration.objectValues():
            if auteur.portal_type == 'ageliaco.rd.auteur':
                ret.append(auteur.id)

        return ret


grok.global_adapter(authorsIndexer, name='authors')

@form.default_value(field=IProjet['start'])
def startDefaultValue(data):
    return str(datetime.datetime.today().year)


@form.default_value(field=IProjet['duration'])
def durationDefaultValue(data):
    return 1


@form.default_value(field=IProjet['presentation'])
def presentationDefaultValue(data):
    return RichTextValue(raw=canvas)


@grok.subscribe(IProjet, IObjectRemovedEvent)
@grok.subscribe(IProjet, IObjectRemovedEvent)
def removeGroup(projet, event):
    acl_users = getToolByName(projet, 'acl_users')
    mail_host = getToolByName(projet, 'MailHost')
    portal_url = getToolByName(projet, 'portal_url')
    portal = portal_url.getPortalObject()
    sender = portal.getProperty('email_from_address')
    gr = portal.portal_groups
    group_id = projet.id
    if group_id in gr.getGroupIds():
        gr.removeGroup(group_id)
        log('Group %s removed' % group_id)


@grok.subscribe(IProjet, IObjectAddedEvent)
@grok.subscribe(IProjet, IObjectModifiedEvent)
def createGroup(projet, event):
    acl_users = getToolByName(projet, 'acl_users')
    mail_host = getToolByName(projet, 'MailHost')
    portal_url = getToolByName(projet, 'portal_url')
    catalog = getToolByName(projet, 'portal_catalog')
    portal = portal_url.getPortalObject()
    gr = portal.portal_groups
    group_id = projet.id
    log('=== Group creation ===> ' + group_id)
    group = gr.getGroupById(group_id)
    if not group:
        gr.addGroup(group_id)
        group = gr.getGroupById(group_id)
    admid = 'admin_%s' % projet.id
    adm = projet[admid]
    projectPath = projet.absolute_url()
    members = adm.objectValues()
    for member in members:
        if member.portal_type == 'ageliaco.rd.auteur':
            gr.addPrincipalToGroup(member.id, group_id)

    if IRoleManager.providedBy(projet):
        log('adding roles (contributor and Editor) to ' + group_id)
        projet.manage_addLocalRoles(group_id, ['Contributor', 'Editor'])


@grok.subscribe(IProjet, IObjectAddedEvent)
def setCycles(projet, event):
    admid = 'admin_%s' % projet.id
    try:
        cycles = projet[admid]
    except KeyError:
        projet.invokeFactory('ageliaco.rd.cycles', id=admid, title='Administration')
        cycles = projet[admid]


@grok.subscribe(IProjet, IObjectAddedEvent)
def setRealisation(projet, event):
    admid = 'realisation'
    try:
        cycles = projet[admid]
    except KeyError:
        rea = projet.invokeFactory('Folder', id=admid, title='Réalisation')


class View(grok.View):
    grok.context(IProjet)
    grok.require('zope2.View')

    def canRequestReview(self):
        return checkPermission('cmf.RequestReview', self.context)

    def logo_url(self):
        context = aq_inner(self.context)
        portal_url = getToolByName(context, 'portal_url')
        if 'logo.png' in context.keys():
            return context.absolute_url() + '/logo.png'
        return portal_url + '/++resource++ageliaco.rd/screens.png'

    def noCycle(self):
        context = aq_inner(self.context)
        admin = 'admin_' + context.id
        if admin in context.objectIds():
            administration = context[admin]
            if len(administration.objectIds()) > 0:
                return False
            return True
        return True

    def new_cycle_url(self):
        context = aq_inner(self.context)
        admid = 'admin_' + context.id
        url = context.absolute_url() + '/' + admid + '/++add++ageliaco.rd.cycle'
        return url

    def cycles(self):
        """Return a catalog search result of issues to show
        """
        context = aq_inner(self.context)
        admin = 'admin_' + context.id
        if admin in context.objectIds():
            administration = context[admin]
            return administration.objectValues()
        return []

    def canAddContent(self):
        return checkPermission('cmf.AddPortalContent', self.context)

    def canModifyContent(self):
        return checkPermission('cmf.ModifyPortalContent', self.context)

    def cycles_obj(self):
        context = aq_inner(self.context)
        l = []
        for (id, objet) in context.contentItems():
            if id == 'admin_' + context.id:
                for (i, obj) in objet.contentItems():
                    if obj.portal_type == 'ageliaco.rd.cycle':
                        l.append(obj)

        return l

    def admin_url(self):
        context = aq_inner(self.context)
        admid = 'admin_' + context.id
        if admid in context.keys():
            return context[admid].absolute_url()
        return ''

    def contributeur(self, auteur):
        context = aq_inner(self.context)
        admid = 'admin_' + context.id
        if admid in context.keys():
            parent = context[admid]
            if auteur in parent.keys():
                return parent[auteur]
        return