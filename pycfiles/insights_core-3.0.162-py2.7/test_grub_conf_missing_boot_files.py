# uncompyle6 version 3.7.4
# Python bytecode 2.7 (62211)
# Decompiled from: Python 3.6.9 (default, Apr 18 2020, 01:56:04) 
# [GCC 8.4.0]
# Embedded file name: build/bdist.linux-x86_64/egg/insights/parsers/tests/test_grub_conf_missing_boot_files.py
# Compiled at: 2019-11-14 13:57:46
from insights.tests import context_wrap
from insights.parsers.grub_conf import Grub1Config, Grub2Config
GRUB2_CFG_1 = ("\n## BEGIN /etc/grub.d/10_linux ###\nmenuentry 'Red Hat Enterprise Linux Server, with Linux 3.10.0-123.9.3.el7.x86_64' --class red --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-3.10.0-123.9.3.el7.x86_64-advanced-5a1c841f-5cfe-4d59-b3a0-4b788369d6cb' {\n    load_video\n    set gfxpayload=keep\n    insmod gzio\n    insmod part_msdos\n    insmod ext2\n    set root='hd0,msdos1'\n    if [ x$feature_platform_search_hint = xy ]; then\n      search --no-floppy --fs-uuid --set=root --hint-bios=hd0,msdos1 --hint-efi=hd0,msdos1 --hint-baremetal=ahci0,msdos1 --hint='hd0,msdos1'  93f2c0dc-6201-4d26-a610-4b3998983ea2\n    else\n      search --no-floppy --fs-uuid --set=root 93f2c0dc-6201-4d26-a610-4b3998983ea2\n    fi\n    linux16 /vmlinuz-3.10.0-123.9.3.el7.x86_64 root=UUID=5a1c841f-5cfe-4d59-b3a0-4b788369d6cb ro crashkernel=auto  vconsole.font=latarcyrheb-sun16 console=ttyS0,38400 rd.lvm.lv=VG_RACS-CCP/lv-rootfs vconsole.keymap=us LANG=en_US.UTF-8\n    initrd16 /initramfs-3.10.0-123.9.3.el7.x86_64.img\n}\nmenuentry 'Red Hat Enterprise Linux Server, with Linux 0-rescue-00c2fbfaa85544e48d6ca1d919fa2dd3' --class red --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-0-rescue-00c2fbfaa85544e48d6ca1d919fa2dd3-advanced-5a1c841f-5cfe-4d59-b3a0-4b788369d6cb' {\n    load_video\n    insmod gzio\n    insmod part_msdos\n    insmod ext2\n    set root='hd0,msdos1'\n    if [ x$feature_platform_search_hint = xy ]; then\n      search --no-floppy --fs-uuid --set=root --hint-bios=hd0,msdos1 --hint-efi=hd0,msdos1 --hint-baremetal=ahci0,msdos1 --hint='hd0,msdos1'  93f2c0dc-6201-4d26-a610-4b3998983ea2\n    else\n      search --no-floppy --fs-uuid --set=root 93f2c0dc-6201-4d26-a610-4b3998983ea2\n    fi\n    linux16 /vmlinuz-0-rescue-00c2fbfaa85544e48d6ca1d919fa2dd3 root=UUID=5a1c841f-5cfe-4d59-b3a0-4b788369d6cb ro crashkernel=auto  vconsole.font=latarcyrheb-sun16 console=ttyS0,38400 rd.lvm.lv=VG_RACS-CCP/lv-rootfs vconsole.keymap=us\n    initrd16 /initramfs-0-rescue-00c2fbfaa85544e48d6ca1d919fa2dd3.img\n}\n").strip()
LS_BOOT_1 = ('\n/boot:\ntotal 68392\ndr-xr-xr-x.  4 0 0     4096 Jan 12 17:45 .\ndrwxr-xr-x. 19 0 0     4096 Jan 13 19:49 ..\n-rw-r--r--.  1 0 0      170 Oct 30 09:50 .vmlinuz-3.10.0-123.9.3.el7.x86_64.hmac\n-rw-------.  1 0 0  2841475 Oct 30 09:50 System.map-3.10.0-123.9.3.el7.x86_64\n-rw-r--r--.  1 0 0   122093 Oct 30 09:50 config-3.10.0-123.9.3.el7.x86_64\ndrwxr-xr-x.  6 0 0     4096 Jan 12 17:45 grub2\n-rw-r--r--.  1 0 0 38922434 Jan 12 17:45 initramfs-0-rescue-00c2fbfaa85544e48d6ca1d919fa2dd3.img\n-rw-r--r--.  1 0 0 17364252 Jan 12 17:45 initramfs-3.10.0-123.9.3.el7.x86_64.img\n-rw-r--r--.  1 0 0   589451 Jan 12 17:45 initrd-plymouth.img\ndrwx------.  2 0 0    16384 Jan 12 17:38 lost+found\n-rw-r--r--.  1 0 0   228621 Oct 30 09:52 symvers-3.10.0-123.9.3.el7.x86_64.gz\n-rwxr-xr-x.  1 0 0  4904112 Jan 12 17:45 vmlinuz-0-rescue-00c2fbfaa85544e48d6ca1d919fa2dd3\n-rwxr-xr-x.  1 0 0  4904112 Oct 30 09:50 vmlinuz-3.10.0-123.9.3.el7.x86_64\n').strip()
GRUB2_CFG_2 = ("\n### BEGIN /etc/grub.d/10_linux ###\nmenuentry 'Red Hat Enterprise Linux Server (3.10.0-229.el7.x86_64) 7.0 (Maipo)' --class red --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-3.10.0-123.el7.x86_64-advanced-7f18fec3-a016-42ab-9bb9-6e7f6a5985ca' {\n    linux16 /vmlinuz-3.10.0-229.el7.x86_64 root=/dev/mapper/rhel-root ro rd.lvm.lv=rhel/root crashkernel=auto  rd.lvm.lv=rhel/swap vconsole.font=latarcyrheb-sun16 vconsole.keymap=us rhgb quiet LANG=en_AU.UTF-8\n    initrd16 /initramfs-3.10.0-229.el7.x86_64.img\n}\nmenuentry 'Red Hat Enterprise Linux Server (3.10.0-123.13.2.el7.x86_64) 7.0 (Maipo)' --class red --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-3.10.0-123.el7.x86_64-advanced-7f18fec3-a016-42ab-9bb9-6e7f6a5985ca' {\n    linux16 /vmlinuz-3.10.0-123.13.2.el7.x86_64 root=/dev/mapper/rhel-root ro rd.lvm.lv=rhel/root crashkernel=auto  rd.lvm.lv=rhel/swap vconsole.font=latarcyrheb-sun16 vconsole.keymap=us rhgb quiet LANG=en_AU.UTF-8\n    initrd16 /initramfs-3.10.0-123.13.2.el7.x86_64.img\n}\nmenuentry 'Red Hat Enterprise Linux Server, with Linux 3.10.0-123.el7.x86_64' --class red --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-3.10.0-123.el7.x86_64-advanced-7f18fec3-a016-42ab-9bb9-6e7f6a5985ca' {\n    linux16 /vmlinuz-3.10.0-123.el7.x86_64 root=UUID=7f18fec3-a016-42ab-9bb9-6e7f6a5985ca ro rd.lvm.lv=rhel/root crashkernel=auto  rd.lvm.lv=rhel/swap vconsole.font=latarcyrheb-sun16 vconsole.keymap=us rhgb quiet LANG=en_AU.UTF-8\n    initrd16 /initramfs-3.10.0-123.el7.x86_64.img\n}\nmenuentry 'Red Hat Enterprise Linux Server, with Linux 0-rescue-13798ffcbc1ed4374f3f2e0fa6c923ad' --class red --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-0-rescue-13798ffcbc1ed4374f3f2e0fa6c923ad-advanced-7f18fec3-a016-42ab-9bb9-6e7f6a5985ca' {\n    linux16 /vmlinuz-0-rescue-13798ffcbc1ed4374f3f2e0fa6c923ad root=UUID=7f18fec3-a016-42ab-9bb9-6e7f6a5985ca ro rd.lvm.lv=rhel/root crashkernel=auto  rd.lvm.lv=rhel/swap vconsole.font=latarcyrheb-sun16 vconsole.keymap=us rhgb quiet\n    initrd16 /initramfs-0-rescue-13798ffcbc1ed4374f3f2e0fa6c923ad.img\n}\n").strip()
LS_BOOT_2 = ('\n/boot:\ntotal 173260\ndr-xr-xr-x.  3 0 0     4096 Mar 26 12:23 .\ndrwxr-xr-x. 17 0 0     4096 Mar 26 11:12 ..\n-rw-r--r--.  1 0 0      171 Dec 13 10:54 .vmlinuz-3.10.0-123.13.2.el7.x86_64.hmac\n-rw-r--r--.  1 0 0      166 May  6  2014 .vmlinuz-3.10.0-123.el7.x86_64.hmac\n-rw-r--r--.  1 0 0      166 Jan 30 09:40 .vmlinuz-3.10.0-229.el7.x86_64.hmac\n-rw-------.  1 0 0  2841409 Dec 13 10:54 System.map-3.10.0-123.13.2.el7.x86_64\n-rw-------.  1 0 0  2840084 May  6  2014 System.map-3.10.0-123.el7.x86_64\n-rw-------.  1 0 0  2881257 Jan 30 09:40 System.map-3.10.0-229.el7.x86_64\n-rw-r--r--.  1 0 0   122094 Dec 13 10:54 config-3.10.0-123.13.2.el7.x86_64\n-rw-r--r--.  1 0 0   122059 May  6  2014 config-3.10.0-123.el7.x86_64\n-rw-r--r--.  1 0 0   123838 Jan 30 09:40 config-3.10.0-229.el7.x86_64\ndrwxr-xr-x.  6 0 0      104 Mar 26 12:05 grub2\n-rw-r--r--.  1 0 0 40654410 Dec 22 14:48 initramfs-0-rescue-13798ffcbc1ed4374f3f2e0fa6c923ad.img\n-rw-------.  1 0 0 16742742 Dec 22 15:36 initramfs-3.10.0-123.13.2.el7.x86_64.img\n-rw-------.  1 0 0 18795253 Mar 26 12:02 initramfs-3.10.0-123.13.2.el7.x86_64kdump.img\n-rw-------.  1 0 0 17246244 Dec 22 14:52 initramfs-3.10.0-123.el7.x86_64.img\n-rw-------.  1 0 0 17111790 Dec 22 15:34 initramfs-3.10.0-123.el7.x86_64kdump.img\n-rw-------.  1 0 0 18180132 Mar 26 12:05 initramfs-3.10.0-229.el7.x86_64.img\n-rw-------.  1 0 0 18400548 Mar 26 12:23 initramfs-3.10.0-229.el7.x86_64kdump.img\n-rw-r--r--.  1 0 0   867063 Mar 26 12:05 initrd-plymouth.img\n-rw-r--r--.  1 0 0   228603 Dec 13 10:55 symvers-3.10.0-123.13.2.el7.x86_64.gz\n-rw-r--r--.  1 0 0   228562 May  6  2014 symvers-3.10.0-123.el7.x86_64.gz\n-rw-r--r--.  1 0 0   240039 Jan 30 09:44 symvers-3.10.0-229.el7.x86_64.gz\n-rwxr-xr-x.  1 0 0  4902000 Dec 22 14:48 vmlinuz-0-rescue-13798ffcbc1ed4374f3f2e0fa6c923ad\n-rwxr-xr-x.  1 0 0  4904688 Dec 13 10:54 vmlinuz-3.10.0-123.13.2.el7.x86_64\n-rwxr-xr-x.  1 0 0  4902000 May  6  2014 vmlinuz-3.10.0-123.el7.x86_64\n-rwxr-xr-x.  1 0 0  5026624 Jan 30 09:40 vmlinuz-3.10.0-229.el7.x86_64\n').strip()
GRUB_CONF_3 = ('\n# grub.conf generated by anaconda\n#\n# Note that you do not have to rerun grub after making changes to this file\n# NOTICE:  You have a /boot partition.  This means that\n#          all kernel and initrd paths are relative to /boot/, eg.\n#          root (hd0,0)\n#          kernel /vmlinuz-version ro root=/dev/cciss/c0d0p3\n#          initrd /initrd-version.img\n#boot=/dev/cciss/c0d0\ndefault=1\n# fallback=0 # commented out by Proliant HBA install script\ntimeout=5\nsplashimage=(hd0,0)/grub/splash.xpm.gz\nhiddenmenu\ntitle Red Hat Enterprise Linux Server (2.6.18-194.8.1.el5)\n    root (hd0,0)\n    kernel /vmlinuz-2.6.18-194.8.1.el5 ro root=LABEL=/1 crashkernel=128M@16M\n    initrd /initrd-2.6.18-194.8.1.el5.img\n\ntitle Red Hat Enterprise Linux Server (2.6.18-194.17.1.el5)\n    root (hd0,0)\n    kernel /vmlinuz-2.6.18-194.17.1.el5 ro root=LABEL=/1 crashkernel=128M@16M\n    initrd /initrd-2.6.18-194.17.1.el5.img\n').strip()
GRUB_CONF_LINKS = ('\ntitle Linux (Logical Disk 0)\n        root (hd0,0)\n        kernel /boot/vmlinuz ro root=LABEL=/root LANG=en_US.UTF-8 SYSFONT=latarcyrheb-sun16 KEYBOARDTYPE=pc KEYTABLE=us crashkernel=768M  rd_NO_PLYMOUTH nodmraid\n        initrd /boot/initrd\n').strip()
GRUB_CONF_XEN = ('\ntitle Red Hat Enterprise Linux Server (2.6.18-398.el5xen)\n    root (hd0,0)\n    kernel /xen.gz-2.6.18-398.el5\n    module /vmlinuz-2.6.18-398.el5xen ro root=/dev/sda2\n    module /initrd-2.6.18-398.el5xen.img\n').strip()
GRUB_CONF_IPXE = ('\ntitle iPXE\n  root (hd0,0)\n  kernel (hd0,0)/boot/ipxe.lkrn\n').strip()

def test_get_grub_kernel_initrd_1():
    expected_result = {'grub_kernels': ['vmlinuz-2.6.18-194.8.1.el5', 'vmlinuz-2.6.18-194.17.1.el5'], 'grub_initrds': [
                      'initrd-2.6.18-194.8.1.el5.img', 'initrd-2.6.18-194.17.1.el5.img']}
    assert expected_result == Grub1Config(context_wrap(GRUB_CONF_3)).kernel_initrds
    expected_result = {'grub_kernels': ['vmlinuz'], 'grub_initrds': ['initrd']}
    assert expected_result == Grub1Config(context_wrap(GRUB_CONF_LINKS)).kernel_initrds
    expected_result = {'grub_kernels': ['vmlinuz-2.6.18-398.el5xen'], 'grub_initrds': ['initrd-2.6.18-398.el5xen.img']}
    assert expected_result == Grub1Config(context_wrap(GRUB_CONF_XEN)).kernel_initrds
    expected_result = {'grub_kernels': [], 'grub_initrds': []}
    assert expected_result == Grub1Config(context_wrap(LS_BOOT_1)).kernel_initrds
    assert expected_result, Grub1Config(context_wrap(LS_BOOT_2)).kernel_initrds
    assert Grub1Config(context_wrap(GRUB_CONF_IPXE)).kernel_initrds == {}


def test_get_grub_kernel_initrd_2():
    expected_result = {'grub_kernels': ['vmlinuz-3.10.0-123.9.3.el7.x86_64', 'vmlinuz-0-rescue-00c2fbfaa85544e48d6ca1d919fa2dd3'], 'grub_initrds': [
                      'initramfs-3.10.0-123.9.3.el7.x86_64.img', 'initramfs-0-rescue-00c2fbfaa85544e48d6ca1d919fa2dd3.img']}
    assert expected_result == Grub2Config(context_wrap(GRUB2_CFG_1)).kernel_initrds == expected_result
    expected_result = {'grub_kernels': ['vmlinuz-3.10.0-229.el7.x86_64', 'vmlinuz-3.10.0-123.13.2.el7.x86_64',
                      'vmlinuz-3.10.0-123.el7.x86_64', 'vmlinuz-0-rescue-13798ffcbc1ed4374f3f2e0fa6c923ad'], 
       'grub_initrds': [
                      'initramfs-3.10.0-229.el7.x86_64.img', 'initramfs-3.10.0-123.13.2.el7.x86_64.img',
                      'initramfs-3.10.0-123.el7.x86_64.img', 'initramfs-0-rescue-13798ffcbc1ed4374f3f2e0fa6c923ad.img']}
    assert expected_result == Grub2Config(context_wrap(GRUB2_CFG_2)).kernel_initrds
    expected_result = {'grub_kernels': [], 'grub_initrds': []}
    assert expected_result == Grub2Config(context_wrap(LS_BOOT_1)).kernel_initrds
    assert expected_result, Grub2Config(context_wrap(LS_BOOT_2)).kernel_initrds