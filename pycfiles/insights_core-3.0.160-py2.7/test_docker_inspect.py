# uncompyle6 version 3.7.4
# Python bytecode 2.7 (62211)
# Decompiled from: Python 3.6.9 (default, Apr 18 2020, 01:56:04) 
# [GCC 8.4.0]
# Embedded file name: build/bdist.linux-x86_64/egg/insights/parsers/tests/test_docker_inspect.py
# Compiled at: 2019-11-14 13:57:46
import pytest, doctest
from insights.parsers import docker_inspect, SkipException
from insights.tests import context_wrap
DOCKER_CONTAINER_INSPECT = ('\n[\n{\n    "Id": "97d7cd1a5d8fd7730e83bb61ecbc993742438e966ac5c11910776b5d53f4ae07",\n    "Created": "2016-06-23T05:12:25.433469799Z",\n    "Path": "/bin/bash",\n    "Args": [],\n    "State": {\n        "Status": "running",\n        "Running": true,\n        "Paused": false,\n        "Restarting": false,\n        "OOMKilled": false,\n        "Dead": false,\n        "Pid": 15096,\n        "ExitCode": 0,\n        "Error": "",\n        "StartedAt": "2016-06-23T05:37:56.925378831Z",\n        "FinishedAt": "2016-06-23T05:33:02.012653984Z"\n    },\n    "Image": "882ab98aae5394aebe91fe6d8a4297fa0387c3cfd421b2d892bddf218ac373b2",\n    "ResolvConfPath": "/var/lib/docker/containers/97d7cd1a5d8fd7730e83bb61ecbc993742438e966ac5c11910776b5d53f4ae07/resolv.conf",\n    "HostnamePath": "/var/lib/docker/containers/97d7cd1a5d8fd7730e83bb61ecbc993742438e966ac5c11910776b5d53f4ae07/hostname",\n    "HostsPath": "/var/lib/docker/containers/97d7cd1a5d8fd7730e83bb61ecbc993742438e966ac5c11910776b5d53f4ae07/hosts",\n    "LogPath": "/var/lib/docker/containers/97d7cd1a5d8fd7730e83bb61ecbc993742438e966ac5c11910776b5d53f4ae07/97d7cd1a5d8fd7730e83bb61ecbc993742438e966ac5c11910776b5d53f4ae07-json.log",\n    "Name": "/hehe2",\n    "RestartCount": 0,\n    "Driver": "devicemapper",\n    "ExecDriver": "native-0.2",\n    "MountLabel": "system_u:object_r:svirt_sandbox_file_t:s0:c429,c690",\n    "ProcessLabel": "system_u:system_r:svirt_lxc_net_t:s0:c429,c690",\n    "AppArmorProfile": "",\n    "ExecIDs": null,\n    "HostConfig": {\n        "Binds": null,\n        "ContainerIDFile": "",\n        "LxcConf": [],\n        "Memory": 0,\n        "MemoryReservation": 0,\n        "MemorySwap": 0,\n        "KernelMemory": 0,\n        "CpuShares": 0,\n        "CpuPeriod": 0,\n        "CpusetCpus": "",\n        "CpusetMems": "",\n        "CpuQuota": 0,\n        "BlkioWeight": 0,\n        "OomKillDisable": false,\n        "MemorySwappiness": -1,\n        "Privileged": false,\n        "PortBindings": {},\n        "Links": null,\n        "PublishAllPorts": false,\n        "Dns": [],\n        "DnsOptions": [],\n        "DnsSearch": [],\n        "ExtraHosts": null,\n        "VolumesFrom": null,\n        "Devices": [],\n        "NetworkMode": "default",\n        "IpcMode": "",\n        "PidMode": "",\n        "UTSMode": "",\n        "CapAdd": null,\n        "CapDrop": null,\n        "GroupAdd": null,\n        "RestartPolicy": {\n            "Name": "no",\n            "MaximumRetryCount": 0\n        },\n        "SecurityOpt": null,\n        "ReadonlyRootfs": false,\n        "Ulimits": null,\n        "Sysctls": {},\n        "LogConfig": {\n            "Type": "json-file",\n            "Config": {\n                "max-file": "7",\n                "max-size": "10m"\n            }\n        },\n        "CgroupParent": "",\n        "ConsoleSize": [\n            0,\n            0\n        ],\n        "VolumeDriver": "",\n        "ShmSize": 67108864\n    },\n    "GraphDriver": {\n        "Name": "devicemapper",\n        "Data": {\n            "DeviceId": "433",\n            "DeviceName": "docker-253:0-71431059-97d7cd1a5d8fd7730e83bb61ecbc993742438e966ac5c11910776b5d53f4ae07",\n            "DeviceSize": "107374182400"\n        }\n    },\n    "Mounts": [],\n    "Config": {\n        "Hostname": "97d7cd1a5d8f",\n        "Domainname": "",\n        "User": "root",\n        "AttachStdin": true,\n        "AttachStdout": true,\n        "AttachStderr": true,\n        "Tty": true,\n        "OpenStdin": true,\n        "StdinOnce": true,\n        "Env": [\n            "container=docker",\n            "PKGM=yum",\n            "PATH=/usr/local/bin:/usr/bin:/bin:/usr/local/sbin:/usr/sbin"\n        ],\n        "Cmd": [\n            "/bin/bash"\n        ],\n        "Image": "rhel7_imagemagick",\n        "Volumes": null,\n        "WorkingDir": "",\n        "Entrypoint": null,\n        "OnBuild": null,\n        "Labels": {\n            "Architecture": "x86_64",\n            "Authoritative_Registry": "registry.access.redhat.com",\n            "BZComponent": "rhel-server-docker",\n            "Build_Host": "rcm-img03.build.eng.bos.redhat.com",\n            "Name": "rhel7/rhel",\n            "Release": "61",\n            "Vendor": "Red Hat, Inc.",\n            "Version": "7.2",\n            "io.projectatomic.Temporary": "true"\n        },\n        "StopSignal": "SIGTERM"\n    },\n    "NetworkSettings": {\n        "Bridge": "",\n        "SandboxID": "f1cce5397340364aff043879ff5bd7e2ce2fcc5b81cfb7fe1833ce7b57eb6cf8",\n        "HairpinMode": false,\n        "LinkLocalIPv6Address": "",\n        "LinkLocalIPv6PrefixLen": 0,\n        "Ports": {},\n        "SandboxKey": "/var/run/docker/netns/f1cce5397340",\n        "SecondaryIPAddresses": null,\n        "SecondaryIPv6Addresses": null,\n        "EndpointID": "59be4c94b2a1346eb0ec16472bc132e071d18733fd956c34b3b1defff9bba389",\n        "Gateway": "172.17.0.1",\n        "GlobalIPv6Address": "",\n        "GlobalIPv6PrefixLen": 0,\n        "IPAddress": "172.17.0.2",\n        "IPPrefixLen": 16,\n        "IPv6Gateway": "",\n        "MacAddress": "02:42:ac:11:00:02",\n        "Networks": {\n            "bridge": {\n                "EndpointID": "59be4c94b2a1346eb0ec16472bc132e071d18733fd956c34b3b1defff9bba389",\n                "Gateway": "172.17.0.1",\n                "IPAddress": "172.17.0.2",\n                "IPPrefixLen": 16,\n                "IPv6Gateway": "",\n                "GlobalIPv6Address": "",\n                "GlobalIPv6PrefixLen": 0,\n                "MacAddress": "02:42:ac:11:00:02"\n            }\n        }\n    }\n}\n]\n').splitlines()
DOCKER_IMAGE_INSPECT = ('\n[\n{\n    "Id": "882ab98aae5394aebe91fe6d8a4297fa0387c3cfd421b2d892bddf218ac373b2",\n    "RepoTags": [\n        "rhel7_imagemagick:latest"\n    ],\n    "RepoDigests": [],\n    "Parent": "34c167d900afb820ecab622a214ce3207af80ec755c0dcb6165b425087ddbc3a",\n    "Comment": "",\n    "Created": "2016-06-23T03:39:15.068803433Z",\n    "Container": "65410bf8809af52d2074c882917ea0651b119a91f460c1037bc99d4d5976532a",\n    "ContainerConfig": {\n        "Hostname": "cf3092658f01",\n        "Domainname": "",\n        "User": "root",\n        "AttachStdin": false,\n        "AttachStdout": false,\n        "AttachStderr": false,\n        "Tty": false,\n        "OpenStdin": false,\n        "StdinOnce": false,\n        "Env": [\n            "container=docker",\n            "PKGM=yum",\n            "PATH=/usr/local/bin:/usr/bin:/bin:/usr/local/sbin:/usr/sbin"\n        ],\n        "Cmd": [\n            "/bin/sh",\n            "-c",\n            "yum install -y ImageMagick-6.7.8.9-10.el7"\n        ],\n        "Image": "34c167d900afb820ecab622a214ce3207af80ec755c0dcb6165b425087ddbc3a",\n        "Volumes": null,\n        "WorkingDir": "",\n        "Entrypoint": null,\n        "OnBuild": [],\n        "Labels": {\n            "Architecture": "x86_64",\n            "Authoritative_Registry": "registry.access.redhat.com",\n            "BZComponent": "rhel-server-docker",\n            "Build_Host": "rcm-img03.build.eng.bos.redhat.com",\n            "Name": "rhel7/rhel",\n            "Release": "61",\n            "Vendor": "Red Hat, Inc.",\n            "Version": "7.2"\n        }\n    },\n    "DockerVersion": "1.9.1",\n    "Author": "",\n    "Config": {\n        "Hostname": "cf3092658f01",\n        "Domainname": "",\n        "User": "root",\n        "AttachStdin": false,\n        "AttachStdout": false,\n        "AttachStderr": false,\n        "Tty": false,\n        "OpenStdin": false,\n        "StdinOnce": false,\n        "Env": [\n            "container=docker",\n            "PKGM=yum",\n            "PATH=/usr/local/bin:/usr/bin:/bin:/usr/local/sbin:/usr/sbin"\n        ],\n        "Cmd": [\n            "/usr/bin/bash"\n        ],\n        "Image": "34c167d900afb820ecab622a214ce3207af80ec755c0dcb6165b425087ddbc3a",\n        "Volumes": null,\n        "WorkingDir": "",\n        "Entrypoint": null,\n        "OnBuild": [],\n        "Labels": {\n            "Architecture": "x86_64",\n            "Authoritative_Registry": "registry.access.redhat.com",\n            "BZComponent": "rhel-server-docker",\n            "Build_Host": "rcm-img03.build.eng.bos.redhat.com",\n            "Name": "rhel7/rhel",\n            "Release": "61",\n            "Vendor": "Red Hat, Inc.",\n            "Version": "7.2"\n        }\n    },\n    "Architecture": "amd64",\n    "Os": "linux",\n    "Size": 580094174,\n    "VirtualSize": 785437820,\n    "GraphDriver": {\n        "Name": "devicemapper",\n        "Data": {\n            "DeviceId": "431",\n            "DeviceName": "docker-253:0-71431059-882ab98aae5394aebe91fe6d8a4297fa0387c3cfd421b2d892bddf218ac373b2",\n            "DeviceSize": "107374182400"\n        }\n    }\n}\n]\n').splitlines()
DOCKER_CONTAINER_INSPECT_TRUNCATED = '\n[\n{\n    "Id": "97d7cd1a5d8fd7730e83bb61ecbc993742438e966ac5c11910776b5d53f4ae07",\n    "Created": "2016-06-23T05:12:25.433469799Z",\n    "Path": "/bin/bash",\n'

def test_docker_object_container_inspect():
    result = docker_inspect.DockerInspect(context_wrap(DOCKER_CONTAINER_INSPECT))
    assert result.get('Id') == '97d7cd1a5d8fd7730e83bb61ecbc993742438e966ac5c11910776b5d53f4ae07'
    assert result.get('NetworkSettings').get('HairpinMode') is False
    assert result.get('Config').get('Env') == ['container=docker', 'PKGM=yum', 'PATH=/usr/local/bin:/usr/bin:/bin:/usr/local/sbin:/usr/sbin']
    assert result.get('GraphDriver').get('Data').get('DeviceSize') == '107374182400'


def test_docker_object_image_inspect():
    result = docker_inspect.DockerInspect(context_wrap(DOCKER_IMAGE_INSPECT))
    assert result.get('Id') == '882ab98aae5394aebe91fe6d8a4297fa0387c3cfd421b2d892bddf218ac373b2'
    assert result.get('Size') == 580094174
    assert result.get('Config').get('AttachStdin') is False
    assert result.get('RepoDigests') == []


def test_docker_container_inspect_truncated_input():
    with pytest.raises(SkipException):
        docker_inspect.DockerInspectContainer(context_wrap(DOCKER_CONTAINER_INSPECT_TRUNCATED))


def test_doc_test():
    dic = docker_inspect.DockerInspectContainer(context_wrap(DOCKER_CONTAINER_INSPECT))
    dii = docker_inspect.DockerInspectImage(context_wrap(DOCKER_IMAGE_INSPECT))
    env = {'container': dic, 
       'image': dii}
    failed, total = doctest.testmod(docker_inspect, globs=env)
    assert failed == 0