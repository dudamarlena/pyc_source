# uncompyle6 version 3.7.4
# Python bytecode 2.7 (62211)
# Decompiled from: Python 3.6.9 (default, Apr 18 2020, 01:56:04) 
# [GCC 8.4.0]
# Embedded file name: build/bdist.linux-x86_64/egg/insights/parsers/tests/test_openshift_get_with_config.py
# Compiled at: 2019-05-16 13:41:33
from insights.parsers import openshift_get_with_config, ParseException
from insights.parsers.openshift_get_with_config import OcGetClusterRoleWithConfig, OcGetClusterRoleBindingWithConfig
from insights.tests import context_wrap
import doctest, pytest
OC_GET_CLUSTER_ROLE = ('\nNAME\nadmin\nasb-access\nasb-auth\nbasic-user\ncluster-admin\ncluster-debugger\ncluster-reader\ncluster-status\nedit\nhawkular-metrics-admin\nmanagement-infra-admin\nnamespace-viewer\nregistry-admin\nregistry-editor\nregistry-viewer\nrolebinding-reader\nsar-creator\nself-access-reviewer\nself-provisioner\nservice-catalog-controller\nservicecatalog-serviceclass-viewer\nstorage-admin\nsudoer\nsystem:aggregate-to-admin\nsystem:aggregate-to-edit\nsystem:aggregate-to-view\nsystem:auth-delegator\nsystem:aws-cloud-provider\nsystem:basic-user\nsystem:build-controller\nsystem:build-strategy-custom\nsystem:build-strategy-docker\nsystem:build-strategy-jenkinspipeline\nsystem:build-strategy-source\nsystem:certificate-signing-controller\nsystem:certificates.k8s.io:certificatesigningrequests:nodeclient\nsystem:certificates.k8s.io:certificatesigningrequests:selfnodeclient\nsystem:controller:attachdetach-controller\nsystem:controller:certificate-controller\nsystem:controller:clusterrole-aggregation-controller\nsystem:controller:cronjob-controller\nsystem:controller:daemon-set-controller\nsystem:controller:deployment-controller\nsystem:controller:disruption-controller\nsystem:controller:endpoint-controller\nsystem:controller:generic-garbage-collector\nsystem:controller:horizontal-pod-autoscaler\nsystem:controller:job-controller\nsystem:controller:namespace-controller\nsystem:controller:node-controller\nsystem:controller:persistent-volume-binder\nsystem:controller:pod-garbage-collector\nsystem:controller:replicaset-controller\nsystem:controller:replication-controller\nsystem:controller:resourcequota-controller\nsystem:controller:route-controller\nsystem:controller:service-account-controller\nsystem:controller:service-controller\nsystem:controller:statefulset-controller\nsystem:controller:ttl-controller\nsystem:daemonset-controller\nsystem:deployer\nsystem:deployment-controller\nsystem:deploymentconfig-controller\nsystem:discovery\nsystem:disruption-controller\nsystem:endpoint-controller\nsystem:garbage-collector-controller\nsystem:gc-controller\nsystem:heapster\nsystem:hpa-controller\nsystem:image-auditor\nsystem:image-builder\nsystem:image-pruner\nsystem:image-puller\nsystem:image-pusher\nsystem:image-signer\nsystem:job-controller\nsystem:kube-aggregator\nsystem:kube-controller-manager\nsystem:kube-dns\nsystem:kube-scheduler\nsystem:master\nsystem:namespace-controller\nsystem:node\nsystem:node-admin\nsystem:node-bootstrapper\nsystem:node-problem-detector\nsystem:node-proxier\nsystem:node-reader\nsystem:oauth-token-deleter\nsystem:openshift:aggregate-to-admin\nsystem:openshift:aggregate-to-edit\nsystem:openshift:aggregate-to-view\nsystem:openshift:controller:build-config-change-controller\nsystem:openshift:controller:build-controller\nsystem:openshift:controller:cluster-quota-reconciliation-controller\nsystem:openshift:controller:deployer-controller\nsystem:openshift:controller:deploymentconfig-controller\nsystem:openshift:controller:horizontal-pod-autoscaler\nsystem:openshift:controller:image-import-controller\nsystem:openshift:controller:image-trigger-controller\nsystem:openshift:controller:origin-namespace-controller\nsystem:openshift:controller:pv-recycler-controller\nsystem:openshift:controller:resourcequota-controller\nsystem:openshift:controller:sdn-controller\nsystem:openshift:controller:service-ingress-ip-controller\nsystem:openshift:controller:service-serving-cert-controller\nsystem:openshift:controller:serviceaccount-controller\nsystem:openshift:controller:serviceaccount-pull-secrets-controller\nsystem:openshift:controller:template-instance-controller\nsystem:openshift:controller:template-service-broker\nsystem:openshift:controller:unidling-controller\nsystem:openshift:templateservicebroker-client\nsystem:persistent-volume-provisioner\nsystem:registry\nsystem:replicaset-controller\nsystem:replication-controller\nsystem:router\nsystem:scope-impersonation\nsystem:sdn-manager\nsystem:sdn-reader\nsystem:service-catalog:aggregate-to-admin\nsystem:service-catalog:aggregate-to-edit\nsystem:service-catalog:aggregate-to-view\nsystem:statefulset-controller\nsystem:webhook\nview\n').strip()
OC_GET_CLUSTERROLEBINDING = ('\nNAME                                                                  ROLE                                                                   USERS                            GROUPS                                         SERVICE ACCOUNTS                                                                   SUBJECTS\nadmin                                                                 /admin                                                                                                                                                 openshift-infra/template-instance-controller\nadmin-0                                                               /admin                                                                                                                                                 kube-service-catalog/default\nadmin-1                                                               /admin                                                                                                                                                 openshift-ansible-service-broker/asb\nasb-access                                                            /asb-access                                                                                                                                            openshift-ansible-service-broker/asb-client\nasb-auth                                                              /asb-auth                                                                                                                                              openshift-ansible-service-broker/asb\nauth-delegator-openshift-template-service-broker                      /system:auth-delegator                                                                                                                                 openshift-template-service-broker/apiserver\nbasic-users                                                           /basic-user                                                                                             system:authenticated\ncluster-admin                                                         /cluster-admin                                                                                          system:masters\ncluster-admin-0                                                       /cluster-admin                                                                                                                                         insights-scan/insights-scan\ncluster-admins                                                        /cluster-admin\n').strip()
OC_GET_CLUSTERROLEBINDING_INVALID = ('\nNAME                                                                  ROLE                                                                   USERS                            GROUPS                                         SERVICE ACCOUNTS                                                                   SUBJECTS\nadmin\nadmin-0                                                               /admin                                                                                                                                                 kube-service-catalog/default\nadmin-1                                                               /admin                                                                                                                                                 openshift-ansible-service-broker/asb\nasb-access                                                            /asb-access                                                                                                                                            openshift-ansible-service-broker/asb-client\nasb-auth                                                              /asb-auth                                                                                                                                              openshift-ansible-service-broker/asb\nauth-delegator-openshift-template-service-broker                      /system:auth-delegator                                                                                                                                 openshift-template-service-broker/apiserver\nbasic-users                                                           /basic-user                                                                                             system:authenticated\ncluster-admin                                                         /cluster-admin                                                                                          system:masters\ncluster-admin-0                                                       /cluster-admin                                                                                                                                         insights-scan/insights-scan\ncluster-admins                                                        /cluster-admin\n').strip()
OC_GET_CLUSTERROLEBINDING_INVALID2 = ('\nadmin-0                                                               /admin                                                                                                                                                 kube-service-catalog/default\nadmin-1                                                               /admin                                                                                                                                                 openshift-ansible-service-broker/asb\nasb-access                                                            /asb-access                                                                                                                                            openshift-ansible-service-broker/asb-client\nasb-auth                                                              /asb-auth                                                                                                                                              openshift-ansible-service-broker/asb\nauth-delegator-openshift-template-service-broker                      /system:auth-delegator                                                                                                                                 openshift-template-service-broker/apiserver\nbasic-users                                                           /basic-user                                                                                             system:authenticated\ncluster-admin                                                         /cluster-admin                                                                                          system:masters\ncluster-admin-0                                                       /cluster-admin                                                                                                                                         insights-scan/insights-scan\ncluster-admins                                                        /cluster-admin\n').strip()
OC_GET_CLUSTER_ROLE_INVALID = ('\nname\nadmin\n').strip()

def test_oc_get_cluster_role_with_config():
    result = openshift_get_with_config.OcGetClusterRoleWithConfig(context_wrap(OC_GET_CLUSTER_ROLE))
    assert result.data[0] == 'admin'
    assert 'admin' in result
    assert result[0] == 'admin'


def test_oc_get_cluster_role_with_config_2():
    with pytest.raises(ParseException) as (e):
        openshift_get_with_config.OcGetClusterRoleWithConfig(context_wrap(OC_GET_CLUSTER_ROLE_INVALID))
    assert 'invalid' in str(e)


def test_oc_get_clusterrolebinding_with_config():
    result = openshift_get_with_config.OcGetClusterRoleBindingWithConfig(context_wrap(OC_GET_CLUSTERROLEBINDING))
    assert result.rolebinding['admin'] == '/admin'
    assert result.data == [
     {'NAME': 'admin', 'ROLE': '/admin', 'USERS': '', 'GROUPS': '', 'SERVICE_ACCOUNTS': 'openshift-infra/template-instance-controller', 
        'SUBJECTS': ''},
     {'NAME': 'admin-0', 'ROLE': '/admin', 'USERS': '', 'GROUPS': '', 'SERVICE_ACCOUNTS': 'kube-service-catalog/default', 
        'SUBJECTS': ''},
     {'NAME': 'admin-1', 'ROLE': '/admin', 'USERS': '', 'GROUPS': '', 'SERVICE_ACCOUNTS': 'openshift-ansible-service-broker/asb', 
        'SUBJECTS': ''},
     {'NAME': 'asb-access', 'ROLE': '/asb-access', 'USERS': '', 'GROUPS': '', 'SERVICE_ACCOUNTS': 'openshift-ansible-service-broker/asb-client', 
        'SUBJECTS': ''},
     {'NAME': 'asb-auth', 'ROLE': '/asb-auth', 'USERS': '', 'GROUPS': '', 'SERVICE_ACCOUNTS': 'openshift-ansible-service-broker/asb', 
        'SUBJECTS': ''},
     {'NAME': 'auth-delegator-openshift-template-service-broker', 'ROLE': '/system:auth-delegator', 
        'USERS': '', 'GROUPS': '', 'SERVICE_ACCOUNTS': 'openshift-template-service-broker/apiserver', 
        'SUBJECTS': ''},
     {'NAME': 'basic-users', 'ROLE': '/basic-user', 'USERS': '', 'GROUPS': 'system:authenticated', 'SERVICE_ACCOUNTS': '', 
        'SUBJECTS': ''},
     {'NAME': 'cluster-admin', 'ROLE': '/cluster-admin', 'USERS': '', 'GROUPS': 'system:masters', 'SERVICE_ACCOUNTS': '', 
        'SUBJECTS': ''},
     {'NAME': 'cluster-admin-0', 'ROLE': '/cluster-admin', 'USERS': '', 'GROUPS': '', 'SERVICE_ACCOUNTS': 'insights-scan/insights-scan', 
        'SUBJECTS': ''},
     {'NAME': 'cluster-admins', 'ROLE': '/cluster-admin', 'USERS': '', 'GROUPS': '', 'SERVICE_ACCOUNTS': '', 
        'SUBJECTS': ''}]


def test_oc_get_clusterrolebinding_with_config_3():
    with pytest.raises(ParseException) as (e):
        openshift_get_with_config.OcGetClusterRoleBindingWithConfig(context_wrap(OC_GET_CLUSTERROLEBINDING_INVALID2))
    assert 'invalid content' in str(e)


def test_doc():
    env = {'oc_get_cluster_role_with_config': OcGetClusterRoleWithConfig(context_wrap(OC_GET_CLUSTER_ROLE)), 
       'oc_get_clusterrolebinding_with_config': OcGetClusterRoleBindingWithConfig(context_wrap(OC_GET_CLUSTERROLEBINDING))}
    failed, total = doctest.testmod(openshift_get_with_config, globs=env)
    assert failed == 0