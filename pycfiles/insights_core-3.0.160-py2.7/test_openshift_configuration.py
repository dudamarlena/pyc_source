# uncompyle6 version 3.7.4
# Python bytecode 2.7 (62211)
# Decompiled from: Python 3.6.9 (default, Apr 18 2020, 01:56:04) 
# [GCC 8.4.0]
# Embedded file name: build/bdist.linux-x86_64/egg/insights/parsers/tests/test_openshift_configuration.py
# Compiled at: 2019-05-16 13:41:33
from insights.parsers import openshift_configuration
from insights.tests import context_wrap
NODE_CONFIG = '\nallowDisabledDocker: false\napiVersion: v1\ndnsDomain: cluster.local\ndnsIP: 10.66.208.145\ndockerConfig:\n  execHandlerName: ""\niptablesSyncPeriod: "30s"\nimageConfig:\n  format: openshift3/ose-${component}:${version}\n  latest: false\nkind: NodeConfig\nkubeletArguments:\n  node-labels: []\nmasterClientConnectionOverrides:\n  acceptContentTypes: application/vnd.kubernetes.protobuf,application/json\n  contentType: application/vnd.kubernetes.protobuf\n  burst: 200\n  qps: 100\nmasterKubeConfig: system:node:master.ose.com.kubeconfig\nnetworkPluginName: redhat/openshift-ovs-subnet\n# networkConfig struct introduced in origin 1.0.6 and OSE 3.0.2 which\n# deprecates networkPluginName above. The two should match.\nnetworkConfig:\n   mtu: 1450\n   networkPluginName: redhat/openshift-ovs-subnet\nnodeName: master.ose.com\npodManifestConfig:\nservingInfo:\n  bindAddress: 0.0.0.0:10250\n  certFile: server.crt\n  clientCA: ca.crt\n  keyFile: server.key\nvolumeDirectory: /var/lib/origin/openshift.local.volumes\nproxyArguments:\n  proxy-mode:\n     - iptables\nvolumeConfig:\n  localQuota:\n    perFSGroup:\n'
MASTER_CONFIG = '\nadmissionConfig:\napiLevels:\n- v1\napiVersion: v1\nassetConfig:\n  logoutURL: ""\n  masterPublicURL: https://master.ose.com:8443\n  publicURL: https://master.ose.com:8443/console/\n  servingInfo:\n    bindAddress: 0.0.0.0:8443\n    bindNetwork: tcp4\n    certFile: master.server.crt\n    clientCA: ""\n    keyFile: master.server.key\n    maxRequestsInFlight: 0\n    requestTimeoutSeconds: 0\ncontrollerConfig:\n  serviceServingCert:\n    signer:\n      certFile: service-signer.crt\n      keyFile: service-signer.key\ncontrollers: \'*\'\ncorsAllowedOrigins:\n  - 127.0.0.1\n  - localhost\n  - 10.66.208.145\n  - kubernetes.default\n  - kubernetes.default.svc.cluster.local\n  - kubernetes\n  - openshift.default\n  - openshift.default.svc\n  - 172.30.0.1\n  - master.ose.com\n  - openshift.default.svc.cluster.local\n  - kubernetes.default.svc\n  - openshift\ndnsConfig:\n  bindAddress: 0.0.0.0:8053\n  bindNetwork: tcp4\netcdClientInfo:\n  ca: master.etcd-ca.crt\n  certFile: master.etcd-client.crt\n  keyFile: master.etcd-client.key\n  urls:\n    - https://master.ose.com:2379\netcdStorageConfig:\n  kubernetesStoragePrefix: kubernetes.io\n  kubernetesStorageVersion: v1\n  openShiftStoragePrefix: openshift.io\n  openShiftStorageVersion: v1\nimageConfig:\n  format: openshift3/ose-${component}:${version}\n  latest: false\nkind: MasterConfig\nkubeletClientInfo:\n  ca: ca.crt\n  certFile: master.kubelet-client.crt\n  keyFile: master.kubelet-client.key\n  port: 10250\nkubernetesMasterConfig:\n  apiServerArguments:\n  controllerArguments:\n  masterCount: 1\n  masterIP: 10.66.208.145\n  podEvictionTimeout:\n  proxyClientInfo:\n    certFile: master.proxy-client.crt\n    keyFile: master.proxy-client.key\n  schedulerArguments:\n  schedulerConfigFile: /etc/origin/master/scheduler.json\n  servicesNodePortRange: ""\n  servicesSubnet: 172.30.0.0/16\n  staticNodeNames: []\nmasterClients:\n  externalKubernetesClientConnectionOverrides:\n    acceptContentTypes: application/vnd.kubernetes.protobuf,application/json\n    contentType: application/vnd.kubernetes.protobuf\n    burst: 400\n    qps: 200\n  externalKubernetesKubeConfig: ""\n  openshiftLoopbackClientConnectionOverrides:\n    acceptContentTypes: application/vnd.kubernetes.protobuf,application/json\n    contentType: application/vnd.kubernetes.protobuf\n    burst: 600\n    qps: 300\n  openshiftLoopbackKubeConfig: openshift-master.kubeconfig\nmasterPublicURL: https://master.ose.com:8443\nnetworkConfig:\n  clusterNetworkCIDR: 10.128.0.0/14\n  hostSubnetLength: 9\n  networkPluginName: redhat/openshift-ovs-subnet\n# serviceNetworkCIDR must match kubernetesMasterConfig.servicesSubnet\n  serviceNetworkCIDR: 172.30.0.0/16\n  externalIPNetworkCIDRs:\n  - 0.0.0.0/0\noauthConfig:\n  assetPublicURL: https://master.ose.com:8443/console/\n  grantConfig:\n    method: auto\n  identityProviders:\n  - challenge: true\n    login: true\n    mappingMethod: claim\n    name: deny_all\n    provider:\n      apiVersion: v1\n      kind: DenyAllPasswordIdentityProvider\n  masterCA: ca-bundle.crt\n  masterPublicURL: https://master.ose.com:8443\n  masterURL: https://master.ose.com:8443\n  sessionConfig:\n    sessionMaxAgeSeconds: 3600\n    sessionName: ssn\n    sessionSecretsFile: /etc/origin/master/session-secrets.yaml\n  tokenConfig:\n    accessTokenMaxAgeSeconds: 86400\n    authorizeTokenMaxAgeSeconds: 500\npauseControllers: false\npolicyConfig:\n  bootstrapPolicyFile: /etc/origin/master/policy.json\n  openshiftInfrastructureNamespace: openshift-infra\n  openshiftSharedResourcesNamespace: openshift\nprojectConfig:\n  defaultNodeSelector: ""\n  projectRequestMessage: ""\n  projectRequestTemplate: ""\n  securityAllocator:\n    mcsAllocatorRange: "s0:/2"\n    mcsLabelsPerProject: 5\n    uidAllocatorRange: "1000000000-1999999999/10000"\nroutingConfig:\n  subdomain:  ""\nserviceAccountConfig:\n  limitSecretReferences: false\n  managedNames:\n  - default\n  - builder\n  - deployer\n  masterCA: ca-bundle.crt\n  privateKeyFile: serviceaccounts.private.key\n  publicKeyFiles:\n  - serviceaccounts.public.key\nservingInfo:\n  bindAddress: 0.0.0.0:8443\n  bindNetwork: tcp4\n  certFile: master.server.crt\n  clientCA: ca.crt\n  keyFile: master.server.key\n  maxRequestsInFlight: 500\n  requestTimeoutSeconds: 3600\nvolumeConfig:\n  dynamicProvisioningEnabled: True\n'

def test_ose_node_config():
    result = openshift_configuration.OseMasterConfig(context_wrap(MASTER_CONFIG))
    assert result.data['assetConfig']['masterPublicURL'] == 'https://master.ose.com:8443'
    assert result.data['corsAllowedOrigins'][1] == 'localhost'
    assert result.data['projectConfig']['defaultNodeSelector'] == ''


def test_ose_master_config():
    result = openshift_configuration.OseNodeConfig(context_wrap(NODE_CONFIG))
    assert result.data['apiVersion'] == 'v1'
    assert result.data['masterClientConnectionOverrides']['burst'] == 200